Action.prototype.TA_populateMore=function(){let t=JSON.parse(decodeURIComponent(this.installURL.replace("drafts://action?data=","")));switch(this._description=t.actionDescription,this._steps=t.steps.length,this._shouldConfirm=t.shouldConfirm,this._icon=t.icon,this._tintColor=t.tintColor,this._notificationLevel=t.notificationType,this._notificationLevel){case 0:this._notificationLevelDescription="None";break;case 1:this._notificationLevelDescription="Errors";break;case 2:this._notificationLevelDescription="All"}switch(this._logLevel=t.logLevel,this._logLevel){case 0:this._logLevelDescription="None";break;case 1:this._logLevelDescription="Errors";break;case 2:this._logLevelDescription="All"}if(t.hasOwnProperty("keyCommand")){if(this._keyShift=t.keyCommand.shiftKey,this._keyControl=t.keyCommand.controlKey,this._keyOption=t.keyCommand.optionKey,this._keyCommand=t.keyCommand.commandKey,t.keyCommand.input.length>0){switch(t.keyCommand.input){case"#LEFT":this._keyInput="←";break;case"#RIGHT":this._keyInput="→";break;case"#UP":this._keyInput="↑";break;case"#DOWN":this._keyInput="↓";break;case"#TAB":this._keyInput="⇥";break;default:this._keyInput=t.keyCommand.input}this._keyHas=!0}else this._keyInput="",this._keyHas=!1;let e=[];this._keyShift&&e.push("⇧"),this._keyControl&&e.push("⌃"),this._keyOption&&e.push("⌥"),this._keyCommand&&e.push("⌘"),this._keyInput.length>0&&e.push(this._keyInput),this._keyShortcut=e.join("")}else this._keyShortcut="",this._keyShift=!1,this._keyControl=!1,this._keyOption=!1,this._keyCommand=!1,this._keyInput=""},Action.TA_getAllActions=function(){let t=[];return ActionGroup.getAll().forEach(function(e){t=t.concat(e.actions)}),t},ActionGroup.prototype.TA_actionGroupCounts=function(){let t=0,e=0;return this.actions.forEach(function(n){n.isSeparator?e++:t++}),[t,e]},ActionGroup.prototype.TA_actionGroupActionCount=function(){return this.TA_actionGroupCounts()[0]},ActionGroup.prototype.TA_actionGroupSeparatorCount=function(){return this.TA_actionGroupCounts()[1]},ActionGroup.prototype.TA_actionNames=function(){let t=[];return this.actions.forEach(function(e){e.isSeparator||t.push(e.name)}),t},ActionGroup.prototype.TA_separatorNames=function(){let t=[];return this.actions.forEach(function(e){e.isSeparator&&t.push(e.name)}),t},app.TA_applyWorkspaceByName=function(t,e){return!!app.applyWorkspace(Workspace.find(t))&&(e&&app.showDraftList(),!0)},app.TA_removeTags=function(t,e){let n=Draft.query("",e,[t]);for(let a of n)a.removeTag(t),a.update();return n.length},app.TA_dictateToClipboard=function(){let t=editor.dictate();return t.length>0&&(app.setClipboard(t),!0)},app.TA_trashUnflggedInboxDraftsTaggedDrafts=function(t){let e=0;return(Draft.query("","inbox",[t]).forEach(function(t){!1==t.isFlagged&&(e+=1,t.isTrashed=!0,t.update())}),0==e)?(this.displayInfoMessage(`No drafts tagged '${t}' were found in the inbox`),0):1==e?(this.displayInfoMessage(`1 inbox draft tagged '${t}' was moved to the Trash`),1):(this.displayInfoMessage(`${e} inbox drafts tagged '${t}' were moved to the Trash`),e)},app.TA_removeRunTagFromArchive=function(){let t=this.TA_removeTags(tadLib.runTag,"archive");return this.displayInfoMessage("Removed "+t+" instance".TA_pluralise(t)+" of run tag from archive."),t},app.TA_msgbox=function(t,e){let n=Prompt.create();n.title=t,n.message=e,n.addButton("OK"),n.isCancellable=!1,n.show()},app.TA_msgInfo=function(t){return app.TA_msgbox(tadLib.msgTitleInfo,t)},app.TA_msgWarn=function(t){return app.TA_msgbox(tadLib.msgTitleWarn,t)},app.TA_msgError=function(t){return app.TA_msgbox(tadLib.msgTitleError,t)},app.TA_msgDebug=function(t){return tadLib.debugEnabled&&(app.TA_msgbox(tadLib.msgTitleDebug,t),console.TA_logDebug(t)),tadLib.debugEnabled},app.TA_displayInfoMessage=function(t){app.displayInfoMessage(t),console.TA_logInfo(t)},app.TA_displayWarningMessage=function(t){app.displayWarningMessage(t),console.TA_logWarn(t)},app.TA_displayErrorMessage=function(t){app.displayErrorMessage(t),console.TA_logError(t)},app.TA_displaySuccessMessage=function(t){app.displaySuccessMessage(t),console.TA_logSuccess(t)},app.TA_displayDebugMessage=function(t){return tadLib.debugEnabled&&(app.displayInfoMessage(tadLib.msgTitleDebug+t),console.TA_logDebug(t)),tadLib.debugEnabled},app.TA_URLEncodeClipboard=function(){let t=encodeURIComponent(app.getClipboard());return this.setClipboard(t),t},app.TA_URLDecodeClipboard=function(){let t=decodeURIComponent(app.getClipboard());return app.setClipboard(t),t},app.TA_clipboard_MMD2HTML=function(){let t=MultiMarkdown.create();this.setClipboard(t.render(this.getClipboard())),this.displayInfoMessage("Clipboard conversion to HTML complete. Clipboard content replaced.")},app.TA_actionSelectAndRun=function(t){let e=[];for(let n in tadLib.actions[t])tadLib.actions[t].hasOwnProperty(n)&&e.push(n);let a=Prompt.TA_promptButtonArray("Select","",e);null!=a&&app.queueAction(Action.find(tadLib.actions[t][a]),draft)},app.TA_clipboardAppend=function(t,e=""){return 0==this.getClipboard().length?this.setClipboard(t):this.setClipboard(this.getClipboard()+e+t),this.getClipboard()},app.TA_clipboardPrepend=function(t,e=""){return 0==this.getClipboard().length?this.setClipboard(t):this.setClipboard(t+e+this.getClipboard()),this.getClipboard()},app.TA_clipboardEmpty=function(){return this.setClipboard(""),""==this.getClipboard()},app.TA_toggleThemeMode=function(){let t="";switch(this.themeMode){case"light":t="dark";break;case"dark":t="light";break;default:t="light"==this.currentThemeMode?"dark":"light"}return this.themeMode=t,t},app.TA_actionGroupCounts=function(){let t=0,e=0;return ActionGroup.getAll().forEach(function(n){let a=n.TA_actionGroupCounts();t+=a[0],e+=a[1]}),[t,e]},app.TA_actionGroupActionCount=function(){return this.TA_actionGroupCounts()[0]},app.TA_actionGroupSeparatorCount=function(){return this.TA_actionGroupCounts()[1]},app.TA_actionNames=function(){let t=[];return ActionGroup.getAll().forEach(function(e){let n=e.TA_actionNames();t.push(...n)}),t},app.TA_actionGroupNames=function(){let t=[];return ActionGroup.getAll().forEach(function(e){t.push(e.name)}),t},app.TA_getActionGroupActionNames=function(t=!1){let e=new TadHTMLPrompt().TA_dropDown("Select an action group to get the actions for",app.TA_actionGroupNames());if(""!==e){let n=ActionGroup.find(e);return t?n.TA_actionNames().sort().join("\n"):n.TA_actionNames().join("\n")}return""},app.TA_getActionGroupSeparatorNames=function(t=!1){let e=new TadHTMLPrompt().TA_dropDown("Select an action group to get the separators for",app.TA_actionGroupNames());if(""!==e){let n=ActionGroup.find(e);return t?n.TA_separatorNames().sort().join("\n"):n.TA_separatorNames().join("\n")}return""},app.TA_fileImporterBasic=function(t){let e=FileManager.createCloud();app.displayInfoMessage("Retrieving files, please be patient...");let n=e.listContents(t);return n.forEach(function(t){let n=new Draft;n.content=e.readString(t),n.createdAt=e.getCreationDate(t),n.modifiedAt=e.getModificationDate(t),tadMisc.TA_sleepMS(5),n.update()}),app.displayInfoMessage(n.length+" imported"),n.length},app.TA_fileImporterTagEnabled=function(t,e,n=""){let a=FileManager.createCloud();app.displayInfoMessage("Retrieving files, please be patient...");let i=a.listContents(t);return i.forEach(function(t){let i=new Draft;i.content=a.readString(t),i.createdAt=a.getCreationDate(t),e.length>0&&i.TA_tagAddArray(e),""!=n&&i.TA_tagAddArray(i.content.TA_frontMatterSimpleKeyValue(n).TA_csvToArray()),i.modifiedAt=a.getModificationDate(t),tadMisc.TA_sleepMS(5),i.update()}),app.displayInfoMessage(i.length+" imported"),i.length},app.TA_queueActionByName=function(t,e){return this.queueAction(Action.find(t),e)},app.TA_processCrossLink=function(t){let e=t.TA_startsWithRemove("[[").TA_endsWithRemove("]]");if(t.startsWith("u:")){e=t.substring(2);void 0==Draft.find(e)?app.TA_displayWarningMessage("Draft With Specified UUID Not Found"):editor.TA_loadAcUUID(e);return}if(t.startsWith("s:")){e=t.substring(2),app.showQuickSearch(e);return}if(t.startsWith("w:")){e=t.substring(2),Workspace.TA_loadWorkspaceByName(e);return}if(t.startsWith("d:"))e=t.substring(2);else if(t.startsWith("google:")){e="https://www.google.com/search?q="+(e=t.substring(7)).TA_encodeURI(),app.openURL(e);return}else if(t.startsWith("wikipedia:")){e="https://en.wikipedia.org/wiki/Special:Search/"+(e=t.substring(10)).TA_encodeURI(),app.openURL(e);return}else if(t.startsWith("url:")){e=t.substring(4),app.openURL(e);return}else if(t.startsWith("bear:")){e="bear://x-callback-url/open-note?title="+(e=t.substring(5)).TA_encodeURI(),app.openURL(e);return}let n=[],a=[],i=e.TA_countOccurrences("/");for(let r=0;r<=i;r++){let o=e.split("/").slice(0,r+1).join("/"),s=e.substring(o.length+1);if(o.length>0&&o.TA_countOccurrences("/")!==o.length){let l=Draft.queryByTitle(o);l.length>0&&(""==s?l.forEach(function(t){t.displayTitle==o?n.push(t):a.push(t)}):l.forEach(function(t){let e=t.TA_navigationMarkersGet(),i=!1;e.forEach(function(t){t.label==s&&(i=!0)}),i?n.push(t):a.push(t)}))}}if(n.length+a.length==0){let d=new Draft;d.content=e+"\n",d.update(),editor.TA_loadAc(d),app.TA_displayInfoMessage("No Match: New Draft Created");return}if(1==n.length){editor.TA_loadAc(n[0]);let c=e.TA_afterFirstOccurrence(n[0].displayTitle);""!==c&&editor.TA_navigateToMarkerByName(c.TA_startsWithRemove("/"));return}if(n.length>1){let h=t+"/";""!==h.replaceAll("/","")&&(h=h.match(/^.*?[^\/]\//)[0].slice(0,-1)),app.showQuickSearch("title:"+h);return}if(1==a.length){editor.TA_loadAc(a[0]);return}if(a.length>1){let u=t+"/";""!==u.replaceAll("/","")&&(u=u.match(/^.*?[^\/]\//)[0].slice(0,-1)),app.showQuickSearch("title:"+u);return}app.TA_displayWarningMessage("No Match: Unknown Link"),console.log(`Unknown Link: ${t}`)},app.TA_loadActionListByName=function(t){let e=ActionGroup.find(t);return void 0!=e?this.loadActionGroup(e):(console.TA_logError(`List Load Failed - Action group ${t} not found`),!1)},app.TA_loadActionBarByName=function(t){let e=ActionGroup.find(t);return void 0!=e?this.loadActionBarGroup(e):(console.TA_logError(`Bar Load Failed - Action group ${t} not found`),!1)},app.TA_encryptAESClipboard=function(t){return this.getClipboard().TA_encryptAESOntoClipboard(t)},app.TA_decryptAESClipboard=function(t){return this.getClipboard().TA_decryptAESOntoClipboard(t)},Array.prototype.TA_maxElementLength=function(){return Math.max.apply(Math,this.map(function(t){return t.length}))};class TadCommand{constructor(){}TA_slashSplit(){let t="";editor.TA_selectLineAft();let e=editor.getSelectedText(),n=e.split("/");return n.length>1?(t=n.pop(),editor.setSelectedText(n.join("/"))):editor.setSelectedText(e),editor.TA_cursorToLineEnd(),editor.load(draft),t}TA_command(p_strMode="Prompt"){let strInputCmd="",strCmd=(strInputCmd="Draft"==p_strMode?this.TA_slashSplit().trim():Prompt.TA_singleTextFieldPrompt("Command","Enter your command","/","").trim()).split(" ")[0],strParameters=strInputCmd.slice(-1*(strInputCmd.length-strCmd.length)).trim(),astrCmd=[],strCmdInfo=(astrCmd=strCmd.length<1?["NONE"]:tadLib.commands.hasOwnProperty(strCmd)?tadLib.commands[strCmd].split("|"):["Unknown Command: "+strCmd])[0];switch(astrCmd[0]){case"OPEN_URL":"<1>"==astrCmd[1]?(app.openURL(strParameters),strCmdInfo+=" "+strParameters):(app.openURL(astrCmd[1]),strCmdInfo+=" "+astrCmd[1]);break;case"RUN_ACTION":"<1>"==astrCmd[1]?(app.queueAction(Action.find(strParameters),draft),strCmdInfo+=" "+strParameters):(app.queueAction(Action.find(astrCmd[1]),draft),strCmdInfo+=" "+astrCmd[1]);break;case"RUN_FUNCTION":console.log(astrCmd[1]+'("'+strParameters+'");'),eval(astrCmd[1]+'("'+strParameters+'");');break;default:strCmdInfo="",app.TA_displayErrorMessage(astrCmd[0])}""!=strCmdInfo&&console.log("Operation: "+strCmdInfo)}TA_cmdDraft(){return this.TA_command("Draft")}TA_cmdPrompt(){return this.TA_command("Prompt")}}var tadCmd=new TadCommand;console.TA_logInfo=function(t){console.log(tadLib.consoleInfoMarker+t)},console.TA_logWarn=function(t){console.log(tadLib.consoleWarnMarker+t)},console.TA_logError=function(t){console.log(tadLib.consoleErrorMarker+t)},console.TA_logSuccess=function(t){console.log(tadLib.consoleSuccessMarker+t)},console.TA_logDebug=function(t){return tadLib.debugEnabled&&console.log(tadLib.consoleDebugMarker+t),tadLib.debugEnabled};const TA_DRAFTS_SYNTAX=["Plain Text","Markdown","MultiMarkdown","GitHub Markdown","Simple List","Taskpaper","JavaScript",];Draft.prototype.TA_wordCount=function(){return this.content.TA_countWords()},Draft.prototype.TA_lineCount=function(t=0){return this.content.TA_countLines(t)},Draft.prototype.TA_trashEmptyDrafts=function(){let t=0;return Draft.query("","all",[]).forEach(function(e){0==e.content.length&&!1==e.isTrashed&&(t+=1,e.isTrashed=!0,e.update())}),0==t?app.displayInfoMessage("No blank drafts were found"):1==t?app.displayInfoMessage("1 blank draft was moved to the Trash"):app.displayInfoMessage(`${t} blank drafts were moved to the Trash`),t},Draft.prototype.TA_convertAllToTasks=function(){let t=/^(\s*)(\S\S*)/gm;this.content=this.content.replace(t,"$1"+tadLib.taskBasicStart+tadLib.taskBasicIncomplete+tadLib.taskBasicEnd+"$2");let e="^(\\s*)"+RegExp.TA_escape(tadLib.taskBasicStart+tadLib.taskBasicIncomplete+tadLib.taskBasicEnd+tadLib.taskBasicStart),n=RegExp(e,"gm");this.content=this.content.replace(n,"$1"+tadLib.taskBasicStart),this.update()},Draft.prototype.TA_tagRemoveAll=function(){this.tags.forEach(t=>this.removeTag(t)),this.update()},Draft.prototype.TA_tagFetchAll=function(){return[...new Set([].concat(...Draft.query("","all",[]).map(t=>t.tags)))].sort()},Draft.prototype.TA_lineForEach=function(t){this.content.split("\n").map(t)},Draft.prototype.TA_trashInboxDraftsTagged=function(t){let e=Draft.query("","inbox",t,[],"created",!0);return e.forEach(function(t){t.isTrashed=!0,t.update()}),e.length},Draft.prototype.TA_archiveInboxDraftsTagged=function(t){let e=Draft.query("","inbox",t,[],"created",!0);return e.forEach(function(t){t.isArchived=!0,t.update()}),e.length},Draft.prototype.TA_setSyntax=function(t){let e=!0,n=Prompt.create();return n.title="Set syntax",t.forEach(t=>n.addButton(t)),n.show()?(draft.TA_setSyntaxByName(n.buttonPressed),draft.update()):(context.cancel("Operation Cancelled"),e=!1),editor.activate(),e},Draft.prototype.TA_setSyntaxAllStandard=function(){return this.TA_setSyntax(TA_DRAFTS_SYNTAX)},Draft.prototype.TA_draftNew_ContentSyntax=function(t){let e=Draft.create(),n=HTTP.create();e.content=n.TA_getSyntaxTest(t),e.TA_setSyntaxByName(t),e.update(),editor.load(e)},Draft.prototype.TA_newExample_SimpleList=function(){return this.TA_draftNew_ContentSyntax("Simple List")},Draft.prototype.TA_newExample_Taskpaper=function(){return this.TA_draftNew_ContentSyntax("Taskpaper")},Draft.prototype.TA_newExample_PlainText=function(){return this.TA_draftNew_ContentSyntax("Plain Text")},Draft.prototype.TA_newExample_MultiMarkdown=function(){return this.TA_draftNew_ContentSyntax("MultiMarkdown")},Draft.prototype.TA_newExample_GitHubMarkdown=function(){return this.TA_draftNew_ContentSyntax("GitHub Markdown")},Draft.prototype.TA_newExample_Markdown=function(){return this.TA_draftNew_ContentSyntax("Markdown")},Draft.prototype.TA_newExample_JavaScript=function(){return this.TA_draftNew_ContentSyntax("JavaScript")},Draft.prototype.TA_duplicate=function(){let t=Draft.create();if(t.content=this.content,t.syntax=this.syntax,this.tags.length>0)for(let e=0;e<this.tags.length;e++)t.addTag(this.tags[e]);return t.update(),t},Draft.prototype.TA_duplicateAndLoad=function(){let t=draft.TA_duplicate();return editor.load(t),editor.activate(),t},Draft.prototype.TA_selectSetTags=function(){let t=Prompt.create();if(t.title="Select Tags for Draft",t.addSelect("tags","Available Tags",this.TA_tagFetchAll(),this.tags,!0),t.addButton("OK"),t.show(),"OK"!=t.buttonPressed)return!1;{this.TA_tagRemoveAll();let e=this;return t.fieldValues.tags.forEach(function(t){e.addTag(t)}),this.update(),!0}},Draft.prototype.TA_dictateList=function(t=tadLib.taskBasicSyntax,e=tadLib.taskBasicStart+tadLib.taskBasicIncomplete+tadLib.taskBasicEnd){let n=editor.dictate();if(!(n.length>0))return this;{let a=Draft.create();return a.TA_setSyntaxByName(t),a.content=n.replace(/^(.*)/gm,e+"$1"),a.update(),a}},Draft.prototype.TA_dictateListAndLoad=function(t,e){return editor.TA_loadAc(this.TA_dictateList(t,e))},Draft.prototype.TA_dictateListTaskpaper=function(){return this.TA_dictateListAndLoad("Taskpaper","- ")},Draft.prototype.TA_dictateListSimple=function(){return this.TA_dictateListAndLoad("Simple List","[ ] ")},Draft.prototype.TA_dictateListMarkdown=function(){return this.TA_dictateListAndLoad("Markdown","-[ ] ")},Draft.prototype.TA_draftNewFromSelection=function(){let t=Draft.create();return(t.content=editor.getSelectedText(),t.update(),""==t.content)?null:t},Draft.prototype.TA_draftNewFromSelectionAndLoad=function(){return editor.TA_loadAc(this.TA_draftNewFromSelection())},Draft.prototype.TA_draftNew=function(t,e=""){let n=Draft.create();return n.content=t,""!==e&&n.TA_setSyntaxByName(e),n.update(),editor.TA_loadAc(n),n},Draft.prototype.TA_draftNewFromClipboard=function(){let t=Draft.create();return t.content=app.getClipboard(),t.update(),t},Draft.prototype.TA_draftNewFromClipboardAndLoad=function(){return editor.TA_loadAc(this.TA_draftNewFromClipboard())},Draft.prototype.TA_tagRenameInstance=function(t,e){this.addTag(e),this.removeTag(t),this.update()},Draft.prototype.TA_tagRename=function(t,e,n=!1){let a=Draft.query("","all",[t],[],"created",!1,!1);a.forEach(function(n){n.TA_tagRenameInstance(t,e)}),n&&app.displayInfoMessage(a.length+" tags renamed from '"+t+"' to '"+e+"'.")},Draft.prototype.TA_tagDelete=function(t,e=!1){let n=Draft.query("","all",[t],[],"created",!1,!1);n.forEach(function(e){e.removeTag(t),e.update()}),e&&app.displayInfoMessage(n.length+" tags instances removed.")},Draft.prototype.TA_selectAnyTagRename=function(t=!1){let e=this.TA_tagFetchAll();if(e.length>0){let n=Prompt.TA_selectPrompt("Tag Rename","Select tag to be renamed",e,[]);if(void 0!==n&&n.length>0){let a=Prompt.TA_singleTextFieldPrompt("Tag Rename","Enter the new name for the tag","New Tag Name",n[0]);this.TA_tagRename(n[0],a,t)}}else app.displayInfoMessage("No tags available for renaming.")},Draft.prototype.TA_selectRecentTagRename=function(t=!1){let e=Draft.recentTags();if(e.length>0){let n=Prompt.TA_selectPrompt("Tag Rename","Select tag to be renamed",e,[]);if(void 0!==n&&n.length>0){let a=Prompt.TA_singleTextFieldPrompt("Tag Rename","Enter the new name for the tag","New Tag Name",n[0]);this.TA_tagRename(n[0],a,t)}}else app.displayInfoMessage("No recent tags available for renaming.")},Draft.prototype.TA_selectAnyTagDelete=function(t=!1){let e=this.TA_tagFetchAll();if(e.length>0){let n=Prompt.TA_selectPrompt("Tag Delete","Select tag to be deleted",e,[]);void 0!==n&&n.length>0&&this.TA_tagDelete(n[0],t)}else app.displayInfoMessage("No tags available for deletion.")},Draft.prototype.TA_selectRecentTagDelete=function(t=!1){let e=Draft.recentTags();if(e.length>0){let n=Prompt.TA_selectPrompt("Tag Delete","Select tag to be deleted",e,[]);void 0!==n&&n.length>0&&this.TA_tagDelete(n[0],t)}else app.displayInfoMessage("No recent tags available for deletion.")},Draft.prototype.TA_removeBlankLines=function(){this.content=this.content.TA_removeBlankLines(),this.update()},Draft.prototype.TA_removeEmptyLines=function(){this.content=this.content.TA_removeEmptyLines(),this.update()},Draft.prototype.TA_removeWhitespaceLeading=function(){this.content=this.content.TA_removeWhitespaceLeading(),this.update()},Draft.prototype.TA_removeWhitespaceTrailing=function(){this.content=this.content.TA_removeWhitespaceTrailing(),this.update()},Draft.prototype.TA_removeWhitespaceLeadingTrailing=function(){this.content=this.content.TA_removeWhitespaceLeadingTrailing(),this.update()},Draft.prototype.TA_removeSpaceTabLeading=function(){this.content=this.content.TA_removeSpaceTabLeading(),this.update()},Draft.prototype.TA_removeSpaceTabTrailing=function(){this.content=this.content.TA_removeSpaceTabTrailing(),this.update()},Draft.prototype.TA_removeSpaceTabLeadingTrailing=function(){this.content=this.content.TA_removeSpaceTabLeadingTrailing(),this.update()},Draft.prototype.TA_deduplicateLines=function(){this.content=this.content.TA_deduplicateLines(),this.update()},Draft.prototype.TA_tagAddCSV=function(t){this.TA_tagAddArray(t.split(","))},Draft.prototype.TA_tagAddArray=function(t){for(let e=0;e<t.length;e++)this.addTag(t[e]);this.update()},Draft.prototype.TA_tagRemove=function(t){for(let e=0;e<t.length;e++)this.removeTag(t[e]);this.update()},Draft.prototype.TA_tagRemoveAll=function(){let t=this.tags;for(let e=0;e<t.length;e++)this.removeTag(t[e]);this.update()},Draft.prototype.TA_split=function(t=!1){let e=this.content.substring(0,this.selectionStart),n=this.content.substring(this.selectionStart);if(e.length>0&&n.length>0){this.content=e,this.update();let a=Draft.create();a.content=n,this.tags.length>0&&a.TA_tagAddArray(this.tags),a.update(),t?(editor.load(a),app.displayInfoMessage("Second, split draft, created and loaded.")):app.displayInfoMessage("Second, split draft, created in background."),editor.activate()}},Draft.prototype.TA_shareFile=function(t="txt",e=!1){let n=this.processTemplate("[[safe_title]]").substring(0,250);n.length<1&&(n=this.processTemplate("[[date| %Y-%m-%d-%H.%M.%S]]"));let a="";t.length>0&&(a=" (*"+t+")");let i=Prompt.TA_singleTextFieldPrompt("File Name"+a,"Enter the file name","",n);if(i.length>0&&(!1==i.endsWith(t)||0==t.length)){t.startsWith(".")||(i+="."),i+=t;let r=this.content;e&&(r=this.processTemplate("%%[[draft]]%%")),Share.shareAsFile(i,r)}},Draft.prototype.TA_shareFileBasedOnSyntax=function(){draft.TA_shareFile(tadLib["draft_"+draft.syntax.name.toLowerCase().replace(" ","_")].extension,!1)},Draft.prototype.TA_draftSetUp=function(t,e,n=!1){n&&this.TA_tagRemoveAll(),this.TA_tagAddArray(t),this.TA_setSyntaxByName(e),this.update(),editor.load(this)},Draft.prototype.TA_draftSetUp_Discourse=function(){return this.TA_draftSetUp(tadLib.draft_discourse.tags,tadLib.draft_discourse.syntax,!1)},Draft.prototype.TA_draftNew_Discourse=function(){if(0==this.content.length)this.TA_draftSetUp_Discourse();else{let t="Current Draft",e="New Draft",n=Prompt.create();if(n.title="Create Discourse Draft Using",n.addButton(t),n.addButton(e),n.show()){if(n.buttonPressed==t)this.TA_draftSetUp_Discourse();else{let a=Draft.create();a.TA_draftSetUp_Discourse(),editor.load(a)}editor.activate()}}},Draft.prototype.TA_getRecentDraftData=function(t=10,e){let n=0,a=[],i=Draft.query("","all",[],[],"modified",!0);n=i.length<t?i.length:t;for(let r=0;r<n;r++){let o=i[r].processTemplate("[[modified|%m-%d-%H.%M.%S]]")+": "+i[r].title;o=o.substring(0,tadLib.buttonLabelTruncation-1),a.push(o)}let s=Prompt.TA_promptButtonArray("Recent Drafts","Select a draft to work with",a);if(""!=s){let l=-1;for(let d=0;d<n;d++)a[d]==s&&(l=d);let c="";if(void 0!=e&&(c=e),0==c.length){let h=["draft","title","body","tags","uuid","draft_open_url","created","modified","longitude","latitude","≪ ad hoc ≫",];"≪ ad hoc ≫"==(c=Prompt.TA_promptButtonArray("Template Tags","Select a template tag",h))&&(c=Prompt.TA_singleTextFieldPrompt("Template Tag","Specify the template tag you would like to evaluate:","Tag(s)",""))}if(""!=c)return"[["!=c.substring(0,2)&&(c="[["+c),"]]"!=c.substring(c.length-2)&&(c+="]]"),i[l].processTemplate(c)}return""},Draft.prototype.TA_infoDump=function(t="DATAID",e=!1){let n=t+"_"+this.uuid,a={dataid:n,uuid:this.uuid,content:this.content,title:this.title,syntaxName:this.syntax.name,selectionStart:this.selectionStart,selectionLength:this.selectionLength,tags:this.tags,isArchived:this.isArchived,isTrashed:this.isTrashed,isFlagged:this.isFlagged,createdAt:this.createdAt,createdLatitude:this.createdLatitude,createdLongitude:this.createdLongitude,modifiedAt:this.modifiedAt,modifiedLatitude:this.modifiedLatitude,modifiedLongitude:this.modifiedLongitude,numberofversions:this.versions.length,permalink:this.permalink,selection:this.processTemplate("[[selection]]"),safe_title:this.processTemplate("[[safe_title]]"),selection_only:this.processTemplate("[[selection_only]]"),body:this.processTemplate("[[body]]"),last_line:this.processTemplate("[[line|-1]]")};return(this.setTemplateTag(n,JSON.stringify(a)),e)?a:JSON.stringify(a)},Draft.prototype.TA_draftCountSummary=function(){let t={};t.inbox=this.TA_draftCountSummaryFolder("inbox"),t.inbox_flagged=this.TA_draftCountSummaryFlagged("inbox"),t.inbox_notflagged=t.inbox-t.inbox_flagged,t.archive=this.TA_draftCountSummaryFolder("archive"),t.archive_flagged=this.TA_draftCountSummaryFlagged("archive"),t.archive_notflagged=t.archive-t.archive_flagged,t.trash=this.TA_draftCountSummaryFolder("trash"),t.trash_flagged=this.TA_draftCountSummaryFlagged("trash"),t.trash_notflagged=t.trash-t.trash_flagged,t.all=this.TA_draftCountSummaryFolder("all"),t.all_flagged=this.TA_draftCountSummaryFlagged("all"),t.all_notflagged=t.all-t.all_flagged;let e=this,n=this.TA_tagFetchAll(),a=[];n.forEach(function(t){a.push(e.TA_draftCountSummaryTag(t))}),t.tagHTML=a.join("\n");let i={},r=Syntax.getAll().map(t=>t.name).sort();r.forEach(function(t){i[t]=0,i[t+"Trash"]=0,i[t+"Total"]=0}),i._Undefined_=0,i._Undefined_Trash=0,i._Undefined_Total=0,i.All=0,i.Trash=0,i.Total=0;let o=Draft.query("","all",[],[],"created",!1,!1);t.syntaxHTML="",o.forEach(function(t){void 0==t.syntax?(i._Undefined_=i._Undefined_+1,i._Undefined_Total=i._Undefined_Total+1):(i[t.syntax.name]=i[t.syntax.name]+1,i[t.syntax.name+"Total"]=i[t.syntax.name+"Total"]+1),i.All=i.All+1,i.Total=i.Total+1}),(o=Draft.query("","trash",[],[],"created",!1,!1)).forEach(function(t){void 0==t.syntax?(i._Undefined_Trash=i._Undefined_Trash+1,i._Undefined_Total=i._Undefined_Total+1):(i[t.syntax.name+"Trash"]=i[t.syntax.name+"Trash"]+1,i[t.syntax.name+"Total"]=i[t.syntax.name+"Total"]+1),i.Trash=i.Trash+1,i.Total=i.Total+1}),r.forEach(function(e){t.syntaxHTML=t.syntaxHTML+`<tr>
        <th>${e}</th>
        <td>${i[e]}</td>
        <td>${i[e+"Trash"]}</td>
        <td>${i[e+"Total"]}</td>
        </tr>
`}),i._Undefined_Total>0&&(t.syntaxHTML=t.syntaxHTML+`<tr>
        <th>&lt;Undefined&gt;</th>
        <td>${i._Undefined_}</td>
        <td>${i._Undefined_Trash}</td>
        <td>${i._Undefined_Total}</td>
        </tr>
`),t.syntax_all=i.All,t.syntax_trash=i.Trash,t.syntax_total=i.Total;let s=Workspace.getAll(),l=[];s.forEach(function(t){l.push(e.TA_draftCountSummaryWorkspace(t))}),t.workspaceHTML=l.join("\n");let d=ActionGroup.getAll(),c=[];d.forEach(function(t){let e=t.TA_actionGroupCounts(),n="<tr><td>";n+=t.name,n+="</td><td>",n+=e[0],n+="</td><td>",n+=e[1],n+="</td></tr>",c.push(n)}),t.actionHTML=c.join("\n"),t.groupCount=d.length;let h=app.TA_actionGroupCounts();t.actionCount=h[0],t.separatorCount=h[1];let u=`<html>
    <body>
    <style>
    body {font-family:"Open Sans",sans-serif;line-height: 1.25;}
    table {border: 1px solid #ccc;border-collapse: collapse;margin: 0;padding: 0;width: 100%;table-layout: fixed;}
    table caption {font-size: 1.5em;margin: .5em 0 .75em;}
    table tr {background-color: #f8f8f8;border: 1px solid #ddd;padding: .35em;}
    table th,table td {padding: .625em;text-align: center;}
    table th {font-size: .85em;letter-spacing: .1em;text-transform: uppercase;}
    @media screen and (max-width: 600px) {
        table {border: 0;}
        table caption {font-size: 1.3em;}
        table thead {border: none;clip: rect(0 0 0 0);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}
        table tr {border-bottom: 3px solid #ddd;display: block;margin-bottom: .625em;}
        table td {border-bottom: 1px solid #ddd;display: block;font-size: .8em;text-align: right;}
        table td::before {content: attr(data-label);float: left;font-weight: bold;text-transform: uppercase;}
        table td:last-child {border-bottom: 0;}
        table tfoot {border: none;clip: rect(0 0 0 0);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}
    }
    </style>
    <p>
    <strong>Generated: </strong>${this.processTemplate("[[date|%Y-%m-%d-%H.%M.%S]]")}
    </p>

    <h1>Drafts: Basic</h1>
    <table>
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>Flagged</th>
                <th>Not Flagged</th>
                <th>TOTAL</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>Inbox</th>
                <td>${t.inbox_flagged}</td>
                <td>${t.inbox_notflagged}</td>
                <td>${t.inbox}</td>
            </tr>
            <tr>
                <th>Archive</th>
                <td>${t.archive_flagged}</td>
                <td>${t.archive_notflagged}</td>
                <td>${t.archive}</td>
            </tr>
            <tr>
                <th>All</th>
                <td>${t.all_flagged}</td>
                <td>${t.all_notflagged}</td>
                <td>${t.all}</td>
            </tr>
            <tr>
                <th>Trash</th>
                <td>${t.trash_flagged}</td>
                <td>${t.trash_notflagged}</td>
                <td>${t.trash}</td>
            </tr>
        </tbody>
        </table>
        <br>
        <table>
        <thead>
            <tr>
                <th>&nbsp;</th>
                <th>Flagged</th>
                <th>Not Flagged</th>
                <th>TOTAL</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <th>TOTAL</th>
                <td>${t.all_flagged+t.trash_flagged}</td>
                <td>${t.all_notflagged+t.trash_notflagged}</td>
                <td>${t.all+t.trash}</td>
            </tr>
        </tbody>
    </table>

    <p>&nbsp;</p>

    <h1>Drafts: Tags</h1>
    <table>
    <thead>
        <tr>
            <th>&nbsp;</th>
            <th>Flagged</th>
            <th>Not Flagged</th>
            <th>Inbox</th>
            <th>Archive</th>
            <th>TOTAL</th>
            <th><em>Trashed</em></th>
        </tr>
    </thead>
    <tbody>
       ${t.tagHTML}
    </tbody>
    </table>

    <p>&nbsp;</p>

    <h1>Drafts: Syntaxes</h1>
    <table>
    <thead>
        <tr>
            <th>&nbsp;</th>
            <th>All</th>
            <th>Trash</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
       ${t.syntaxHTML}
    </tbody>
    </table>
    <br>
    <table>
    <thead>
        <tr>
            <th>&nbsp;</th>
            <th>All</th>
            <th>Trash</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th>TOTAL</th>
            <td>${t.syntax_all}</td>
            <td>${t.syntax_trash}</td>
            <td>${t.syntax_total}</td>
        </tr>
    </body>
    </table>

    <p>&nbsp;</p>

    <h1>Drafts: Versions</h1>
    <table>
    <thead>
        <tr>
            <th>Total Versions</th>
            <th>Most Versions of a Draft</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td>${draft.TA_versionCount()}</td>
        <td>${draft.TA_versionCountMax()}</td>
    </tr>
    </tbody>
    </table>

    <p>&nbsp;</p>

    <h1>Drafts: Workspaces</h1>
    <table>
    <thead>
        <tr>
            <th>&nbsp;</th>
            <th>Flagged</th>
            <th>Not Flagged</th>
            <th>Inbox</th>
            <th>Archive</th>
            <th>TOTAL</th>
            <th><em>Trashed</em></th>
        </tr>
    </thead>
    <tbody>
       ${t.workspaceHTML}
    </tbody>
    </table>

    <p>&nbsp;</p>

    <h1>Drafts: Actions & Action Groups</h1>
    <table>
    <thead>
        <tr>
            <th>Groups</th>
            <th>Actions</th>
            <th>Sections</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td>${t.groupCount}</td>
        <td>${t.actionCount}</td>
        <td>${t.separatorCount}</td>
    </tr>
    </tbody>
    </table>

    <p>&nbsp;</p>

    <table>
    <thead>
        <tr>
            <th>Group</th>
            <th>Actions</th>
            <th>Sections</th>
        </tr>
    </thead>
    <tbody>
       ${t.actionHTML}
    </tbody>
    </table>
    </body></html>`;HTMLPreview.create().show(u)},Draft.prototype.TA_draftCountSummaryFolder=function(t){return Draft.query("",t,[],[],"created",!1,!1).length},Draft.prototype.TA_draftCountSummaryFlagged=function(t){let e=Draft.query("",t,[],[],"created",!1,!1),n=0;return e.forEach(function(t){t.isFlagged&&n++}),n},Draft.prototype.TA_draftCountSummaryTag=function(t){let e=Draft.query("","all",[t],[],"created",!1,!1),n=0,a=0;e.forEach(function(t){t.isFlagged?n++:a++});let i=Draft.query("","inbox",[t],[],"created",!1,!1),r;return`<tr>
                <th>${t}</th>
                <td>${n}</td>
                <td>${a}</td>
                <td>${i.length}</td>
                <td>${Draft.query("","archive",[t],[],"created",!1,!1).length}</td>
                <td>${e.length}</td>
                <td><em>${Draft.query("","trash",[t],[],"created",!1,!1).length}</em></td>
            </tr>`},Draft.prototype.TA_draftNewFromClipboardURL=function(){let t=HTTP.create();return this.TA_draftNew(t.TA_getURLContentClipboard())},Draft.prototype.TA_draftNewFromClipboardURLAndLoad=function(){return editor.TA_loadAc(this.TA_draftNewFromClipboardURL())},Draft.prototype.TA_draftNewFromTemplateFile=function(){app.displayInfoMessage("Enumerating file templates - please wait...");let t=FileManager.createCloud(),e=t.listContents("/Library/Templates/"),n=Prompt.create();if(n.title="Select Template",e.forEach(function(t){n.addButton(t.replace("Library/Templates/",""))}),n.show()){let a=Draft.create();return a.content=t.readString("/Library/Templates/"+n.buttonPressed),a.update(),editor.load(a),editor.activate(),a}},Draft.prototype.TA_draftNewFromTemplateDraft=function(){let t=Prompt.create();t.title="Select Template";if(Draft.query("",tadLib.templateFilter,tadLib.templateTags).forEach(function(e){t.addButton(e.title)}),t.show()){let e=Draft.create(),n=Draft.query(t.buttonPressed,tadLib.templateFilter,tadLib.templateTags)[0];return e.content=n.content,n.tags.forEach(function(t){e.addTag(t)}),tadLib.templateTags.forEach(function(t){e.removeTag(t)}),e.syntax=n.syntax,e.update(),editor.load(e),editor.activate(),e}},Draft.prototype.TA_explodedMDPreview=function(t=!1){let e=tadMisc.TA_transcludeWikiLinks(this.content);e=this.processTemplate(e);let n=MultiMarkdown.create();n.format="html";let a=n.render(e);a=tadMisc.TA_addEncodedImages(a),t&&(a=(a=(a=a.replaceAll("[ ]",'<input type="checkbox">')).replaceAll("[x]",'<input type="checkbox" checked>')).replaceAll("[X]",'<input type="checkbox" checked>')),draft.setTemplateTag("preview",a)},Draft.prototype.TA_getMDHeadings=function(){return this.content.match(/^#+ ?.*/gm)},Draft.prototype.TA_draftCountSummaryWorkspace=function(t){let e=t.query("all").length,n=t.query("inbox").length,a=t.query("archive").length,i=t.query("trash").length,r=t.query("flagged").length;return`<tr>
                <th>${t.name}</th>
                <td>${r}</td>
                <td>${e-r}</td>
                <td>${n}</td>
                <td>${a}</td>
                <td>${e}</td>
                <td><em>${i}</em></td>
            </tr>`},Draft.prototype.TA_metaRead=function(){let t=FileManager.createCloud().readJSON(tadLib.metaPath);void 0===this.meta&&(this.meta={}),void 0===t&&(t={}),void 0===t[this.uuid]&&(t[this.uuid]={}),this.meta=Object.assign(this.meta,t[this.uuid])},Draft.prototype.TA_metaWrite=function(){let t=FileManager.createCloud(),e=t.readJSON(tadLib.metaPath);void 0===this.meta&&(this.meta={}),void 0===e&&(e={}),void 0===e[this.uuid]&&(e[this.uuid]={}),e[this.uuid]=this.meta,t.writeJSON(tadLib.metaPath,e)},Draft.prototype.TA_metaTag=function(t){this.setTemplateTag("meta_"+t,this.meta[t])},Draft.prototype.TA_queryAllDrafts=function(){return Draft.query("","all",[],[],"created",!1,!1)},Draft.prototype.TA_mdTitleLinks=function(){draft.saveVersion(),draft.content=draft.content.TA_mdTitleLinks(),draft.update()},Draft.prototype.TA_backLinkSectionInsertLink=function(t){let e=this.content.split(tadLib.backlink_sectionstart);if(e.length>1){let n=[];n=tadLib.backlink_sectionend.length>0?e[1].split(tadLib.backlink_sectionend):n.push(e[0]);let a=e[0];a+=tadLib.backlink_sectionstart,tadLib.backlink_delimiter.startsWith("\n")||(a+=tadLib.backlink_sectionstart+"\n");let i=tadLib.backlink_prefix+"[["+t+"]]"+tadLib.backlink_suffix;n[0].endsWith(tadLib.backlink_delimiter)?a+=n[0]+i:a+=n[0]+tadLib.backlink_delimiter+i,tadLib.backlink_sectionend.length>0&&(a+="\n"+tadLib.backlink_sectionend),n.length>1&&(a+=n[1]),this.content=a}else{let r=tadLib.backlink_sectionstart+"\n";r+=tadLib.backlink_prefix+"[["+t+"]]"+tadLib.backlink_suffix,tadLib.backlink_sectionend.length>0&&(r+="\n"+tadLib.backlink_sectionend),this.content=this.content+"\n\n"+r}this.update()},Draft.prototype.TA_versionCount=function(){let t=0;return this.TA_queryAllDrafts().forEach(function(e){t+=e.versions.length}),t},Draft.prototype.TA_versionCountMax=function(){let t=0;return this.TA_queryAllDrafts().forEach(function(e){e.versions.length>t&&(t=e.versions.length)}),t},Draft.prototype.TA_versionDraftMax=function(){let t=this.TA_versionCountMax(),e=[];return this.TA_queryAllDrafts().forEach(function(n){n.versions.length==t&&e.push(n)}),e},Draft.prototype.TA_embedDraft=function(){let t=app.selectDraft();return void 0!==t&&(editor.TA_insertTextPosAtEnd(`<!-- EMBED : [[u:${t.uuid}]] -->

${t.content}
<!-- [[u:${t.uuid}]] : EMBED -->`),!0)},Draft.prototype.TA_updateEmbed=function(t){let e=RegExp.TA_escape("<!-- EMBED : [[u:");e+=RegExp.TA_escape(t.uuid),e+=RegExp.TA_escape("]] -->"),e+=".*",e+=RegExp.TA_escape("<!-- [[u:"),e+=RegExp.TA_escape(t.uuid),e+=RegExp.TA_escape("]] : EMBED -->");let n=`<!-- EMBED : [[u:${t.uuid}]] -->

${t.content}
<!-- [[u:${t.uuid}]] : EMBED -->`,a=RegExp(e,"gsm");this.content=this.content.replaceAll(a,n),this.update()},Draft.prototype.TA_updateEmbedsOfDraft=function(){let t=Draft.query(`<!-- EMBED : [[u:${this.uuid}]]`,"all",[],[],"modified",!0,!0),e=this;return t.forEach(function(t){t.TA_updateEmbed(e)}),t.length},Draft.prototype.TA_updateEmbedsInDraft=function(){let t=this,e=this.content.match(/<!\-\- EMBED : \[\[.*\]\] \-\->/gm);return e.forEach(function(e){let n=Draft.find(e.substring(17,53));t.TA_updateEmbed(n)}),e.length},Draft.prototype.TA_bodyFirstNonBlankLine=function(){return this.processTemplate("[[body]]").TA_removeBlankLines().split("\n")[0]},Draft.prototype.TA_backLinkAdHoc=function(){let t=Draft.query(`[[${this.title}]]`,"all",[],[],"modified",!0,!0),e=Draft.query(`[[d:${this.title}]]`,"all",[],[],"modified",!0,!0),n=Draft.query(`[[${this.displayTitle}]]`,"all",[],[],"modified",!0,!0),a=Draft.query(`[[d:${this.displayTitle}]]`,"all",[],[],"modified",!0,!0),i=Draft.query(`[[u:${this.uuid}]]`,"all",[],[],"modified",!0,!0),r=Draft.query(`[[${this.title}/`,"all",[],[],"modified",!0,!0),o=Draft.query(`[[d:${this.title}/`,"all",[],[],"modified",!0,!0),s=Draft.query(`[[${this.displayTitle}/`,"all",[],[],"modified",!0,!0),l=Draft.query(`[[d:${this.displayTitle}/`,"all",[],[],"modified",!0,!0),d=t;if(!((d=(d=(d=(d=(d=(d=(d=(d=d.concat(e)).concat(n)).concat(a)).concat(i)).concat(r)).concat(o)).concat(s)).concat(l)).length>0))return app.displayWarningMessage("This draft is not linked from any non-trashed draft."),!1;{d.sort(function(t,e){let n=new Date(t.modifiedAt),a=new Date(e.modifiedAt);return n.getTime()-a.getTime()});let c=[];d.forEach(function(t){c.push(t.uuid)}),c=Array.from(new Set(c));let h=new TadHTMLPrompt;h.content=`<script>function submitLink(p_strUUID)
  {
   //Send the object to Drafts and return a continue code
   Drafts.send("formValues", p_strUUID);
   Drafts.continue();
   return;
  }</script>
  <style>
  .info
  {
   font-size: 0.7em;
  }
  </style>
  <h2>Select a draft to load:</h2>`,c.forEach(function(t){let e=Draft.find(t);h.content=h.content+`<a href="javascript:void(0);" onclick="submitLink('${t}');">${e.title}</a><br>
   <div class="info">
   <strong>Snippet:</strong> ${e.TA_bodyFirstNonBlankLine().TA_trimToSnippet(100).replaceAll("<","&lt;")}<br>
   <strong>ID:</strong>: ${t}<br>
   <strong>Last Updated:</strong> ${e.modifiedAt}<br>
   <br></div>`}),h.hideInterface=!0,h.buttonSubmit="";let u=h.TA_show();return void 0!=u&&(editor.TA_loadAcUUID(u),!0)}},Draft.prototype.TA_addAfterLine=function(t,e){return this.content=this.processTemplate(`[[line|..${e}]]`)+`
${t}
`+this.processTemplate(`[[line|${e+1}..]]`),this.update(),this.content},Draft.prototype.TA_addAtEndOfLine=function(t,e){return this.content=this.processTemplate(`[[line|..${e}]]`)+`${t}
`+this.processTemplate(`[[line|${e+1}..]]`),this.update(),this.content},Draft.prototype.TA_addAtStartOfLine=function(t,e){return this.content=this.processTemplate(`[[line|..${e-1}]]`)+`
${t}`+this.processTemplate(`[[line|${e}..]]`),this.update(),this.content},Draft.prototype.TA_exportOutsideMacSandbox=function(t){let e=FileManager.createCloud(),n=tadMisc.TA_uuidv4()+".txt";e.writeString("/"+n,this.content);let a=`#!/bin/zsh
 mv "$HOME/Library/Mobile Documents/iCloud~com~agiletortoise~Drafts5/Documents/${n}" "${t}"
 `,i=ShellScript.create(a);return i.execute()?(app.displayInfoMessage("Success"),!0):(app.displayErrorMessage("Error: "+i.standardError),console.log(i.standardError),!1)},Draft.prototype.TA_devBeautifyJS=function(t){return this.content=this.content.TA_devBeautifyJS(t),this.update(),this.content},Draft.prototype.TA_randomLine=function(){return this.content.TA_randomLine()},Draft.prototype.TA_processLinesFunctionRetain=function(t){return this.content.TA_processLinesFunction(t)},Draft.prototype.TA_processLinesFunctionReplace=function(t){this.content=this.content.TA_processLinesFunction(t),this.update()},Draft.prototype.TA_queueActionByName=function(t){return app.queueAction(Action.find(t),this)},Draft.prototype.TA_wikiLinkContent=function(t=!1,e=!1){return this.content.TA_wikiLinkContent(t,e)},Draft.prototype.TA_navigationMarkersGet=function(){let t=editor.getSelectedRange();editor.load(this);let e=editor.navigationMarkers;return editor.load(draft),editor.setSelectedRange(t[0],t[1]),editor.activate(),e},Draft.prototype.TA_mergeLines=function(t=" ",e=!0,n=["-","—","–","/"],a=[]){return this.content=this.content.TA_mergeLines(t,e,n,a),this.content},Draft.prototype.TA_chooseAndOpenMDLink=function(t=!0,e=!0){return draft.content.TA_chooseAndOpenMDLink(t,e)},Draft.prototype.TA_matchMDLinks=function(t=!0){return draft.content.TA_matchMDLinks(t)},Draft.prototype.TA_exportFileMac=function(t){return draft.content.TA_exportFileMac(t)},Draft.prototype.TA_encryptAES=function(t){return this.content.TA_encryptAES(t)},Draft.prototype.TA_decryptAES=function(t){return this.content.TA_decryptAES(t)},Draft.prototype.TA_encryptAESOntoClipboard=function(t){return app.setClipboard(this.TA_encryptAES(t))},Draft.prototype.TA_decryptAESOntoClipboard=function(t){return app.setClipboard(this.TA_decryptAES(t))},Draft.prototype.TA_encryptAESSelf=function(t){return this.content=this.TA_encryptAES(t),this.update()},Draft.prototype.TA_decryptAESSelf=function(t){return this.content=this.TA_decryptAES(t),this.update()},Draft.prototype.TA_encryptAESNew=function(t,e=""){return this.TA_draftNew(this.TA_encryptAES(t),e)},Draft.prototype.TA_decryptAESNew=function(t,e=""){return this.TA_draftNew(this.TA_decryptAES(t),e)},Draft.prototype.TA_obfuscate=function(){return this.TA_encryptAESSelf(this.uuid)},Draft.prototype.TA_deobfuscate=function(){return this.TA_decryptAESSelf(this.uuid)},Draft.prototype.TA_addTags=function(t){let e=this,n=this.tags.length;return t.forEach(function(t){e.addTag(t)}),this.update(),this.tags.length-n},Draft.prototype.TA_MDPreviewAdvanced=function(t){let e=tadMisc.TA_transcludeWikiLinks(this.content);e=(e=this.processTemplate(e)).replaceAll(/\`\`\`(\s*)mermaid([\s\S]*?)\`\`\`/g,'<div class="mermaid">$2</div>');let n="";switch(t.toUpperCase()){case"MMD":let a=MultiMarkdown.create();a.format="html",n=a.render(e);break;case"GFM":let i=GitHubMarkdown.create();i.noImages=!1,i.noLinks=!1,i.safeLinks=!1,i.autoLinks=!0,n=i.render(e)}n=(n=(n=(n=(n=(n=(n=tadMisc.TA_addEncodedImages(n)).replaceAll("[ ]",'<input type="checkbox">')).replaceAll("[x]",'<input type="checkbox" checked>')).replaceAll("[X]",'<input type="checkbox" checked>')).replace(/\~\~(.*)\~\~/gm,"<del>$1</del>")).replace(/<pre><code(.*)>(\s*)\n/gm,"<pre><code$1>")).replace(/\n(\s*)<\/code><\/pre>/gm,"</code></pre>"),draft.setTemplateTag("preview",n)},Draft.prototype.TA_getEmailAddresses=function(){return this.content.TA_getEmailAddresses()},Draft.prototype.TA_postBodyToPastebin=function(){return this.TA_postToPastebin(this.processTemplate("[[body]]"))},Draft.prototype.TA_postToPastebin=function(t="",e=this.title,n=!0,a=0,i="",r="N",o=""){let s=new TadPastebin,l=t;""==t&&(l=this.content);let d=i;""==i&&"JavaScript"==this.syntax.name&&(d="javascript"),s.TA_postToPastebin(l,e,n,a,d,r,o)},Draft.prototype.TA_setSyntaxByName=function(t){let e=Syntax.find("builtIn",t);"undefined"!=e?this.syntax=e:"undefined"!=(e=Syntax.find("custom",t))?this.syntax=e:"undefined"!=(e=Syntax.find("file",t))&&(this.syntax=e),this.update()},Draft.prototype.TA_setSyntaxOfType=function(t,e){let n=Syntax.find(t,e);"undefined"!=n&&(this.syntax=n),this.update()},Draft.prototype.TA_setSyntaxBuiltIn=function(t){this.TA_setSyntaxOfType("builtIn",t)},Draft.prototype.TA_setSyntaxCustom=function(t){this.TA_setSyntaxOfType("custom",t)},Draft.prototype.TA_setSyntaxFile=function(t){this.TA_setSyntaxOfType("file",t)},editor.TA_loadAc=function(t){return null==t?null:(editor.load(t),editor.activate(),t)},editor.TA_loadRecentDraft=function(t,e,n,a,i){let r=[];Draft.query("","all",a,i,"created",!0).forEach(function(n){n.createdAt>=t&&n.createdAt<=e&&r.push(n)});let o=[];r.forEach(function(t){o.push(t.title)});let s;switch(o.length){case 0:app.TA_displayWarningMessage("No matching drafts found in specified time frame."),s=!1;break;case 1:app.TA_displayInfoMessage("Single match of draft identified. Loading..."),this.load(r[0]),s=!0;break;default:let l=Prompt.create();l.addLabel("selLabel","Select a draft by title to load it.",{textSize:"body"}),l.addPicker("selMain","",[o],[0]),l.addLabel("info","NOTE: Drafts are shown newest to oldest.",{textSize:"caption"}),l.title=n,l.addButton("OK","btnOK"),l.isCancellable=!0,l.show()?(this.load(r[l.fieldValues.selMain]),s=!0):s=!1}return s},editor.TA_loadRecentDraftToday=function(t,e){this.TA_loadRecentDraft(Date.today(),Date.today().at("23:59:59"),"Created Today",t,e)},editor.TA_loadRecentDraftYesterday=function(t,e){this.TA_loadRecentDraft(Date.parse("yesterday"),Date.parse("yesterday").at("23:59:59"),"Created Yesterday",t,e)},editor.TA_loadRecentDraftTodayOrYesterday=function(t,e){this.TA_loadRecentDraft(Date.parse("yesterday"),Date.today().at("23:59:59"),"Created Today/Yesterday",t,e)},editor.TA_loadRecentDraftThisWeek=function(t,e){this.TA_loadRecentDraft(Date.today().add(-6).day(),Date.today().at("23:59:59"),"Created This Week",t,e)},editor.TA_loadRecentDraftLastWeek=function(t,e){this.TA_loadRecentDraft(Date.today().add(-13).day().at("00:00:00"),Date.today().add(-7).day().at("23:59:59"),"Created Last Week",t,e)},editor.TA_loadRecentDraftLast2Weeks=function(t,e){this.TA_loadRecentDraft(Date.today().add(-13).day().at("00:00:00"),Date.today().at("23:59:59"),"Created Last 2 Weeks",t,e)},editor.TA_loadRecentDraftLast4Weeks=function(t,e){this.TA_loadRecentDraft(Date.today().add(-27).day().at("00:00:00"),Date.today().at("23:59:59"),"Created Last 4 Weeks",t,e)},editor.TA_loadRecentDraftThisMonth=function(t,e){this.TA_loadRecentDraft(Date.today().moveToFirstDayOfMonth().at("00:00:00"),Date.today().at("23:59:59"),"Created This Month",t,e)},editor.TA_loadRecentDraftLastMonth=function(t,e){this.TA_loadRecentDraft(Date.today().add(-1).month().moveToFirstDayOfMonth().at("00:00:00"),Date.today().add(-1).month().moveToLastDayOfMonth().at("23:59:59"),"Created Last Month",t,e)},editor.TA_toggleLoadPreviousLoad=function(){this.load(this.recentDrafts[1])},editor.TA_toggleLoadPreviousModified=function(){let t=Draft.query("","all",[],[],"modified",!0,!1);t.length>1?draft.uuid==t[0].uuid?this.load(t[1]):this.load(t[0]):app.displayErrorMessage("Sorry, not enough available drafts to use this action")},editor.TA_prefixDraftEditorContent=function(t){let e=this.getSelectedRange();this.setText(t+this.getText()),this.setSelectedRange(e[0]+t.length,e[1]),this.activate()},editor.TA_suffixDraftEditorContent=function(t){let e=this.getSelectedRange();this.setText(this.getText()+t),this.setSelectedRange(e[0],e[1]),this.activate()},editor.TA_replaceDraftEditorContent=function(t,e){let n=this.getSelectedRange(),a=this.getText(),i=a.slice(0,n[0]),r=a.slice(n[0],n[0]+n[1]),o=a.slice(n[0]+n[1],a.length);i=i.replaceAll(t,e),r=r.replaceAll(t,e),o=o.replaceAll(t,e),this.setText(i+r+o),this.setSelectedRange(i.length,r.length),this.activate()},editor.TA_removeDraftEditorContent=function(t){this.TA_replaceDraftEditorContent(t,"")},editor.TA_setSelectedRangeAll=function(){this.setSelectedRange(0,this.getText().length),this.activate()},editor.TA_setSelectedRangeStart=function(){this.setSelectedRange(0,0),this.activate()},editor.TA_setSelectedRangeEnd=function(){this.setSelectedRange(this.getText().length,0),this.activate()},editor.TA_insertTextPosAtEnd=function(t){this.setSelectedText(t),this.setSelectedRange(editor.getSelectedRange()[0]+editor.getSelectedRange()[1],0),this.activate()},editor.TA_loadNewDraftWithContent=function(t){return draft.TA_draftNew(t)},editor.TA_cursorToSelectionEnd=function(){return this.setSelectedRange(this.getSelectedRange()[0]+this.getSelectedRange()[1],0),this.activate(),this.getSelectedRange()[0]},editor.TA_cursorToSelectionStart=function(){return this.setSelectedRange(this.getSelectedRange()[0],0),this.activate(),this.getSelectedRange()[0]},editor.TA_deleteNextChar=function(){let t=this.getSelectedText();this.setSelectedRange(this.getSelectedRange()[0],this.getSelectedRange()[1]+1),this.setSelectedText(t),this.activate()},editor.TA_selectLine=function(t=!0){let e=0;this.getTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1]).endsWith("\n")&&t&&(e=1),this.setSelectedRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1]-e),this.activate()},editor.TA_selectLineFore=function(){this.TA_cursorToSelectionStart(),this.TA_selectLine()},editor.TA_selectLineAft=function(){this.TA_cursorToSelectionEnd(),this.TA_selectLine()},editor.TA_deleteCurrentLine=function(){this.TA_selectLine(),this.setSelectedText("")},editor.TA_deleteCurrentLineFore=function(){this.TA_selectLineFore(),this.setSelectedText("")},editor.TA_deleteCurrentLineAft=function(){this.TA_selectLineAft(),this.setSelectedText("")},editor.TA_sortSelectionAlphabetic=function(){let t=this.getSelectedLineRange(),e=this.getTextInRange(t[0],t[1]).split("\n");return e.sort((t,e)=>t.localeCompare(e,void 0,{sensitivity:"base"})),this.setTextInRange(t[0],t[1],e.join("\n")),this.activate(),e.join("\n")},editor.TA_sortSelectionReverseAlphabetic=function(){let t=this.getSelectedLineRange(),e=this.getTextInRange(t[0],t[1]).split("\n");return e.sort((t,e)=>e.localeCompare(t,void 0,{sensitivity:"base"})),this.setTextInRange(t[0],t[1],e.join("\n")),this.activate(),e.join("\n")},editor.TA_selectAll=function(){return this.setSelectedRange(0,this.getText().length),this.getText()},editor.TA_sortAllAlphabetic=function(){return this.TA_selectAll(),this.TA_sortSelectionAlphabetic()},editor.TA_sortAllReverseAlphabetic=function(){return this.TA_selectAll(),this.TA_sortSelectionReverseAlphabetic()},editor.TA_sortSelectionNumeric=function(){let t=this.getSelectedLineRange(),e=this.getTextInRange(t[0],t[1]).split("\n");return e.sort(function(t,e){return t-e}),this.setTextInRange(t[0],t[1],e.join("\n")),e.join("\n")},editor.TA_sortSelectionReverseNumeric=function(){let t=this.getSelectedLineRange(),e=this.getTextInRange(t[0],t[1]).split("\n");return e.sort(function(t,e){return e-t}),this.setTextInRange(t[0],t[1],e.join("\n")),e.join("\n")},editor.TA_sortAllNumeric=function(){return this.TA_selectAll(),this.TA_sortSelectionNumeric()},editor.TA_sortAllReverseNumeric=function(){return this.TA_selectAll(),this.TA_sortSelectionReverseNumeric()},editor.TA_sortSelectionRandom=function(){let t=this.getSelectedLineRange(),e=this.getTextInRange(t[0],t[1]).split("\n");return e.sort(function(t,e){return .5-Math.random()}),this.setTextInRange(t[0],t[1],e.join("\n")),e.join("\n")},editor.TA_sortAllRandom=function(){return this.TA_selectAll(),this.TA_sortSelectionRandom()},editor.TA_getCurrentLine=function(){return this.getTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1])},editor.TA_getCurrentLineNoNewLine=function(){return this.TA_getCurrentLine().TA_stripFinalNewLine()},editor.TA_replaceCurrentLine=function(t){this.TA_selectLine();let e="\n";return this.getSelectedText().endsWith(e)&&!t.endsWith(e)&&(t+=e),this.setSelectedText(t),t},editor.TA_duplicateCurrentLineNTimes=function(t){let e=this.TA_getCurrentLineNoNewLine(),n=[];for(let a=0;a<=t;a++)n.push(e);this.TA_replaceCurrentLine(n.join("\n")),this.TA_cursorToSelectionEnd()},editor.TA_duplicateCurrentLine=function(){return this.TA_duplicateCurrentLineNTimes(1)},editor.TA_repeatDuplicateCurrentLineAsk=function(t=tadLib.duplicateLinesDefault){let e=Prompt.create();e.title="Number of duplicate lines to create",e.addTextField("numRepetitions","Lines",t.toString(),["numberPad"]),e.addButton("OK"),e.show()&&"OK"==e.buttonPressed&&this.TA_duplicateCurrentLineNTimes(e.fieldValues.numRepetitions)},editor.TA_loadEmpty=function(){let t=Draft.create();return this.load(t),t},editor.TA_loadLastCreatedDraft=function(){let t=Draft.query("","all",[]);return t=t.sort(function(t,e){return e.createdAt-t.createdAt}),this.load(t[0]),t[0]},editor.TA_loadLastModifiedDraft=function(){let t=Draft.query("","all",[]);t=t.sort(function(t,e){return e.modifiedAt-t.modifiedAt}),this.load(t[0])},editor.TA_loadLastCreatedDraftIncludeTrashed=function(){let t=Draft.query("","all",[]),e=Draft.query("","trash",[]);t=(t=t.concat(e)).sort(function(t,e){return e.createdAt-t.createdAt}),this.load(t[0])},editor.TA_loadLastModifiedDraftIncludeTrashed=function(){let t=Draft.query("","all",[]),e=Draft.query("","trash",[]);t=(t=t.concat(e)).sort(function(t,e){return e.modifiedAt-t.modifiedAt}),this.load(t[0])},editor.TA_insertTimestampyyyyMMddhhmmss=function(){this.TA_insertTextPosAtEnd(tadMisc.TA_getTimestampyyyyMMddhhmmss())},editor.TA_mdTitleLinkFromClipboardURL=function(){let t=HTTP.create();this.setSelectedText(t.TA_mdTitleLinkFromURL(app.getClipboard())),this.TA_cursorToSelectionEnd()},editor.TA_mdTitleLinkFromSelectedURL=function(){let t=HTTP.create();this.setSelectedText(t.TA_mdTitleLinkFromURL(this.getSelectedText())),this.TA_cursorToSelectionEnd()},editor.TA_discourseHideDetails=function(){let t=Prompt.TA_singleTextFieldPrompt("Discourse Hide Details Generator","Enter the title for the expansion section","Select to reveal...","");""!=t&&this.TA_insertTextPosAtEnd('[details="'+t+'"]\n'+this.getSelectedText()+"\n[/details]")},editor.TA_mdTitleLinkFromClipboardURL=function(){let t=HTTP.create();this.setSelectedText(t.TA_mdTitleLinkFromURL(app.getClipboard())),this.TA_cursorToSelectionEnd()},editor.TA_mdTitleLinkFromSelectedURL=function(){let t=HTTP.create();this.setSelectedText(t.TA_mdTitleLinkFromURL(this.getSelectedText())),this.TA_cursorToSelectionEnd()},editor.TA_mdScriptSelectedText=function(t=""){this.setSelectedText(this.getSelectedText().TA_mdCodeBlock(t)+"\n"),this.TA_cursorToSelectionEnd()},editor.TA_cursorToLineStart=function(){return this.setSelectedRange(this.getSelectedLineRange()[0],0),this.activate(),this.getSelectedRange()[0]},editor.TA_cursorToLineEnd=function(){this.TA_cursorToSelectionEnd();let t=this.getSelectedLineRange();return t[0]!=t[0]+t[1]&&this.setSelectedRange(t[0]+t[1]-1,0),this.activate(),this.getSelectedRange()[0]},editor.TA_cursorToStart=function(){return this.setSelectedRange(0,0),this.activate(),0},editor.TA_cursorToEnd=function(){return this.setSelectedRange(this.getText().length,0),this.activate(),this.getSelectedRange()[0]},editor.TA_shareText=function(){let t="";return editor.getSelectedText().length>0?Share.shareAsText(editor.getSelectedText()):Share.shareAsText(draft.content),Share.shareAsText(t),this.activate(),t},editor.TA_shareHTML=function(){let t="";return t=editor.getSelectedText().length>0?draft.processTemplate("%%[[selection]]%%"):draft.processTemplate("%%[[draft]]%%"),Share.shareAsText(t),this.activate(),t},editor.TA_readingModeEnable=function(){this.TA_readingModeDisable(!0,!0,!0)},editor.TA_readingModeDisable=function(t=!1,e=!1,n=!1){this.linkModeEnabled=t,this.focusModeEnabled=e,app.isIdleDisabled=n},editor.TA_readingModeToggle=function(t=!1,e=!1,n=!1){return this.TA_readingModeIsEnabled()?this.TA_readingModeDisable(t,e,n):this.TA_readingModeEnable(),this.TA_readingModeIsEnabled()},editor.TA_readingModeIsEnabled=function(){return this.linkModeEnabled&&this.focusModeEnabled&&app.isIdleDisabled},editor.TA_readingModeShowProperties=function(){let t="READING MODE PROPERTIES: (";return this.TA_readingModeIsEnabled()?t+="Enabled)\n\n":t+="Disabled)\n\n",t+="• Link Mode Enabled = ",this.linkModeEnabled?t+="Enabled\n":t+="Disabled\n",t+="• Link Mode Enabled = ",this.focusModeEnabled?t+="Enabled\n":t+="Disabled\n",t+="• Idle Disabled = ",app.isIdleDisabled?t+="Enabled\n":t+="Disabled\n",t+="\n All properties must be true to constitute reading mode being enabled.",app.TA_msgInfo(t),this.TA_readingModeIsEnabled()},editor.TA_selectParagraph=function(){let t="\n\n",[e,n]=this.getSelectedRange(),a=draft.content.substring(0,e),i=draft.content.substring(e,draft.content.length),r=a.lastIndexOf(t);-1==r?r=0:r+=t.length;let o=i.indexOf(t);return -1==o&&(o=i.length),o=e+o,this.setSelectedRange(r,o-r),this.activate(),this.getSelectedText()},editor.TA_wrapParagraph=function(t,e){let[n,a]=editor.getSelectedRange();this.TA_selectParagraph(),this.setSelectedText(t+this.getSelectedText()+e),this.setSelectedRange(n+t.length,a)},editor.TA_delimitParagraph=function(t){this.TA_wrapParagraph(t,t)},editor.TA_wrapLines=function(t,e){let[n,a]=editor.getSelectedRange();this.TA_selectLine(),this.setSelectedText(t+this.getSelectedText()+e),this.setSelectedRange(n+t.length,a)},editor.TA_delimitLines=function(t){this.TA_wrapLines(t,t)},editor.TA_wrapSelection=function(t,e){let[n,a]=editor.getSelectedRange();this.setSelectedText(t+this.getSelectedText()+e),this.setSelectedRange(n+t.length,a)},editor.TA_delimitSelection=function(t){this.TA_wrapSelection(t,t)},editor.TA_cursorToParagraphStart=function(){return this.TA_selectParagraph(),this.TA_cursorToSelectionStart()},editor.TA_cursorToParagraphEnd=function(){return this.TA_selectParagraph(),this.TA_cursorToSelectionEnd()},editor.TA_cursorToStartOfNextLine=function(){return this.setSelectedRange(this.getSelectedLineRange()[0]+this.getSelectedLineRange()[1],0),this.activate(),this.getSelectedRange()[0]},editor.TA_cursorToEndOfPreviousLine=function(){return this.setSelectedRange(this.getSelectedLineRange()[0]-1,0),this.activate(),this.getSelectedRange()[0]},editor.TA_selectionExtendLeft=function(t=1){return this.setSelectedRange(this.getSelectedRange()[0]-t,this.getSelectedRange()[1]+t),this.getSelectedRange()},editor.TA_selectionExtendRight=function(t=1){return this.setSelectedRange(this.getSelectedRange()[0],this.getSelectedRange()[1]+t),this.getSelectedRange()},editor.TA_cursorToLeft=function(t=1){return this.setSelectedRange(this.getSelectedRange()[0]-t,0),editor.activate(),this.getSelectedRange()},editor.TA_cursorToRight=function(t=1){return this.setSelectedRange(this.getSelectedRange()[0]+t,0),editor.activate(),this.getSelectedRange()},editor.TA_selectionExtendWord=function(){let[t,e]=this.getSelectedRange(),n=draft.content.substring(0,t),a;a="undefined"==n.TA_regexLastIndexOf(/[^a-zA-Z0-9_\-\–\—]/,t)?0:n.TA_regexLastIndexOf(/[^a-zA-Z0-9_\-\–\—]/,t)+1;let i=draft.content.substring(t,draft.content.length),r;return r=-1==i.TA_regexIndexOf(/[^a-zA-Z0-9_\-\–\—]/,0)?draft.content.length:i.TA_regexIndexOf(/[^a-zA-Z0-9_\-\–\—]/,0)+n.length,this.setSelectedRange(a,r-a),editor.activate(),this.getSelectedRange()},editor.TA_selectionDisplayCharacterCount=function(){let t="Selection contains "+this.getSelectedText().length+" character".TA_pluralise(this.getSelectedText().length)+".\n"+this.getSelectedText().TA_lengthExclLineBreaks()+" ignoring new lines.";return app.TA_msgInfo(t),t},editor.TA_selectionDisplayWordCount=function(){let t=this.getSelectedText().TA_countWords(),e="Selection contains "+t+" word".TA_pluralise(t)+".";return app.TA_msgInfo(e),e},editor.TA_selectionDisplayLineCount=function(){let t=this.getSelectedText().TA_countLines(),e="Selection contains "+t+" line".TA_pluralise(t)+".";return app.TA_msgInfo(e),e},editor.TA_selectionDisplayCount=function(){let t="Selection contains "+this.getSelectedText().length+" character".TA_pluralise(this.getSelectedText().length);t+=", "+this.getSelectedText().TA_lengthExclLineBreaks()+" ignoring new lines.";let e=this.getSelectedText().TA_countWords();return t+="\n\nSelection contains "+e+" word".TA_pluralise(e)+".",t+="\n\nSelection contains "+(e=this.getSelectedText().TA_countLines())+" line".TA_pluralise(e)+".",app.TA_msgInfo(t),t},editor.TA_cursorToStartOfNextSentence=function(){let t=editor.getSelectedRange()[0]+editor.getSelectedRange()[1],e=editor.getText().indexOf(".  ",t),n=editor.getText().indexOf(". ",t),a=editor.getText().indexOf("\n",t),i=editor.getText().length;return n>0&&n<=i&&(i=n+2),e>0&&e<=i+1&&(i=e+3),a>0&&a<i&&(i=a+1),editor.setSelectedRange(i,0),editor.activate(),this.getSelectedRange()[0]},editor.TA_cursorToStartOfPreviousSentence=function(){let t=editor.getSelectedRange()[0]+editor.getSelectedRange()[1],e=editor.getText().slice(0,t),n=e.lastIndexOf(".  ",t),a=e.lastIndexOf(". ",t),i=e.lastIndexOf("\n",t),r=0;return a>0&&a>=r&&(r=a-1),n>0&&n>=r+1&&(r=n-1),i>0&&i>r&&(r=i-1),n=(e=editor.getText().slice(0,r)).lastIndexOf(".  ",r),a=e.lastIndexOf(". ",r),i=e.lastIndexOf("\n",r),r=0,a>0&&a>=r&&(r=a+2),n>0&&n>=r+1&&(r=n+3),i>0&&i>r&&(r=i+1),editor.setSelectedRange(r,0),editor.activate(),this.getSelectedRange()[0]},editor.TA_cursorToStartOfCurrentSentence=function(){let t=editor.getSelectedRange()[0]+editor.getSelectedRange()[1],e=editor.getText().slice(0,t),n=e.lastIndexOf(".  ",t),a=e.lastIndexOf(". ",t),i=e.lastIndexOf("\n",t),r=0;return a>0&&a>=r&&(r=a+2),n>0&&n>=r+1&&(r=n+3),i>0&&i>r&&(r=i+1),editor.setSelectedRange(r,0),editor.activate(),this.getSelectedRange()[0]},editor.TA_selectionReduceLeft=function(t=1){return this.TA_selectionExtendLeft(-1*t)},editor.TA_selectionReduceRight=function(t=1){return this.TA_selectionExtendRight(-1*t)},editor.TA_selectedLinesPrefix=function(t){return this.TA_selectedLinesDelimit(t,"")},editor.TA_selectedLinesSuffix=function(t){return this.TA_selectedLinesDelimit("",t)},editor.TA_selectedLinesWrap=function(t){return this.TA_selectedLinesDelimit(t,t)},editor.TA_selectedLinesDelimit=function(t,e){this.TA_selectLine();let n=this.getSelectedText();return n=t+n.replaceAll("\n",e+"\n"+t)+e,this.setSelectedText(n),this.TA_cursorToSelectionEnd(),this.getSelectedRange()},editor.TA_prefixAllLines=function(t){let e=this.getText().split("\n");e.forEach(function(e,n){this[n]=t+e},e),this.setText(e.join("\n"))},editor.TA_prefixAllNonBlankLines=function(t){let e=this.getText().split("\n");e.forEach(function(e,n){""!=this[n].trim()&&(this[n]=t+e)},e),this.setText(e.join("\n"))},editor.TA_getCurrentLinesContent=function(){return this.getTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1])},editor.TA_setCurrentLinesContent=function(t){return this.setTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1],t)},editor.TA_lineMDHeader=function(){let[t,e]=this.getSelectedRange(),n=this.TA_getCurrentLinesContent(),a=n.match(/^(#*)/)[0],i="";n.startsWith(a+" ")&&(i=" ");let r=n.slice((a+i).length),o="";a.length<6&&(o="#"+a+" "),this.TA_setCurrentLinesContent(o+r),this.setSelectedRange(t+o.length-a.length-i.length,e),this.activate()},editor.TA_lineMDHeaderN=function(t){let[e,n]=this.getSelectedRange(),a=this.TA_getCurrentLinesContent(),i=a.match(/^(#*)/)[0],r="";a.startsWith(i+" ")&&(r=" ");let o=a.slice((i+r).length),s="#".repeat(t);t>0&&(s+=" "),this.TA_setCurrentLinesContent(s+o),this.setSelectedRange(e+s.length-i.length-r.length,n),this.activate()},editor.TA_getLine=function(){return this.getTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1])},editor.TA_copyLine=function(){return app.setClipboard(this.TA_getLine())},editor.TA_dictateDateTimeStampLogEntry=function(){return tadMisc.TA_logToDraftCurrent("","cursor",":\n","","%Y-%m-%d-%H.%M.%S")},editor.TA_append=function(t,e="\n"){let[n,a]=this.getSelectedRange();this.setText(this.getText()+e+t),this.setSelectedRange(n,a),this.activate()},editor.TA_prepend=function(t,e="\n"){let[n,a]=this.getSelectedRange(),i=t+e;this.setText(i+this.getText()),this.setSelectedRange(n+i.length,a),this.activate()},editor.TA_selectionPrependWords=function(t){this.setSelectedText(this.getSelectedText().TA_prependWords(t)),this.activate()},editor.TA_selectionAppendWords=function(t){this.setSelectedText(this.getSelectedText().TA_appendWords(t)),this.activate()},editor.TA_selectionWrapWords=function(t,e){this.setSelectedText(this.getSelectedText().TA_wrapWords(t,e))},editor.TA_selectionDelimitWords=function(t){this.setSelectedText(this.getSelectedText().TA_delimitWords(t))},editor.TA_isTextSelected=function(){return 0!=editor.getSelectedRange()[1]},editor.TA_extendedCopy=function(){return this.TA_isTextSelected()?app.setClipboard(this.getSelectedText()):app.setClipboard(this.TA_getCurrentLine()),app.getClipboard()},editor.TA_extendedCut=function(){return this.TA_isTextSelected()||this.TA_selectLine(),app.setClipboard(this.getSelectedText()),this.setSelectedText(""),app.getClipboard()},editor.TA_loadAcUUID=function(t){return this.TA_loadAc(Draft.find(t))},editor.TA_prependLinesRetainSelection=function(t){let e="",n="",[a,i]=this.getSelectedLineRange(),[r,o]=this.getSelectedRange();this.getTextInRange(a,i).endsWith("\n")&&(i-=1);let s=this.getTextInRange(a,i),l=r-a,d=this.getSelectedText().length,c=s.substring(0,l)+e+s.substring(l,l+d)+n+s.substring(l+d),h=(c=c.split("\n").map(e=>t+e).join("\n")).indexOf(e);r=a+h,o=(c=c.replace(e,"")).indexOf(n)-h,c=c.replace(n,""),this.setTextInRange(a,i,c),this.setSelectedRange(r,o)},editor.TA_unprependLinesRetainSelection=function(t){let e="",n="",[a,i]=this.getSelectedLineRange(),[r,o]=this.getSelectedRange();this.getTextInRange(a,i).endsWith("\n")&&(i-=1);let s=this.getTextInRange(a,i),l=r-a,d=this.getSelectedText().length,c=s.substring(0,l)+e+s.substring(l,l+d)+n+s.substring(l+d);(c=c.split("\n").map(e=>e.TA_startsWithRemove(t)).join("\n")).startsWith(e+t)&&(c=c.replace(e+t,e));let h=c.indexOf(e);r=a+h,o=(c=c.replace(e,"")).indexOf(n)-h,c=c.replace(n,""),this.setTextInRange(a,i,c),this.setSelectedRange(r,o)},editor.TA_appendLinesRetainSelection=function(t){let e="",n="",[a,i]=this.getSelectedLineRange(),[r,o]=this.getSelectedRange();this.getTextInRange(a,i).endsWith("\n")&&(i-=1);let s=this.getTextInRange(a,i),l=r-a,d=this.getSelectedText().length,c=s.substring(0,l)+e+s.substring(l,l+d)+n+s.substring(l+d),h=(c=c.split("\n").map(e=>e+t).join("\n")).indexOf(e);r=a+h,o=(c=c.replace(e,"")).indexOf(n)-h,c=c.replace(n,""),this.setTextInRange(a,i,c),this.setSelectedRange(r,o)},editor.TA_unappendLinesRetainSelection=function(t){let e="",n="",[a,i]=this.getSelectedLineRange(),[r,o]=this.getSelectedRange();this.getTextInRange(a,i).endsWith("\n")&&(i-=1);let s=this.getTextInRange(a,i),l=r-a,d=this.getSelectedText().length,c=s.substring(0,l)+e+s.substring(l,l+d)+n+s.substring(l+d),h=(c=c.split("\n").map(e=>e.TA_endsWithRemove(t)).join("\n")).indexOf(e);r=a+h,o=(c=c.replace(e,"")).indexOf(n)-h,c=c.replace(n,""),this.setTextInRange(a,i,c),this.setSelectedRange(r,o)},editor.TA_sectionGetContentByIndex=function(t){let e=editor.navigationMarkers,n=e[t];return t==e.length?void 0:t+1<e.length?editor.getTextInRange(n.location,e[t+1].location-n.location):editor.getTextInRange(n.location,editor.getText().length)},editor.TA_sectionGetContentByHeading=function(t,e=0){let n=editor.TA_sectionGetIndexesForHeading(t);if(e!=n.length)return editor.TA_sectionGetContentByIndex(parseInt(n[e]))},editor.TA_sectionGetIndexesForHeading=function(t){let e=[];return editor.navigationMarkers.forEach(function(n,a){editor.getTextInRange(n.location,n.length)==t&&e.push(a)}),e},editor.TA_sectionWrapByIndex=function(t,e,n){let a=[];return editor.navigationMarkers.forEach(function(i,r){if(r==n){let o=editor.getTextInRange(i.location,i.length),s=editor.TA_sectionGetContentByIndex(r).slice(o.length);a.push(o+t+s+e)}else a.push(editor.TA_sectionGetContentByIndex(r))}),a.join("")},editor.TA_sectionAppendByIndex=function(t,e){return editor.TA_sectionWrapByIndex("",t,e)},editor.TA_sectionPrependByIndex=function(t,e){return editor.TA_sectionWrapByIndex(t,"",e)},editor.TA_sectionWrapByHeading=function(t,e,n,a=0){let i=[],r=editor.TA_sectionGetIndexesForHeading(t)[a];return editor.navigationMarkers.forEach(function(t,a){if(a==r){let o=editor.getTextInRange(t.location,t.length),s=editor.TA_sectionGetContentByIndex(a).slice(o.length);i.push(o+e+s+n)}else i.push(editor.TA_sectionGetContentByIndex(a))}),i.join("")},editor.TA_sectionAppendByHeading=function(t,e,n=0){return editor.TA_sectionWrapByHeading(t,"",e,n)},editor.TA_sectionPrependByHeading=function(t,e,n=0){return editor.TA_sectionWrapByHeading(t,e,"",n)},editor.TA_sectionHeadingByIndex=function(t){return editor.navigationMarkers.length>t?editor.getTextInRange(editor.navigationMarkers[t].location,editor.navigationMarkers[t].length):void 0},editor.TA_sectionBodyByIndex=function(t){if(editor.navigationMarkers.length>t){let e=editor.getTextInRange(editor.navigationMarkers[t].location,editor.navigationMarkers[t].length);return editor.TA_sectionGetContentByIndex(t).slice(e.length)}},editor.TA_sectionBodyByHeading=function(t,e=0){let n=editor.TA_sectionGetIndexesForHeading(t);if(n.length>e){let a=n[e],i=editor.getTextInRange(editor.navigationMarkers[a].location,editor.navigationMarkers[a].length);return editor.TA_sectionGetContentByIndex(a).slice(i.length)}},editor.TA_sectionGetHeadings=function(){let t=[];return editor.navigationMarkers.forEach(function(e,n){t.push(editor.TA_sectionHeadingByIndex(n))}),t},editor.TA_processSelectedLinesFunctionRetain=function(t){return this.getSelectedText().TA_processLinesFunction(t)},editor.TA_processSelectedLinesFunctionReplace=function(t){this.setSelectedText(this.getSelectedText().TA_processLinesFunction(t))},editor.TA_processExtendedLinesFunctionRetain=function(t){let e="";return this.TA_getCurrentLine().endsWith("\n")&&(e="\n"),this.TA_getCurrentLineNoNewLine().TA_processLinesFunction(t)+e},editor.TA_processExtendedLinesFunctionReplace=function(t){let e="";this.TA_getCurrentLine().endsWith("\n")&&(e="\n"),this.TA_setCurrentLinesContent(this.TA_getCurrentLineNoNewLine().TA_processLinesFunction(t)+e)},editor.TA_taskpaperModifyCurrentLineTask=function(t,e){this.TA_replaceCurrentLine(this.TA_getCurrentLineNoNewLine().TA_taskpaperModifyTask(t,e)),this.TA_cursorToLineEnd()},editor.TA_taskpaperToggleCurrentLineTask=function(){return this.TA_taskpaperModifyCurrentLineTask(!1,!1)},editor.TA_taskpaperSetCurrentLineToTask=function(){return this.TA_taskpaperModifyCurrentLineTask(!0,!1)},editor.TA_taskpaperSetCurrentLineToNotTask=function(){return this.TA_taskpaperModifyCurrentLineTask(!1,!0)},editor.TA_taskpaperToggleSelectedTask=function(){function t(t){return t.TA_taskpaperModifyTask(!1,!1)}this.TA_processSelectedLinesFunctionReplace(t)},editor.TA_taskpaperToggleExtendedTask=function(){function t(t){return t.TA_taskpaperModifyTask(!1,!1)}this.TA_processExtendedLinesFunctionReplace(t)},editor.TA_taskpaperSetSelectedToTask=function(){function t(t){return t.TA_taskpaperModifyTask(!0,!1)}this.TA_processSelectedLinesFunctionReplace(t)},editor.TA_taskpaperSetExtendedToTask=function(){function t(t){return t.TA_taskpaperModifyTask(!0,!1)}this.TA_processExtendedLinesFunctionReplace(t)},editor.TA_taskpaperSetSelectedToNotTask=function(){function t(t){return t.TA_taskpaperModifyTask(!1,!0)}editor.TA_processSelectedLinesFunctionReplace(t)},editor.TA_taskpaperSetExtendedToNotTask=function(){function t(t){return t.TA_taskpaperModifyTask(!1,!0)}editor.TA_processExtendedLinesFunctionReplace(t)},editor.TA_taskpaperModifyCurrentLineProject=function(t,e){return this.TA_replaceCurrentLine(this.TA_getCurrentLineNoNewLine().TA_taskpaperModifyProject(t,e)),this.TA_cursorToLineEnd(),!1},editor.TA_taskpaperToggleCurrentLineProject=function(){return this.TA_taskpaperModifyCurrentLineProject(!1,!1)},editor.TA_taskpaperSetCurrentLineToProject=function(){return this.TA_taskpaperModifyCurrentLineProject(!0,!1)},editor.TA_taskpaperSetCurrentLineToNotProject=function(){return this.TA_taskpaperModifyCurrentLineProject(!1,!0)},editor.TA_taskpaperToggleSelectedProject=function(){function t(t){return t.TA_taskpaperModifyProject(!1,!1)}editor.TA_processSelectedLinesFunctionReplace(t)},editor.TA_taskpaperToggleExtendedProject=function(){function t(t){return t.TA_taskpaperModifyProject(!1,!1)}editor.TA_processExtendedLinesFunctionReplace(t)},editor.TA_taskpaperSetSelectedToProject=function(){function t(t){return t.TA_taskpaperModifyProject(!0,!1)}editor.TA_processSelectedLinesFunctionReplace(t)},editor.TA_taskpaperSetExtendedToProject=function(){function t(t){return t.TA_taskpaperModifyProject(!0,!1)}editor.TA_processExtendedLinesFunctionReplace(t)},editor.TA_taskpaperSetSelectedToNotProject=function(){function t(t){return t.TA_taskpaperModifyProject(!1,!0)}editor.TA_processSelectedLinesFunctionReplace(t)},editor.TA_taskpaperSetExtendedToNotProject=function(){function t(t){return t.TA_taskpaperModifyProject(!1,!0)}editor.TA_processExtendedLinesFunctionReplace(t)},editor.TA_lineSubstringWrapInsertion=function(t,e,n,a,i,r=!1){function o(o){let s="g";r&&(s="ig");let l=`(${t})(${e})(${n})`,d=RegExp(l,s);return o.replace(d,`$1${a}$2${i}$3`)}return this.TA_processExtendedLinesFunctionReplace(o)},editor.TA_lineSubstringWrapInsertions=function(t,e,n,a,i,r){function o(o){for(let s=0;s<t.length;s++){let l="g";r[s]&&(l="ig");let d=RegExp(`(${t[s]})(${e[s]})(${n[s]})`,l);o=o.replace(d,`$1${a[s]}$2${i[s]}$3`)}return o}return this.TA_processExtendedLinesFunctionReplace(o)},editor.TA_navigateToMarkerByName=function(t){let e=0;editor.navigationMarkers.forEach(function(n){n.label==t&&(e=n.location)}),editor.setSelectedRange(e,0)},editor.TA_processMDXLink=function(){let t=editor.getSelectedRange()[0],e=!1,n=!1,a=!1,i=!1,r=!1,o=!1,s=editor.getText().length,l=0,d=1;do l=t-d,t<d&&(a=!0),this.getTextInRange(l,d).startsWith("]]")&&(a=!0),this.getTextInRange(l,d).startsWith(")")&&(a=!0),this.getTextInRange(l,d).startsWith("[")&&(i=!0),(a||i)&&(r=!0),d++;while(!r);if(a)return app.TA_displayWarningMessage("No appropraite link found at cursor"),!1;{r=!1,d++;do l+d>s&&(o=!0),this.getTextInRange(l,d).endsWith("]]")&&(e=!0,o=!0),this.getTextInRange(l,d).includes("](")&&(n=!0),n&&this.getTextInRange(l,d).endsWith(")")&&(o=!0),d++;while(!o);d--;let c="";return e&&(this.setSelectedRange(l+1,d-3),c=this.getSelectedText()),n&&(this.setSelectedRange(l+1,d-2),c="url:"+this.getSelectedText().split("](")[1]),app.TA_processCrossLink(c),!0}},editor.TA_mergeSelectedLines=function(t=" ",e=!0,n=["-","—","–","/"],a=[]){let i=this.getSelectedText().TA_mergeLines(t,e,n,a);return this.setSelectedText(i),i},editor.TA_deletePreviousLine=function(){let[t,e]=this.getSelectedRange(),n=this.getSelectedLineRange()[0];if(!(n>0))return this.activate(),!1;{this.setSelectedRange(n-1,0);let[a,i]=this.getSelectedLineRange();return this.setTextInRange(a,i,""),this.setSelectedRange(t-i,e),this.activate(),!0}},editor.TA_deleteNextLine=function(){let[t,e]=this.getSelectedRange(),[n,a]=this.getSelectedLineRange();if(!(n+a<editor.getText().length))return this.activate(),!1;{this.setSelectedRange(n+a+1,0);let[i,r]=this.getSelectedLineRange();return this.setTextInRange(i,r,""),this.setSelectedRange(t,e),this.activate(),!0}},editor.TA_cutLine=function(){app.setClipboard(this.TA_getLine()),this.setTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1],""),this.TA_cursorToLineStart()},editor.TA_selectPreviousLine=function(){return this.TA_cursorToEndOfPreviousLine(),this.TA_selectLine()},editor.TA_selectNextLine=function(){return this.TA_cursorToStartOfNextLine(),this.TA_selectLine()},editor.TA_getPreviousLineContent=function(){let t=this.getText().slice(0,this.getSelectedLineRange()[0]).TA_stripFinalNewLine().split("\n");return 0==t.length?"":t[t.length-1]},editor.TA_getNextLineContent=function(){return this.getText().slice(this.getSelectedLineRange()[0]+this.getSelectedLineRange()[1]).split("\n")[0]},editor.TA_copyPreviousLine=function(){return app.setClipboard(this.TA_getPreviousLineContent())},editor.TA_copyNextLine=function(){return app.setClipboard(this.TA_getNextLineContent())},editor.TA_cutPreviousLine=function(){this.TA_copyPreviousLine(),this.TA_deletePreviousLine()},editor.TA_cutNextLine=function(){this.TA_copyNextLine(),this.TA_deleteNextLine()},editor.TA_moveLinesUp=function(){let[t,e]=this.getSelectedRange(),n=this.getSelectedLineRange()[0];if(!(n>0))return this.activate(),!1;{let a=this.TA_getCurrentLinesContent(),i=this.TA_getPreviousLineContent();return this.setTextInRange(n-i.length-1,i.length+a.length,a+i),this.setSelectedRange(t-i.length-1,e),this.activate(),!0}},editor.TA_moveLinesDown=function(){let[t,e]=this.getSelectedRange(),[n,a]=this.getSelectedLineRange();if(!(n+a<editor.getText().length))return this.activate(),!1;{let i=this.TA_getCurrentLinesContent(),r=this.TA_getNextLineContent();return this.setTextInRange(n,i.length+r.length,r+"\n"+i.TA_stripFinalNewLine()),this.setSelectedRange(t+r.length+1,e),this.activate(),!0}},editor.TA_moveLinesToStart=function(){let[t,e]=this.getSelectedRange(),[n,a]=this.getSelectedLineRange();if(!(n>0))return this.activate(),!1;{let i=this.TA_getCurrentLinesContent();return this.setTextInRange(n,a,""),this.setText(i+this.getText()),this.setSelectedRange(t-n,e),this.activate(),!0}},editor.TA_moveLinesToEnd=function(){let[t,e]=this.getSelectedRange(),[n,a]=this.getSelectedLineRange();if(!(n+a<editor.getText().length))return this.activate(),!1;{let i=this.TA_getCurrentLinesContent();return this.setTextInRange(n,a,""),this.setText(this.getText()+i),this.setSelectedRange(this.getText().length-a+(t-n),e),this.activate(),!0}},editor.TA_setCurrentLineNoNewLine=function(t){return this.TA_getCurrentLinesContent().endsWith("\n")?this.setTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1]-1,t):this.setTextInRange(this.getSelectedLineRange()[0],this.getSelectedLineRange()[1],t)},editor.TA_getSelectionWide=function(){return 0==this.getSelectedText().length?this.getText():this.getSelectedText()},editor.TA_cursorMoveAfterNextOpenMarker=function(t){let e=this.getSelectedRange()[0],n=this.getText().indexOf(t,e);return -1!=n?(this.setSelectedRange(n+t.length,0),this.activate(),!0):(this.activate(),!1)},editor.TA_cursorMoveBeforeNextCloseMarker=function(t){let e=this.getSelectedRange()[0];this.getTextInRange(e,t.length)==t&&(e+=t.length);let n=this.getText().indexOf(t,e);return -1!=n?(this.setSelectedRange(n,0),this.activate(),!0):(this.activate(),!1)},editor.TA_cursorMoveAfterPreviousOpenMarker=function(t){let e=this.getSelectedRange()[0];this.getTextInRange(e-t.length,t.length)==t&&(e=e-t.length-1);let n=this.getText().lastIndexOf(t,e);return -1!=n?(this.setSelectedRange(n+t.length,0),this.activate(),!0):(this.activate(),!1)},editor.TA_cursorMoveBeforePreviousCloseMarker=function(t){let e=this.getSelectedRange()[0],n=this.getText().slice(0,e).lastIndexOf(t,e);return -1!=n?(this.setSelectedRange(n,0),this.activate(),!0):(this.activate(),!1)},editor.TA_selectionReduceToStart=function(){return this.setSelectedRange(this.getSelectedRange()[0],0),this.getSelectedRange()[0]},editor.TA_selectionReduceToEnd=function(){return this.setSelectedRange(this.getSelectedRange()[0]+this.getSelectedRange()[1],0),this.getSelectedRange()[0]},editor.TA_replaceInSelection=function(t,e){return editor.setSelectedText(editor.getSelectedText().replaceAll(t,e))},editor.TA_getURLAtCursor=function(){function t(t){return!t||0===t.length||/^\s*$/.test(t)||"\n"==t}function e(t){return!!HTTP.create().request({url:t,method:"GET"}).success}let n=this.getSelectedRange(),a=n[0],i=n[0],r=this.getTextInRange(a,1),o=this.getTextInRange(i,1);for(;a>0&&!t(r);)a--,r=this.getTextInRange(a,1);for(a++;i<this.getText().length&&!t(o);)i++,o=this.getTextInRange(i,1);let s=this.getTextInRange(a,i-a);if(s.slice(0,-1).endsWith(")")&&(s=s.slice(0,-1)),s.includes('"'))s=s.split('"')[1];else if(s.includes("'"))s=s.split("'")[1];else if(s.endsWith(")")){let l=s.lastIndexOf("(")+1,d=s.length-1;s=s.substring(l,d)}if(s.includes("://")||e(s)||e("https://"+s)||e("http://"+s))return s},editor.TA_openURLAtCursor=function(){let t=this.TA_getURLAtCursor();return void 0==t?app.displayErrorMessage("No valid URL found at cursor"):app.openURL(t),t},editor.TA_textToLineStartIsMDListOrBlank=function(){let t=/^\s*[\-\+\*]\ ?$|^\s*\d+\.\ ?$|^\s*$/;return null!=this.TA_textToLineStart().match(t)},editor.TA_textToLineStart=function(){let t=this.getSelectedLineRange()[0];return this.getTextInRange(t,this.getSelectedRange()[0]-t)},editor.TA_textToLineEnd=function(){let t=this.getSelectedLineRange()[0]+this.getSelectedLineRange()[1]-1,e=this.getSelectedRange()[0]+this.getSelectedRange()[1];return this.getTextInRange(e,t-e)},editor.TA_indent=function(t){this.getSelectedText().includes("\n")?this.TA_prependLinesRetainSelection(t):this.TA_textToLineStartIsMDListOrBlank()?this.TA_prependLinesRetainSelection(t):this.TA_insertTextPosAtEnd(t)},editor.TA_unindent=function(t){this.TA_unprependLinesRetainSelection(t)},FileManager.prototype.TA_delete=function(t){return this.moveItem(t,null,!0)},FileManager.prototype.TA_snapshot=function(t){return this.copyItem(t,t.TA_folderPathFromPath()+tadMisc.TA_getTimestampyyyyMMddhhmmss()+" "+t.TA_fileNameFromPath(),!0)},FileManager.prototype.TA_fileMetaPath=function(){draft.TA_metaRead();let t="/";void 0!=draft.meta.filePath&&(t=draft.meta.filePath);let e=Prompt.TA_singleTextFieldPrompt("Set File Path","Enter the Drafts iCloud file path for draft:\n"+draft.uuid,"Path",t);return""==e?e:(draft.meta.filePath=e,draft.TA_metaWrite(),t)},FileManager.prototype.TA_fileMetaSave=function(){if(draft.TA_metaRead(),void 0==draft.meta.filePath)return app.TA_displayErrorMessage("File path not specified"),!1;{let t=this.writeString(draft.meta.filePath,draft.content);return t||app.TA_displayErrorMessage(`Could not write to path "${draft.meta.filePath}"`),t}},FileManager.prototype.TA_fileMetaLoad=function(){return(draft.TA_metaRead(),void 0!=draft.meta.filePath)?(draft.saveVersion(),draft.content=this.readString(draft.meta.filePath),draft.update(),draft.content):(app.TA_displayErrorMessage("File path not specified"),"")},FileManager.prototype.TA_listFilesRegex=function(t,e){let n=[];return app.displayInfoMessage("Retrieving matching files..."),this.listContents(t).forEach(function(t){!t.endsWith("/")&&null!=t.split("/").slice(-1)[0].match(e)&&n.push(t)}),n};class TadHTMLPrompt{constructor(){this.title="",this.hideInterface=!0,this.buttonSubmit='<button id="sub" onclick="submitFormById(\'tad-fd\'); return false;">Submit</button>',this.buttonCancel='<button id ="cancel" onclick="Drafts.cancel(); return false;">Cancel</button>',this.html=`<!DOCTYPE html>
        <html dir="auto">

        <head>
    <title>[[tadpreview_title]]</title>
    <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1">
          <style>
            [[tadpreview_css]]
          </style>
        </head>
  <body>
   <form id="tad-fd" autocomplete="off" autocorrect="off">
    [[tadpreview_content]]

    <div style="margin: 1em 0 3em 0;">
    [[tadpreview_submit]]
    [[tadpreview_cancel]]
    </div>
   </form>
  </body>
        <script>
 function serialiseForm(p_objForm)
 {
  //Initialise
  let objData = {};

  //Add returnable items to the data object
  for(let element of p_objForm.elements)
  {
   if (element.type && element.type === 'checkbox')
   {
    objData[element.id] = element.checked;
   }
   else if (element.type == 'submit')
   {
    //Ignore
   }
   else
   {
    objData[element.id] = element.value;
   }
  }

  //Return the data object
  return objData;
 };

 function submitFormById(p_strFormID)
 {
  //Get the form
  let objForm = document.getElementById(p_strFormID);

  //Transform all of the returnable form elements into an object
  let objData = serialiseForm(objForm);

  //Send the object to Drafts and return a continue code
  Drafts.send("formValues", objData);
  Drafts.continue();
  return;
 }


  function checkKeyPress(p_objKey)
 {
  if (p_objKey.keyCode == '13') submitFormById('tad-fd');
  return false;
  }


 //document.onkeydown = checkKeyPress;
</script>

</html>`,this.css=`@charset "utf-8";

        :root {
   --main-bg-color: white;
   --main-color: black;
   --alternate-bg-color: #efefef;
   --alternate-color: #222222;
   --main-border-color: #BBBBBB;
     --link-color: #627EC9;
    }

    @media (prefers-color-scheme: dark) {
   :root {
     --main-bg-color: #222222;
     --main-color: #53C8D6;
     --alternate-bg-color: #444444;
     --alternate-color: #cccccc;
     --main-border-color: #AAAAAA;
    --link-color: #627EC9;
   }
    }

        html {
          font-size: 100%;
          font-family: -apple-system, BlinkMacSystemFont, "helvetica neue", helvetica, roboto, noto, "segoe ui", arial, sans-serif;
          line-height: 1.4;
        }

        body {
          margin: 0;
          padding: 1em;
          background-color: var(--main-bg-color);
          color: var(--main-color);
        }

        @media (max-device-width: 480px) {}

        @media (min-device-width: 481px) {
          body {
            margin: auto;
            max-width: 600px;
          }
        }

        blockquote {
          font-style: italic;
          margin: 1.5em 2em;
          padding: 1em;
          background-color: var(--alternate-bg-color);
          color: var(--alternate-color);
        }

        a {
          color: var(--link-color);
        }
        pre {
          display: block;
          overflow: scroll;
          width: 100%;
          background-color: var(--alternate-bg-color);
          padding: .5em 1em;
          margin: 1em 0;
        }

        code {
          background-color: var(--alternate-bg-color);
          color: var(--alternate-color);
          font-family: Menlo, Courier, sans-serif;
          padding: 2px 3px;
        }

        table {
          margin: 1.5em 0;
          border: 1px solid var(--main-border-color);
          border-collapse: collapse;
        }

        th {
          padding: .25em .5em;
          background: var(--alternate-bg-color);
          border: 1px solid var(--main-border-color);
        }

        td {
          padding: .25em .5em;
          border: 1px solid var(--main-border-color);
        }

        img {
          max-width: 90%;
        }

        form {
           padding: 1em;
        }`,this.content=""}TA_show(){draft.setTemplateTag("tadpreview_submit",this.buttonSubmit),draft.setTemplateTag("tadpreview_cancel",this.buttonCancel),draft.setTemplateTag("tadpreview_title",this.title),draft.setTemplateTag("tadpreview_css",this.css),draft.setTemplateTag("tadpreview_content",this.content);let t=new HTMLPreview;return(t.hideInterface=this.hideInterface,t.show(draft.processTemplate(this.html)))?context.previewValues.formValues:void 0}TA_dropDown(t,e){let n="";e.forEach(function(t){n+=`<option value="${t}">${t}</option>`}),this.content=`
  <p>
   <label for="listing">${t}</label>
   <select id="listing">
    ${n}
   </select>
  </p>
  `;let a=this.TA_show();return void 0!=a?a.listing:""}TA_filterField(t,e){let n="";e.forEach(function(t){let e=t.replaceAll("`","&#96;");e=t.replaceAll("`","&apos;"),n+=`astrItems.push("${e=t.replaceAll('"',"&quot;")}");
`}),this.content=`
  <style>
* {
  box-sizing: border-box;
}

body {
  font: 16px Arial;
}

/*the container must be positioned relative:*/
.autocomplete {
  position: relative;
  display: inline-block;
}

input {
  border: 1px solid transparent;
  background-color: #f1f1f1;
  padding: 10px;
  font-size: 16px;
}

input[type=text] {
  background-color: #f1f1f1;
  width: 100%;
}

input[type=submit] {
  background-color: DodgerBlue;
  color: #fff;
  cursor: pointer;
}

.autocomplete-items {
  position: absolute;
  border: 1px solid #d4d4d4;
  border-bottom: none;
  border-top: none;
  z-index: 99;
  /*position the autocomplete items to be the same width as the container:*/
  top: 100%;
  left: 0;
  right: 0;
}

.autocomplete-items div {
  padding: 10px;
  cursor: pointer;
  background-color: #fff;
  border-bottom: 1px solid #d4d4d4;
}

/*when hovering an item:*/
.autocomplete-items div:hover {
  background-color: #e9e9e9;
}

/*when navigating through the items using the arrow keys:*/
.autocomplete-active {
  background-color: DodgerBlue !important;
  color: #ffffff;
}
</style>

  <div class="autocomplete" style="width:300px;">
   <label for="filterList">${t}</label>
    <input id="filterList" type="text" placeholder="Type to search..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" autofocus>
  </div>

<script>
function autocomplete(inp, arr)
{
 //The autocomplete function takes two arguments, the text field element and an array of possible autocompleted values
 let currentFocus;
 //Execute a function when someone writes in the text field
 inp.addEventListener("input", function(e)
 {
  var a, b, i, val = this.value;

  //close any already open lists of autocompleted values
  closeAllLists();

  if (!val)
  {
   return false;
  }

  currentFocus = -1;

  //Create a DIV element that will contain the items (values)
  a = document.createElement("DIV");
  a.setAttribute("id", this.id + "autocomplete-list");
  a.setAttribute("class", "autocomplete-items");

  //Append the DIV element as a child of the autocomplete container
  this.parentNode.appendChild(a);

  //For each item in the array...
  for (i = 0; i < arr.length; i++)
  {
   //Check if the item starts with the same letters as the text field value
   if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase())
   {
    //Create a DIV element for each matching element
    b = document.createElement("DIV");

    //Make the matching letters bold
    b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
    b.innerHTML += arr[i].substr(val.length);

    //Insert a input field that will hold the current array item's value
    b.innerHTML += "<input type='hidden' value='" + arr[i].replaceAll("'", "&apos;").replaceAll('"', "&quot;") + "'>";

    //Execute a function when someone clicks on the item value (DIV element)
    b.addEventListener("click", function(e)
    {
     //insert the value for the autocomplete text field
     inp.value = this.getElementsByTagName("input")[0].value;

     //Close the list of autocompleted values, (or any other open lists of autocompleted values
     closeAllLists();
    });

    a.appendChild(b);
   }
  }
 });

 //Execute a function presses a key on the keyboard
 inp.addEventListener("keydown", function(e)
 {
  let x = document.getElementById(this.id + "autocomplete-list");
  if (x) x = x.getElementsByTagName("div");
  if (e.keyCode == 40)
  {
   //If the arrow DOWN key is pressed, increase the currentFocus variable and and make the current item more visible
   currentFocus++;
   addActive(x);
  }
  else if (e.keyCode == 38)
  {
   //If the arrow UP key is pressed, decrease the currentFocus variable and and make the current item more visible
   currentFocus--;
   addActive(x);
  }
  else if (e.keyCode == 13)
  {
   //If the ENTER key is pressed, prevent the form from being submitted as a standard submission (immediately)
   e.preventDefault();
   if (currentFocus > -1)
   {
    //Simulate a click on the "active" item
    if (x) x[currentFocus].click();
   }
  }

 });

 function addActive(x)
 {
  //A function to classify an item as "active"
  if (!x) return false;

  //Start by removing the "active" class on all items
  removeActive(x);
  if (currentFocus >= x.length) currentFocus = 0;
  if (currentFocus < 0) currentFocus = (x.length - 1);

  //Add class "autocomplete-active"
  x[currentFocus].classList.add("autocomplete-active");
 }

 function removeActive(x)
 {
  //A function to remove the "active" class from all autocomplete items
  for (let i = 0; i < x.length; i++)
  {
   x[i].classList.remove("autocomplete-active");
  }
 }

 function closeAllLists(elmnt)
 {
  //Close all autocomplete lists in the document, except the one passed as an argument
  let x = document.getElementsByClassName("autocomplete-items");
  for (let i = 0; i < x.length; i++)
  {
   if (elmnt != x[i] && elmnt != inp)
   {
    x[i].parentNode.removeChild(x[i]);
   }
  }
 }

 // Execute a function when someone clicks in the document
 document.addEventListener("click", function(e)
 {
  closeAllLists(e.target);
 });

 // Get the input field
 var input = document.getElementById("filterList");

 // Execute a function when the user releases a key on the keyboard
 input.addEventListener("keyup", function(event)
 {
  // Number 13 is the "Enter" key on the keyboard
  if (event.keyCode === 13)
  {
   // Cancel the default action, if needed
   event.preventDefault();
   // Trigger the button element with a click
   document.getElementById("sub").click();
  }
 });
}

let astrItems = [];
//There could be a lot of entries, so theey are added via separate push statements
//Limits on string length can otherwise be too easily reached.
${n}

//Initiate the autocomplete function on the "filterList" element, and pass along the astrItems array as possible autocomplete values
autocomplete(document.getElementById("filterList"), astrItems);
</script>
  `;let a=this.TA_show();return void 0!=a?a.filterList:""}TA_textFields(t){let e="";return t.forEach(function(t){e+=` <label for="${t[1]}">${t[0]}</label>
  <input id="${t[1]}" type="text" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"><br>
`}),this.content=`<p>${e}</p>`,this.TA_show()}TA_textFieldLarge(t,e=-1,n=-1,a=""){let i="count_up",r=" characters entered.",o="",s="0";e>-1&&(i="count_down",r=" characters remaining.",o=` maxlength="${e}"`,s=e.toString());let l=n;-1==n&&(l=.1*e),this.content=`
  <style>
   .grey
   {
    font-size: 0.5em;
    color: grey;
   }
  </style>
  <p>
  <label for="largefield">${t}</label><br>
  <span class="grey"><span id="counter">${s}</span>${r}</span><br>
  <textarea id="largefield" style="height: 50vh; width: 55vw;" onkeyup="${i}(this);"${o}>${a}</textarea>
  <br>

  </p>

  <script>
  function count_up(obj)
  {
   document.getElementById('counter').innerHTML = obj.value.length;
  }

  function count_down(obj)
  {
   const MAX = ${e};
   let element = document.getElementById('counter');
   element.innerHTML = MAX - obj.value.length;
   if (MAX - obj.value.length < ${l}) element.style.color = 'red';
   else element.style.color = 'grey';
  }

  count_down(document.getElementById("largefield"));
  </script>`;let d=this.TA_show();if(void 0!=d)return d.largefield}TA_message(t){this.content=t,this.buttonSubmit="",this.buttonCancel='<button id ="cancel" onclick="Drafts.cancel(); return false;">OK</button>',this.TA_show()}TA_draft(t=null,e="Content",n=-1,a=-1){let i="count_up",r=" characters entered.",o="",s="0";n>-1&&(i="count_down",r=" characters remaining.",o=` maxlength="${n}"`,s=n.toString());let l=a;-1==a&&(l=.1*n);let d;d=null==t?new Draft:t;let c=[];d.TA_tagFetchAll().forEach(function(t){let e="";d.tags.includes(t)&&(e=" checked"),c.push(`<input type="checkbox" id="tag_${t}" name="tag_${t}" value="${t}"${e}><label for="tag_${t}">${t}</label>`)});let h="";d.isFlagged&&(h=" checked");let u="",p="";this.content=`
  <style>
   .grey
   {
    font-size: 0.5em;
    color: grey;
   }
  </style>
  <p>
  <label for="largefield">${e}</label><br>
  <span class="grey"><span id="counter">${s}</span>${r}</span><br>
  <textarea id="largefield" style="height: 50vh; width: 55vw;" onkeyup="${i}(this);"${o}>${d.content}</textarea>

  <div style="margin: 1em 0 1em 0;">
   <input type="checkbox" id="flagged" name="flagged" value="flagged"${h}><label for="flagged">&#9873;</label>&nbsp;
   <!-- <input type="checkbox" id="archived" name="archived" value="archived"${u}><label for="archived">&#128451;</label>&nbsp;
   <input type="checkbox" id="trashed" name="trashed" value="trashed"${p}><label for="trashed">&#128465;</label>&nbsp; -->
   <br>
   ${this.buttonSubmit}
   ${this.buttonCancel}
  </div>

  </p>

  <p>
  <details>
  <summary>Expand for Tags</summary>
  ${c.join("<br>\n")}
  <br>&nbsp;<br>
  <label for="new_tags">Comma Separated Tags:</label><input type="text" id="new_tags" name="new_tags">
  </details>

  </p>

  <script>
  function count_up(obj)
  {
   document.getElementById('counter').innerHTML = obj.value.length;
  }

  function count_down(obj)
  {
   const MAX = ${n};
   let element = document.getElementById('counter');
   element.innerHTML = MAX - obj.value.length;
   if (MAX - obj.value.length < ${l}) element.style.color = 'red';
   else element.style.color = 'grey';
  }

  count_up(document.getElementById("largefield"));
  </script>`;let T=this.TA_show();if(void 0!=T){for(let[g,f]of(d.isFlagged=T.flagged,d.content=T.largefield,Object.entries(T)))g.startsWith("tag_")&&(f?d.addTag(g.TA_startsWithRemove("tag_")):d.removeTag(g.TA_startsWithRemove("tag_")));T.new_tags.split(",").forEach(function(t){d.addTag(t.trim())}),d.update()}}}HTTP.prototype.TA_getContent=function(t){let e=this.request({url:t,method:"GET"});return e.success?e.responseText:(console.log(e.statusCode),console.log(e.error),"")},HTTP.prototype.TA_getSyntaxTest=function(t){let e="https://raw.githubusercontent.com/sylumer/drafts_syntax_tests/master/",n="txt";return this.TA_getContent(e+encodeURI(t)+"."+n)},HTTP.prototype.TA_isValidURL=function(t){return!!RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(t)||(console.TA_logError("Invalid URL = "+t),!1)},HTTP.prototype.TA_getURLContentClipboard=function(){if(this.TA_isValidURL(app.getClipboard()))return this.TA_getContent(app.getClipboard())},HTTP.prototype.TA_getTitleFromURL=function(t){let e=this.request({url:t,method:"GET"});if(e.success)return e.responseText.TA_htmlTitle().trim();console.log("Attempting to fetch title for URL: "+t),console.log(e.statusCode),console.log(e.error)},HTTP.prototype.TA_mdTitleLinkFromURL=function(t){return"["+this.TA_getTitleFromURL(t)+"]("+t+")"},HTTP.prototype.TA_getContentToiCloudFile=function(t,e){return FileManager.createCloud().writeString(e,this.TA_getContent(t))},HTTP.prototype.TA_getContentToLocalFile=function(t,e){return FileManager.createLocal().writeString(e,this.TA_getContent(t))},HTTP.prototype.TA_downloadLibrary=function(t,e){FileManager.createCloud().createDirectory("Scripts","/Library/");let n=e;return!1==n.endsWith(".js")&&(n+=".js"),this.TA_getContentToiCloudFile(t,"/Library/Scripts/"+n)},HTTP.prototype.TA_updateBeautifierLibrary=function(){return this.TA_downloadLibrary(tadLib.beautifierURL,tadLib.beautifierLibName)},HTTP.prototype.TA_updateTadpoleLibrary=function(){return this.TA_downloadLibrary(tadLib.libSourceURL,tadLib.libName)},HTTP.prototype.TA_getExternalIP=function(){return this.TA_getContent("https://api.ipify.org/?format=text")},HTTP.prototype.TA_randomInteger=function(t,e){return Number(JSON.parse(this.TA_getContent(`https://csrng.net/csrng/csrng.php?min=${t}&max=${e}`))[0].random)},HTTP.prototype.TA_quoteSimpsons=function(){let t="https://thesimpsonsquoteapi.glitch.me/quotes",e=JSON.parse(this.TA_getContent(t));return e[0].quote+" ["+e[0].character+"]"};class TadInfo{constructor(){}TA_versionInfo(t=""){let e=t+"Drafts Version:"+t+" "+app.version+"\n";return e+=t+"OS Version:"+t+" "+device.systemName+" "+device.systemVersion+"\n",e+=t+"Device:"+t+" "+device.model+"\n",e+=t+"Pro Licensed:"+t+" ",app.isPro?e+="Yes":e+="No",e}TA_versionTemplateTags(){draft.setTemplateTag("version",app.version),app.isPro?draft.setTemplateTag("ispro","Pro"):draft.setTemplateTag("ispro","Free"),draft.setTemplateTag("systemname",device.systemName),draft.setTemplateTag("systemversion",device.systemVersion),draft.setTemplateTag("model",device.model)}}var tadInfo=new TadInfo;class TadLibrary{constructor(){let t="20210508";this.libSourceURL="https://tadpole.thoughtasylum.com/assets/library/tad.js",this.libName="tad",this.settingsPath="/Library/Scripts/tad.json",this.dataPath="/Library/Scripts/tad-data.json",this.metaPath="/Library/Scripts/tad-meta.json",this.runTag="#run#",this.runArea="inbox",this.runSyntax="JavaScript",this.runTagScript="javascript",this.beautifierURL="https://tadpole.thoughtasylum.com/assets/library/beautifier.js",this.beautifierLibName="beautifier",this.beautifierSettings="beautifier.json",this.cryptoURL="https://tadpole.thoughtasylum.com/assets/library/crypto-js.js",this.cryptoLibName="crypto-js",this.taskBasicStart="- [",this.taskBasicComplete="x",this.taskBasicIncomplete=" ",this.taskBasicEnd="] ",this.taskBasicSyntax="Simple List",this.buttonLabelTruncation=32,this.debugEnabled=!1,this.consoleDebugMarker="\uD83D\uDC1E ",this.consoleInfoMarker="\uD83D\uDCA1 ",this.consoleWarnMarker="⚠️ ",this.consoleErrorMarker="⛔️ ",this.consoleSuccessMarker="✅️ ",this.msgTitleInfo="\uD83D\uDCA1 INFORMATION \uD83D\uDCA1",this.msgTitleWarn="⚠️ WARNING ⚠️",this.msgTitleError="⛔️ ERROR ⛔️",this.msgTitleDebug="\uD83D\uDC1E ⒹⒺⒷⓊⒼ \uD83D\uDC1E",this.separatorDateStamp="-",this.separatorDateTimeStamp="-",this.separatorTimeStamp=".",this.templateFilter="archive",this.templateTags=["template"],this.draft_discourse={tags:["Discourse"],syntax:"MultiMarkdown",extension:"mmd"},this.draft_javascript={tags:["javascript"],syntax:"JavaScript",extension:"js"},this.draft_markdown={tags:[],syntax:"Markdown",extension:"md"},this.draft_multimarkdown={tags:[],syntax:"MultiMarkdown",extension:"mmd"},this.draft_taskpaper={tags:[],syntax:"Taskpaper",extension:"taskpaper"},this.draft_plain_text={tags:[],syntax:"Plain Text",extension:"txt"},this.draft_simple_list={tags:[],syntax:"Plain Text",extension:"txt"},this.draft_github_markdown={tags:[],syntax:"GitHub Markdown",extension:"mmd"},this.backlink_sectionstart="---\n**BACK LINKS**  \n  ",this.backlink_sectionend="---\n",this.backlink_prefix="- ",this.backlink_suffix="",this.backlink_delimiter="\n",this.duplicateLinesDefault=5,this.encodeMap={"!":"%21","'":"%27","(":"%28",")":"%29","*":"%2A","~":"%7E"},this.commands={url:"OPEN_URL|<1>",actdir:"OPEN_URL|https://actions.getdrafts.com",cbdic:"RUN_ACTION|TAD-Dictate-to-clipboard",act:"RUN_ACTION|<1>",ws:"RUN_FUNCTION|app.TA_applyWorkspaceByName",wsc:"RUN_FUNCTION|Workspace.TA_selectLoadWorkspaceByButton",tag:"RUN_FUNCTION|draft.TA_tagAddCSV"},this.actions={info:{"Display Library Settings":"TAD-Display Settings","Display System & App Settings":"TAD-Display Drafts and System Information"}},this.testLibsEnable=!1,this.testLibsAlert=!0,this.testLibsListPath="/Library/Scripts/tad-testlibs.txt",this.TA_libraryInitialise();let e=new Date;this.version=t,this.authors=["Stephen Millard"],this.source="https://www.thoughtasylum.com/",this.copyrightPeriod="2018 - "+e.getFullYear(),this.copyright="Copyright "+this.copyrightPeriod+": "+this.authors.join(", ")+" (ThoughtAsylum).",this.testLibsEnable&&this.TA_libraryTestLibLoad()}TA_libraryInitialise(){let t=FileManager.createCloud(),e=t.readJSON(this.settingsPath);if(void 0===e)t.writeJSON(this.settingsPath,this);else{let n=this;n=Object.assign(n,e)}}TA_libraryTestLibLoad(){let t=FileManager.createCloud().readString(this.testLibsListPath),e;for(let n of t.split("\n"))if(n.length>0){let a=n.replace("\n","");require(a=(a=a.replace("\r","")).replace("\f",""))}return this.testLibsAlert&&app.displayInfoMessage("--- Testing Libraries Loaded ---"),e=!0}TA_save(){return FileManager.createCloud().writeJSON(this.settingsPath,this)}TA_getSettingsLoaded(){let t=[];for(var e in this)t.push(e+"="+this[e]);return(t=t.sort()).join("\n")}TA_getSettingsSavedJSON(){let t=FileManager.createCloud().readString(this.settingsPath);return void 0===t?"":t}TA_displaySettingsLoaded(){let t=this.TA_getSettingsLoaded();return app.TA_msgInfo(t),t}TA_displaySettingsLoadedJSON(){let t=JSON.stringify(this);return app.TA_msgInfo(t),t}TA_displaySettingsSavedJSON(){let t=this.TA_getSettingsSavedJSON();return app.TA_msgInfo(t),t}TA_displaySettings(){let t;switch(Prompt.TA_promptButtonArray("TADpoLe Settings","Choose information to display",["Loaded Settings (Text)","Loaded Settings (JSON)","Saved Settings (JSON)",])){case"Loaded Settings (Text)":t=tadLib.TA_displaySettingsLoaded();break;case"Loaded Settings (JSON)":t=tadLib.TA_displaySettingsLoadedJSON();break;case"Saved Settings (JSON)":t=tadLib.TA_displaySettingsSavedJSON()}return t}TA_copySettingsLoaded(){let t=this.TA_getSettingsLoaded();return app.setClipboard(t),t}TA_copySettingsLoadedJSON(){let t=JSON.stringify(this);return app.setClipboard(t),t}TA_copySettingsSavedJSON(){let t=this.TA_getSettingsSavedJSON();return app.setClipboard(t),t}TA_copySettings(){let t;switch(Prompt.TA_promptButtonArray("TADpoLe Settings","Choose information to copy to clipboard",["Loaded Settings (Text)","Loaded Settings (JSON)","Saved Settings (JSON)",])){case"Loaded Settings (Text)":t=tadLib.TA_copySettingsLoaded();break;case"Loaded Settings (JSON)":t=tadLib.TA_copySettingsLoadedJSON();break;case"Saved Settings (JSON)":t=tadLib.TA_copySettingsSavedJSON()}return t}TA_buildLibraryAction(){let t="drafts://action?data=",e=FileManager.createCloud().readString("/Library/Scripts/tad.js"),n={};n.platforms=3,n.type="script",n.isEnabled=!0,n.uuid="A0E1974C-F0B2-4DEF-860D-934BD3B9C041",n.data={},n.data.allowAsync="false",n.data.script=e;let a={};a.optionKey=!1,a.input="",a.controlKey=!1,a.commandKey=!1,a.type="action",a.discoverabilityTitle="TAD-Library",a.shiftKey=!1;let i={};i.uuid="31D93149-34A7-47B4-AD7F-4B2FB635E7DE",i.steps=[],i.steps.push(n),i.backingPlatforms=3,i.shortName="",i.shouldConfirm=!1,i.disposition=0,i.keyCommand=a,i.logLevel=1,i.groupDisposition=0,i.notificationType=1,i.tintColor="gray",i.actionDescription="An action copy of the tad.js library file.",i.keyUseIcon=!1,i.icon="667-gear3",i.visibility=480,i.backingIsSeparator=!1,i.groupUUID="54ADF94F-8F6B-4477-947C-175000317F7B",i.assignTags=[],i.name="TAD-Library";let r=JSON.stringify(i);app.openURL(t+encodeURIComponent(r))}TA_versionOnline(){return parseInt(HTTP.create().TA_getContent("https://tadpole.thoughtasylum.com/assets/library/tad-ver.txt"))}TA_displayVersionInfo(){let t=this.TA_versionOnline(),e=parseInt(this.version),n=`You have version ${e} installed.<br>
The latest version available version is ${t}.`,a="";return a=e<t?"New Version Available":e==t?"Version is Up To Date":"Local Version is Newer",new TadHTMLPrompt().TA_message(`<img style="float: left; margin: 0px 15px 15px 0px;" src="https://tadpole.thoughtasylum.com/assets/images/logo.png" width=200px>
        <h2>${a}</h2>
        <p>${n}</p>`)}}var tadLib=new TadLibrary;Math.TA_randInt=function(t,e){let n=Math.floor(t),a=Math.floor(e);return Math.floor(Math.random()*(a-n+1))+n},Math.TA_frac=function(t){let e=t.toLocaleString().split(tadMisc.TA_decimalSeparator());if(1==e.length)return 0;let n="0."+e[e.length-1];return t<0?parseFloat("-"+n):parseFloat(n)},Math.TA_isOneIn=function(t){return Math.floor(Math.random()*t)+1==1},Math.TA_integerToRoman=function(t,e=!0){let n=["","c","cc","ccc","cd","d","dc","dcc","dccc","cm","","x","xx","xxx","xl","l","lx","lxx","lxxx","xc","","i","ii","iii","iv","v","vi","vii","viii","ix",],a=t.toString().split(""),i="",r=3;for(;r--;)i=(n[+a.pop()+10*r]||"")+i;return i=Array(+a.join("")+1).join("m")+i,e&&(i=i.toUpperCase()),i};class TadMiscellaneous{constructor(){return}TA_getTimestampyyyyMMddhhmmss(){let t=new Date,e=""+t.getFullYear(),n=(""+(t.getMonth()+1)).padStart(2,"0"),a=(""+t.getDate()).padStart(2,"0"),i=(""+t.getHours()).padStart(2,"0"),r=(""+t.getMinutes()).padStart(2,"0"),o=(""+t.getSeconds()).padStart(2,"0");return e+tadLib.separatorDateStamp+n+tadLib.separatorDateStamp+a+tadLib.separatorDateTimeStamp+i+tadLib.separatorTimeStamp+r+tadLib.separatorTimeStamp+o}TA_getTimestampyyyyMMddhhmmssxxx(){let t=new Date,e=""+t.getFullYear(),n=(""+(t.getMonth()+1)).padStart(2,"0"),a=(""+t.getDate()).padStart(2,"0"),i=(""+t.getHours()).padStart(2,"0"),r=(""+t.getMinutes()).padStart(2,"0"),o=(""+t.getSeconds()).padStart(2,"0"),s=(""+t.getMilliseconds()).padStart(3,"0");return e+tadLib.separatorDateStamp+n+tadLib.separatorDateStamp+a+tadLib.separatorDateTimeStamp+i+tadLib.separatorTimeStamp+r+tadLib.separatorTimeStamp+o+tadLib.separatorTimeStamp+s}TA_repeatEvaluation(p_strToEvaluate,p_intTimes){for(let intCount=0;intCount<p_intTimes;intCount++)eval(p_strToEvaluate)}TA_ordinalDay(t){let e=Math.trunc(t),n=[];return(n.n1="first",n.n2="second",n.n3="third",n.n4="fourth",n.n5="fifth",n.n6="sixth",n.n7="seventh",n.n8="eighth",n.n9="ninth",n.n10="tenth",n.n11="eleventh",n.n12="twelfth",n.n13="thirteenth",n.n14="fourteenth",n.n15="fifteenth",n.n16="sixteenth",n.n17="seventeenth",n.n18="eighteenth",n.n19="nineteenth",n.n20="twentieth",n.n21="twenty first",n.n22="twenty second",n.n23="twenty third",n.n24="twenty fourth",n.n25="twenty fifth",n.n26="twenty sixth",n.n27="twenty seventh",n.n28="twenty eighth",n.n29="twenty ninth",n.n30="thirtieth",n.n31="thirty first",e>31||e<1)?e.toString():n["n"+e]}TA_sleepMS(t){let e=new Date().getTime(),n=!0;for(;n;)new Date().getTime()-e>=t&&(n=!1)}TA_sleep(t){return tadMisc.TA_sleepMS(1e3*t)}TA_sleepMSDisplay(t,e,n="",a=""){let i=new Date().getTime(),r=!0,o=0,s=0;for(;r;){let l=Math.trunc((o=new Date().getTime()-i)/1e3),d=Math.trunc(o/e);o>=t&&(r=!1),d>s&&app.displayInfoMessage(n+l+a),s=d}}TA_devLoadRunDraft(){let t=Draft.query("",tadLib.runArea,[tadLib.runTag],[],"modified",!1,!1);if(0!=t.length)return editor.load(t[0]),editor.activate(),t[0].uuid;app.displayErrorMessage("No drafts found with tag '"+tadLib.runTag+"' in "+tadLib.runArea)}TA_devSetRunDraft(){return Draft.query("",tadLib.runArea,[tadLib.runTag]).forEach(function(t){draft.uuid!==t.uuid&&(t.removeTag(tadLib.runTag),t.update())}),draft.TA_setSyntaxByName(tadLib.runSyntax),draft.addTag(tadLib.runTag),draft.addTag(tadLib.runTagScript),draft.update(),editor.load(Draft.create()),editor.load(draft),draft.uuid}TA_devExecuteRunDraft(){let allRunDrafts=Draft.query("",tadLib.runArea,[tadLib.runTag],[],"modified",!1,!1);0==allRunDrafts.length?app.displayErrorMessage("No drafts found with tag '"+tadLib.runTag+"' in "+tadLib.runArea):eval(allRunDrafts[0].content),editor.activate()}TA_devBeautifyJSDraft(){return draft.TA_devBeautifyJSDraft}TA_actionGroupLink(t,e=!0,n=!1){let a=[],i=t.replace("drafts://actionGroup?data=","");return JSON.parse(i=decodeURIComponent(i)).actions.forEach(function(t){t.isSeparator&&n&&a.push(t.name),!t.isSeparator&&e&&a.push(t.name)}),a}TA_actionGroupLinkToActions(t){return this.TA_actionGroupLink(t,!0,!1)}TA_actionGroupLinkToSeparators(t){return this.TA_actionGroupLink(t,!1,!0)}TA_actionGroupLinkToList(t){return this.TA_actionGroupLink(t,!0,!0)}TA_actionGroupLinkToActionsCount(t){return this.TA_actionGroupLink(t,!0,!1).length}TA_actionGroupLinkToSeparatorsCount(t){return this.TA_actionGroupLink(t,!1,!0).length}TA_actionGroupLinkToListCount(t){return this.TA_actionGroupLink(t,!0,!0).length}TA_actionGroupLinkToName(t){let e=t.replace("drafts://actionGroup?data=","");return JSON.parse(e=decodeURIComponent(e)).name}TA_actionGroupLinkDocument(t){let e=t.replace("drafts://actionGroup?data=",""),n=JSON.parse(e=decodeURIComponent(e)),a="# "+n.name+"\n",i=this;return n.actions.forEach(function(t){t.isSeparator?a+="\n## "+t.name+"\n":(a+="\n### "+t.name,a+="\n**Type:** Action",t.hasOwnProperty("keyCommand")&&(a+="  \n**Keyboard Shortcut:** "+i.TA_actionKeys(t.keyCommand)),a+="  \n**Icon:** "+t.icon,a+="  \n**Colour:** "+t.tintColor,a+="  \n**Confirm to Run:** "+t.shouldConfirm,a+="  \n**Notifications:** "+i.TA_actionLevelDescription(t.notificationType),a+="  \n**Log Level:** "+i.TA_actionLevelDescription(t.logLevel),a+="  \n**Number of Steps:** "+t.steps.length,a+="  \n**Unique ID:** "+t.uuid,a+="  \n**Description:**  \n",a+=t.actionDescription+"\n"),a+="\n"}),draft.TA_draftNew(a)}TA_actionKeys(t){console.log("calling TA_actionKeys");let e=[""];return t.shiftKey&&e.push("⇧"),t.controlKey&&e.push("⌃"),t.optionKey&&e.push("⌥"),t.commandKey&&e.push("⌘"),t.input.length>0&&e.push(t.input),e.join("")}TA_actionLevelDescription(t){switch(t){case 0:return"None";case 1:return"Errors";case 2:return"All"}}TA_transcludeWikiLinks_$(t){return t.replace(/\[\[(.+?)\]\]/gm,function(t,e){let n=Draft.query(e,"all",[],[],"modified",!0,!1);if(0!=n.length){for(let a of n)if(a.title.replace(/^\#*/g,"").trim().toLowerCase()==e.toLowerCase())return a.content}return t})}TA_transcludeWikiLinks_d(t){return t.replace(/\[\[d:(.+?)\]\]/gm,function(t,e){let n=Draft.query(e,"all",[],[],"modified",!0,!1);if(0!=n.length){for(let a of n)if(a.title.replace(/^\#*/g,"").trim().toLowerCase()==e.toLowerCase())return a.content}return t})}TA_transcludeWikiLinks_u(t){return t.replace(/\[\[u:(.+?)\]\]/gm,function(t,e){let n=Draft.find(e);return void 0==n?t:n.content})}TA_transcludeWikiLinks(t){return this.TA_transcludeWikiLinks_$(this.TA_transcludeWikiLinks_d(this.TA_transcludeWikiLinks_u(t)))}TA_addEncodedImages(t){return t.replace(/src="(.*?)"/gm,function(t,e){if(e.startsWith("http://")||e.startsWith("https://"))return t;let n=e;n.startsWith("/")||(n="/"+n),n+=".b64.txt";let a=FileManager.createCloud().readString(n);if(void 0==a)return t;let i='src="data:image/';return i+=e.toLowerCase().split(".").pop(),i+=";base64, ",i+=a,i+='"'})}TA_synonymSelect(t,e=25){let n=JSON.parse(HTTP.create().TA_getContent("https://api.datamuse.com/words?ml="+encodeURI(t)+"&max="+e)),a=[];return n.forEach(function(t){a.push(t.word)}),Prompt.TA_selectPrompt("Synonyms for '"+t+"'","Please select a synonym",a)}TA_synonymOfSelected(t=25){let e=editor.getSelectedText();if(""==e&&(e=Prompt.TA_singleTextFieldPrompt("Enter Word","","Enter a word or phrase to find a synonym for.","")),""!=e){let n=this.TA_synonymSelect(e,t);if(void 0!=n&&n.length>0)return n}}TA_synonymInsert(t=25){let e=this.TA_synonymOfSelected(t);return void 0!=e&&e.length>0&&editor.setSelectedText(e),e}TA_definition(t){let e=JSON.parse(HTTP.create().TA_getContent("https://api.datamuse.com/words?sp="+encodeURI(t)+"&md=d&max=1"));if(e.length>0)return e[0].defs.join("\n\n")}TA_definitionDisplay(t){return app.TA_msgbox("Definition: "+t,this.TA_definition(t))}TA_definitionOfSelected(){let t=editor.getSelectedText();""==t&&(t=Prompt.TA_singleTextFieldPrompt("Enter Word","","Enter a word or phrase to find a definition for.","")),void 0!=t&&""!=t&&this.TA_definitionDisplay(t)}TA_logToDraft(t,e,n="append",a="",i="",r=""){let o=e;""==e&&(o=editor.dictate()),o=a+o+i,""!=r&&(o=draft.processTemplate(`[[date|${r}]]`)+o);let s;switch(n.toLowerCase()){case"append":(s=Draft.find(t)).content=s.content+o,s.update();break;case"prepend":(s=Draft.find(t)).content=o+s.content,s.update();break;case"cursor":editor.TA_insertTextPosAtEnd(o);break;default:app.TA_displayErrorMessage("Invalid Logging Mode: "+n)}return o}TA_logToDraftCurrent(t,e="append",n="",a="",i="",r=""){return this.TA_logToDraft(draft.uuid,t,e,n,a,i,r)}TA_uuidv4(t,e){for(e=t="";t++<36;e+=51*t&52?(15^t?8^Math.random()*(20^t?16:4):4).toString(16):"-");return e}TA_JSONArraySorter(t){return function(e,n){return e[t]>n[t]?1:e[t]<n[t]?-1:0}}TA_playSoundPath(t){return ShellScript.create(`#!/bin/zsh
afplay ${t}`).execute()}TA_playMP3Data(t){let e=HTMLPreview.create();e.hideInterface=!0;let n=`<html><head></head><body>Playing Audio...<script>
        let objAudio = new Audio("data:audio/wav;base64,${t}");
        objAudio.onended = function(){Drafts.continue();};
        objAudio.play();
        </script></body></html>`;return e.show(n)}TA_devExecuteRunSelection(){eval(editor.getSelectedText()),editor.activate()}TA_devExecuteRunSelectedLines(){eval(editor.TA_getCurrentLinesContent()),editor.activate()}TA_devExecuteRunCurrentDraft(){eval(draft.content),editor.activate()}TA_decimalSeparator(){return 1.1.toLocaleString().replace(/\d/g,"")}TA_fixPoorDiscourseJavaScriptOnClipboard(){app.setClipboard(app.getClipboard().TA_fixPoorDiscourseJavascript())}TA_randomStrings(t,e,n=!0,a=!0,i=!0,r=!1,o=!1,s="new"){function l(t){return t?"on":"off"}let d="https://www.random.org/strings/?";return d+=`num=${t}`,d+=`&len=${e}`,d+=`&digits=${l(n)}`,d+=`&upperalpha=${l(a)}`,d+=`&loweralpha=${l(i)}`,d+=`&unique=${l(r)}`,o?d+="&format=html":d+="&format=plain",d+=`&rnd=${s}`,HTTP.create().TA_getContent(d)}TA_randomInteger(t,e,n,a=10,i=!1,r="new"){let o="https://www.random.org/integers/?";return o+=`num=${t}`,o+=`&min=${e}`,o+=`&max=${n}`,o+="&col=1",o+=`&base=${a}`,i?o+="&format=html":o+="&format=plain",o+=`&rnd=${r}`,HTTP.create().TA_getContent(o).replaceAll("\n","")}TA_randomorgQuotaCheck(){return HTTP.create().TA_getContent("https://www.random.org/quota/?format=plain").replaceAll("\n","")}TA_random128BitKey(){return this.TA_randomInteger(32,0,15,16)}TA_random192BitKey(){return this.TA_randomInteger(48,0,15,16)}TA_random256BitKey(){return this.TA_randomInteger(64,0,15,16)}}var tadMisc=new TadMiscellaneous;Prompt.TA_selectPrompt=function(t,e,n,a=""){let i=[];""==a?i.push(n[0]):i.push(a);let r="OK",o="selectedItems",s=Prompt.create();if(s.title=t,s.addSelect(o,e,n,i,!1),s.addButton(r),s.show())return s.buttonPressed==r?s.fieldValues[o]:null},Prompt.TA_multiSelectPrompt=function(t,e,n,a){let i="OK",r="selectedItems",o=Prompt.create();if(o.title=t,o.addSelect(r,e,n,a,!0),o.addButton(i),o.show())return o.buttonPressed==i?o.fieldValues[r]:null},Prompt.TA_promptButtonArray=function(t,e,n,a=!0){let i=Prompt.create();return(i.title=t,e.length>0&&(i.message=e),i.isCancellable=a,n.forEach(function(t){i.addButton(t)}),i.show())?i.buttonPressed:null},Prompt.TA_singleTextFieldPrompt=function(t,e,n,a=""){let i="OK",r=Prompt.create();return(r.title=t,e.length>0&&(r.message=e),r.addTextField("textFieldName",n,a,{wantsFocus:!0}),r.addButton(i),r.show()&&r.buttonPressed==i)?r.fieldValues.textFieldName:""},Prompt.TA_doubleTextFieldPrompt=function(t,e,n,a,i,r){let o="OK",s=Prompt.create();return(s.title=t,e.length>0&&(s.message=e),s.addTextField("textFieldName1",n,a,{wantsFocus:!0}),s.addTextField("textFieldName2",i,r,{wantsFocus:!1}),s.addButton(o),s.show()&&s.buttonPressed==o)?[s.fieldValues.textFieldName1,s.fieldValues.textFieldName2]:["",""]},Prompt.TA_singleNumberFieldPrompt=function(t,e,n,a=0){let i="OK",r=Prompt.create();if(r.title=t,e.length>0&&(r.message=e),r.addTextField("textFieldName",n,a,{wantsFocus:!0,keyboard:"decimalPad"}),r.addButton(i),r.show()&&r.buttonPressed==i)return Number(r.fieldValues.textFieldName)},Prompt.TA_singleIntegerFieldPrompt=function(t,e,n,a=0){let i="OK",r=Prompt.create();if(r.title=t,e.length>0&&(r.message=e),r.addTextField("textFieldName",n,a,{wantsFocus:!0,keyboard:"numberPad"}),r.addButton(i),r.show()&&r.buttonPressed==i)return Number(r.fieldValues.textFieldName)},Prompt.TA_confirm=function(t,e){return"Yes"==Prompt.TA_promptButtonArray(t,e,["Yes","No"],!1)},Prompt.TA_promptButtonArrayIndexed=function(t,e,n,a=!0){let i=Prompt.create();return(i.title=t,e.length>0&&(i.message=e),i.isCancellable=a,n.forEach(function(t,e){i.addButton(t,e)}),i.show())?i.buttonPressed:null},Prompt.TA_promptButtonArrayValue=function(t,e,n,a,i=!0){let r=Prompt.create();return(r.title=t,e.length>0&&(r.message=e),r.isCancellable=i,n.forEach(function(t,e){r.addButton(t,a[e])}),r.show())?r.buttonPressed:null},Prompt.TA_promptButtonAction=function(t,e,n,a,i=!0){let r=Prompt.TA_promptButtonArrayValue(t,e,n,a,i);return null==r?"TAD-Null Action":r},Prompt.TA_encryptionPromptAES=function(t=!0){let e={key:"",auto:!1},n="OK",a="selKeyLen",i="inputKey",r=Prompt.create();if(r.title="AES Encryption Key",t?(r.message="Enter your encryption key. If the field is left blank a key will be generated automatically and placed on the clipboard based on the key-length specified below.",r.addTextField(i,"Encryption Key","",{wantsFocus:!0}),r.addSelect(a,"Specify the key length for any generated key",["128-bit","192-bit","256-bit"],["128-bit"],!1)):(r.message="Enter your encryption key.",r.addTextField(i,"Encryption Key","",{wantsFocus:!0})),r.addButton(n),r.show()&&r.buttonPressed==n){if(t){if(""!=r.fieldValues[i])return e.key=r.fieldValues[i],e.auto=!1,e;{let o="** No Key Set **";switch(String(r.fieldValues[a])){case"128-bit":o=tadMisc.TA_random128BitKey(),app.displayInfoMessage("128-bit key generated");break;case"192-bit":o=tadMisc.TA_random192BitKey(),app.displayInfoMessage("192-bit key generated");break;case"256-bit":o=tadMisc.TA_random256BitKey(),app.displayInfoMessage("256-bit key generated")}return e.key=o,e.auto=!0,e}}return""==r.fieldValues[i]?(e.key=null,e.auto=!1,e):(e.key=r.fieldValues[i],e.auto=!1,e)}return e.key=null,e.auto=!1,e},Prompt.TA_decryptionPromptAES=function(){let t=this.TA_singleTextFieldPrompt("AES Decryption Key","","Decryption Key","");if(""!=t)return t},RegExp.TA_escape=function(t){return t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},String.prototype.TA_countWords=function(){return this.length>0?this.match(/([^\u0000-\u007F]|\w)+/g).length:0},String.prototype.TA_lengthExclLineBreaks=function(){return this.length>0?this.replace(/\n/g,"").length:0},String.prototype.TA_countLines=function(t=0){return this.length>0?this.split(/\n/).length:t},String.prototype.TA_pluralise=function(t){return 1==t?this:this+"s"},String.prototype.TA_head=function(){return this.slice(0,1)},String.prototype.TA_tail=function(){return this.slice(1)},String.prototype.TA_toUpperCase=function(){return this.normalize().toUpperCase()},String.prototype.TA_toLowerCase=function(){return this.normalize().toLowerCase()},String.prototype.TA_toTitleCase=function(){let t=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;return this.normalize().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(e,n,a){return n>0&&n+e.length!==a.length&&e.search(t)>-1&&":"!==a.charAt(n-2)&&("-"!==a.charAt(n+e.length)||"-"===a.charAt(n-1))&&0>a.charAt(n-1).search(/[^\s-]/)?e.toLowerCase():e.substr(1).search(/[A-Z]|\../)>-1?e:e.charAt(0).toUpperCase()+e.substr(1)})},String.prototype.TA_toSentenceCase=function(){return this.normalize().replace(/(^\w{1}|\.\s*\w{1})/gi,function(t){return t.toUpperCase()})},String.prototype.TA_toPascalCase=function(){return this.normalize().toLowerCase().match(/[a-z]+/gi).map(function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}).join("")},String.prototype.TA_toCamelCase=function(){let t=this.TA_toPascalCase();return t.TA_head().toLowerCase()+t.TA_tail()},String.prototype.TA_toSnakeCase=function(){return this.TA_toPascalCase().split(/(?=[A-Z])/).join("_").toLowerCase()},String.prototype.TA_toScreamingSnakeCase=function(){return this.TA_toPascalCase().split(/(?=[A-Z])/).join("_").toUpperCase()},String.prototype.TA_toKebabCase=function(){return this.TA_toPascalCase().split(/(?=[A-Z])/).join("-").toLowerCase()},String.prototype.TA_toTrainCase=function(){return this.TA_toPascalCase().split(/(?=[A-Z])/).join("-").toUpperCase()},String.prototype.TA_regexIndexOf=function(t,e=0){let n=this.substring(e).search(t);return n>=0?n+e:n},String.prototype.TA_regexLastIndexOf=function(t,e){let n=t.global?t:RegExp(t.source,"g"+(t.ignoreCase?"i":"")+(t.multiLine?"m":"")),a,i=-1,r=0;a=void 0===e?this.length:e<0?0:e;let o;for(;null!=(o=n.exec(this.substring(0,a+1)));)i=o.index,n.lastIndex=++r;return i},String.prototype.TA_removeBlankLines=function(){return this.replace(/^\s*$(?:\r\n?|\n)/gm,"").replace(/\n$/g,"")},String.prototype.TA_removeEmptyLines=function(){return this.replace(/^\n/gm,"").replace(/\n$/g,"")},String.prototype.TA_removeWhitespaceLeading=function(){return this.replace(/^\s+/gm,"").replace(/\n$/g,"")},String.prototype.TA_removeWhitespaceTrailing=function(){return this.replace(/\s+$/gm,"").replace(/^\n/g,"")},String.prototype.TA_removeWhitespaceLeadingTrailing=function(){let t=this.replace(/[^\S\r\n]+$/gm,"");return(t=(t=t.replace(/^\s+/gm,"")).replace(/\n$/g,"")).replace(/^\n/g,"")},String.prototype.TA_removeSpaceTabLeading=function(){return this.replace(/^ +|^\t+/gm,"")},String.prototype.TA_removeSpaceTabTrailing=function(){return this.replace(/ +$|\t+$/gm,"")},String.prototype.TA_removeSpaceTabLeadingTrailing=function(){return this.replace(/^ +|^\t+/gm,"").replace(/ +$|\t+$/gm,"")},String.prototype.TA_deduplicateLines=function(){let t=this.split("\n"),e=[];for(let n=0;n<t.length;n++)-1==e.indexOf(t[n])&&e.push(t[n]);return e.join("\n")},String.prototype.TA_htmlFirstTagContent=function(t){let e=RegExp("<"+t+"[^>]*>([^<]+)</"+t+">","");return this.match(e)[1]},String.prototype.TA_htmlTitle=function(){return this.TA_htmlFirstTagContent("title")},String.prototype.TA_isJSON=function(){try{JSON.parse(this)}catch(t){return console.TA_logError("Error caught by TA_isJSON()"),console.log(" Message: "+t),console.log(" Processing: "+this),!1}return!0},String.prototype.TA_formatDraftsActionLinkToRead=function(){return decodeURIComponent(this).replace(/\\n/g,"\n").replace(/\\t/g,"	")},String.prototype.TA_stripFinalNewLine=function(){let t="\n";return this.endsWith(t)?this.slice(0,-1*t.length):this},String.prototype.TA_mdCode=function(){return"`"+this+"`"},String.prototype.TA_mdCodeBlock=function(t=""){return"```"+t+"\n"+this+"\n```"},String.prototype.TA_mdCodeBlockJS=function(){return this.TA_mdCodeBlock("javascript")},String.prototype.TA_mdCodeBlockAS=function(){return this.TA_mdCodeBlock("applescript")},String.prototype.TA_mdCodeBlockSH=function(){return this.TA_mdCodeBlock("sh")},String.prototype.TA_capitalise=function(){return this.replace(/(?:^|\s|["'([{])+\S/g,t=>t.toUpperCase())},String.prototype.TA_prependWords=function(t){return this.replace(/(\b\w)/g,t+"$1")},String.prototype.TA_appendWords=function(t){return this.replace(/(\w\b)/g,"$1"+t)},String.prototype.TA_wrapWords=function(t,e){return this.TA_prependWords(t).TA_appendWords(e)},String.prototype.TA_delimitWords=function(t){return this.TA_wrapWords(t,t)},String.prototype.TA_fileNameFromPath=function(){return this.split("/").pop()},String.prototype.TA_fileNameBaseFromPath=function(){return -1==this.indexOf(".")?this.TA_fileNameFromPath():this.TA_fileNameFromPath().split(".").slice(0,-1).join(".")},String.prototype.TA_fileNameExtensionFromPath=function(){return -1==this.indexOf(".")?"":this.TA_fileNameFromPath().split(".").pop()},String.prototype.TA_fileNameRemoveExtensionFromPath=function(){return this.TA_folderPathFromPath()+this.TA_fileNameBaseFromPath()},String.prototype.TA_folderPathFromPath=function(){return this.split("/").slice(0,-1).join("/")+"/"},String.prototype.TA_overwriteRange0=function(t,e,n){return this.substring(0,t)+n+this.substring(e+1,this.length)},String.prototype.TA_overwriteRange1=function(t,e,n){return this.substring(0,t-1)+n+this.substring(e,this.length)},String.prototype.TA_insertAfter0=function(t,e){return this.substring(0,t+1)+e+this.substring(t+1,this.length)},String.prototype.TA_insertAfter1=function(t,e){return this.substring(0,t)+e+this.substring(t,this.length)},String.prototype.TA_replaceAllMap=function(t){let e=this;for(let[n,a]of Object.entries(t))e=e.replaceAll(n,a);return e},String.prototype.TA_encodeURI=function(){return encodeURIComponent(this).TA_replaceAllMap(tadLib.encodeMap)},String.prototype.TA_removeLinesStarting=function(t,e=!1){let n="gm";e||(n+="i");let a=RegExp("^"+t+".*\n?",n);return this.replaceAll(a,"")},String.prototype.TA_removeLinesNotStarting=function(t,e=!1){let n="gm";e||(n+="i");let a=RegExp("^(?!"+t+").*\n?",n);return this.replaceAll(a,"")},String.prototype.TA_removeLinesEnding=function(t,e=!1){let n="gm";e||(n+="i");let a=RegExp("^.*"+t+"$\n?",n);return this.replaceAll(a,"")},String.prototype.TA_removeLinesNotEnding=function(t,e=!1){let n="gm";e||(n+="i");let a=RegExp("^(?!.*"+t+"$).*\n?",n);return this.replaceAll(a,"")},String.prototype.TA_removeLinesContaining=function(t,e=!1){let n="gm";e||(n+="i");let a=RegExp("^.*"+t+".*\n?",n);return this.replaceAll(a,"")},String.prototype.TA_removeLinesNotContaining=function(t,e=!1){let n="gm";e||(n+="i");let a=RegExp("^((?!"+t+").)*$\n?",n);return this.replaceAll(a,"")},String.prototype.TA_removeTrailingNewlines=function(){return this.replace(/[\n]+$/g,"")},String.prototype.TA_removeMDHeader=function(){return this.replace(/^(#+) /gm,"")},String.prototype.TA_mdTitleLinks=function(){let t=HTTP.create(),e=this,n=RegExp(".{0,2}(?:(?:https?)://)(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))(?::\\d{2,5})?(?:[/?#]\\S*)?","ig"),a=e.match(n);return(a=[...new Set(a)]).forEach(function(n){let a=n.trim(),i=a.substring(0,2),r=a.substring(2);r=r.match(/([a-zA-Z0-9]).*([a-zA-Z0-9])/)[0],t.TA_isValidURL(r)||(i="",r=a.match(/([a-zA-Z0-9]).*([a-zA-Z0-9])/)[0]),"]("==i?console.log("IGNORE: Matched an existing Markdown link | "+a):'="'==i?console.log("IGNORE: Matched an HTML link | "+a):e=e.replaceAll(a,i+t.TA_mdTitleLinkFromURL(r))}),e},String.prototype.TA_trimToSnippet=function(t){return this.length<=t?this:this.substring(0,t-1)+"…"},String.prototype.TA_randChar=function(){return this[Math.floor(Math.random()*this.length)]},String.prototype.TA_mistypeSlip=function(t,e,n){let a="";for(var i=0;i<this.length;i++){let r=this[i];if(Math.TA_isOneIn(t)&&n.includes(r.toLowerCase())){let o=e[r.toLowerCase()].TA_randChar();r===r.toUpperCase()&&(o=o.toUpperCase()),r=o}a+=r}return a},String.prototype.TA_mistypeSlipQWERTY=function(t){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n={};return n.a="qwsssz",n.b="vvvghnnn",n.c="xxdfvv",n.d="ssserfffxc",n.e="wwwsdrrr",n.f="dddrtgggvc",n.g="ffftyhhhbv",n.h="gggyujjjnb",n.i="uuujkooo",n.j="hhhuikkkmn",n.k="mjjjiolll",n.l="pokkk",n.m="nnnjk",n.n="bbbhjmmm",n.o="iiiklppp",n.p="oool",n.q="awww",n.r="eeedfttt",n.s="aaawedddxz",n.t="rrrfgyyy",n.u="yyyhjiii",n.v="cccfgbbb",n.w="qqqaseee",n.x="zzzsdccc",n.y="tttghuuu",n.z="asxxx",this.TA_mistypeSlip(t,n,e)},String.prototype.TA_mistypeSwitch=function(t){let e=[];for(var n=0;n<this.length;n++)if(Math.TA_isOneIn(t)){let a=e.pop();e.push(this[n]),e.push(a)}else e.push(this[n]);return e.join("")},String.prototype.TA_frontMatterIncluded=function(){if("---"!=this.split("\n")[0])return!1;{let t=!0,e=this.split("---")[1];return(e=e.TA_removeBlankLines()).split("\n").forEach(function(e){e=e.trim();let n=!0;null!==e.match(/^.*: /gi)&&(n=!1),null!==e.match(/^- /gi)&&(n=!1),null!==e.match(/^# /gi)&&(n=!1),n&&(t=!1)}),t}},String.prototype.TA_frontMatterSimpleKeyValue=function(t){if(!this.TA_frontMatterIncluded())return"";{let e=RegExp(`^${t}:.*`,"gm"),n=this.match(e);return null!==n?n[0].substring(`${t}:`.length).trim():""}},String.prototype.TA_csvToArray=function(){let t=RegExp('(?:^|,)(\\"(?:[^\\"]+|\\"\\")*\\"|[^,]*)',"gm"),e=this.match(t),n=[];return e.forEach(function(t){t=(t=(t=(t=t.TA_startsWithRemove(",")).trim()).TA_startsWithRemove('"')).TA_endsWithRemove('"'),n.push(t)}),n},String.prototype.TA_startsWithRemove=function(t){return this.startsWith(t)?this.substring(t.length,this.length):this},String.prototype.TA_endsWithRemove=function(t){return this.endsWith(t)?this.substring(0,this.length-t.length):this},String.prototype.TA_rot13=function(){return this.replace(/[A-Z]/gi,function(t){return String.fromCharCode((t<="Z"?90:122)>=(t=t.charCodeAt(0)+13)?t:t-26)})},String.prototype.TA_fixPoorDiscourseJavascript=function(){let t=this.replaceAll(`“`,'"');return(t=(t=(t=t.replaceAll(`”`,'"')).replaceAll(`‘`,"'")).replaceAll(`’`,"'")).TA_devBeautifyJS()},String.prototype.TA_devBeautifyJS=function(t){require(tadLib.beautifierLibName+".js");let e="/Library/Scripts/"+tadLib.beautifierSettings;if(e.toUpperCase().endsWith(".JSON")||(e+=".json"),void 0!=t)return app.displayInfoMessage("Using alternate JS Beautifer settings"),js_beautify(this,t);{let n=FileManager.createCloud().readString(e);return void 0===n?(app.displayInfoMessage("Using default JS Beautifer settings"),js_beautify(this)):(app.displayInfoMessage("Using custom JS Beautifer settings"),js_beautify(this,JSON.parse(n)))}},String.prototype.TA_randomLine=function(){let t=this.split("\n");return t[Math.floor(Math.random()*t.length)]},String.prototype.TA_processLinesFunction=function(t){return this.split("\n").map(e=>t(e)).join("\n")},String.prototype.TA_taskpaperModifyProject=function(t,e){if(this.endsWith(":")){if(!t)return this.TA_endsWithRemove(":")}else if(!e)return this+":";return this},String.prototype.TA_taskpaperModifyTask=function(t,e){if(this.trim().startsWith("- ")){let n=/^(\s*)(\- )(.*)/gi;if(!t)return this.replace(n,"$1$3")}else{let a=/^(\s*)(.*)/gi;if(!e)return this.replace(a,"$1- $2")}return this},String.prototype.TA_csvWrap=function(t,e,n=!1,a=!1){if(!0==n&&!0==a)return this;let i=this.trim().startsWith('"'),r=!i;n&&(i=!0),a&&(r=!0);let o=this;return i&&(o=t+this.replace(/("\s*),(\s*")/gm,`${e}$1,$2${t}`)+e),r&&(o=t+this.replace(/(\s*),(\s*)/gm,`${e}$1,$2${t}`)+e),o},String.prototype.TA_csvWrapDoubleQuotes=function(){let t=this.TA_csvWrap('"','"',!1,!0);return(t=(t=t.replace(/""(\s*),/gm,'"$1,')).replace(/,(\s*)""/gm,',$1"')).startsWith('""')&&(t=t.substring(1)),t.endsWith('""')&&(t=t.slice(0,-1)),t},String.prototype.TA_wikiLinkContent=function(t=!1,e=!1){let n=this.match(/\[\[.*?\]\]/gm);return null==n?[]:(n=n.map(t=>t.replaceAll("[[","").replaceAll("]]","")),t&&n.sort(),e&&(n=Array.from(new Set(n))),n)},String.prototype.TA_countOccurrences=function(t,e=!1){let n="gim";e&&(n="gm");let a=RegExp(t,n);return(this.match(a)||[]).length},String.prototype.TA_afterFirstOccurrence=function(t){return this.substring(this.indexOf(t)+t.length)},String.prototype.TA_mergeLines=function(t=" ",e=!0,n=["-","—","–","/"],a=[]){let i="";return this.split("\n").forEach(function(r){let o=r;e&&(o=o.trim());let s=!0;n.forEach(function(t){o.endsWith(t)&&(s=!1)}),a.forEach(function(t){o.endsWith(t)&&(s=!0)}),s?i+=o+t:i+=o}),i=i.TA_endsWithRemove(t)},String.prototype.TA_chooseAndOpenMDLink=function(t=!0,e=!1){let n=this.TA_matchMDLinks(t);if(n.length>0){let a=[],i=[];n.forEach(function(t){a.push(t.split("](")[0].slice(2)),i.push(t.split("](")[1].slice(0,-1))});let r=Prompt.TA_promptButtonArrayValue("Select URL","Which URL would you like to activate?",a,i,!0);if(null!=r)return app.openURL(r),!0}else e&&app.TA_displayWarningMessage("No Markdown Links Found");return!1},String.prototype.TA_matchMDLinks=function(t=!0){let e=RegExp(/[^!]\[([^\[]*?)\]\(.*?\)/,"mig"),n=this.match(e);return t&&(n=[...new Set(n)]),n},String.prototype.TA_exportFileMac=function(t){let e=FileManager.createCloud(),n=tadMisc.TA_uuidv4();e.writeString(`/${n}.txt`,this);let a=`#!/bin/zsh
 mv "$HOME/Library/Mobile Documents/iCloud~com~agiletortoise~Drafts5/Documents/${n}.txt" "${t}"
 `,i=ShellScript.create(a);return i.execute()?(app.displayInfoMessage("Success"),!0):(app.displayErrorMessage("Error: "+i.standardError),console.log(i.standardError),!1)},String.prototype.TA_switchWordMarkers=function(t,e,n,a,i,r){let o=this,s="gmi";if(t.length>0){let l=RegExp("\\B\\"+t,s);o=o.replace(l,`${a}`)}if(e.length>0){let d=RegExp("(\\w)\\"+e+"(\\w)",s);o=o.replace(d,`$1${i}$2`)}if(n.length>0){let c=RegExp("\\b\\"+n+"([^\\w])",s);o=o.replace(c,`${r}$1`)}return o},String.prototype.TA_boxer=function(t,e,n,a,i,r,o,s){let l=this.split("\n"),d=l.TA_maxElementLength(),c=d+n.length+a.length+2,h=(l=l.map(t=>n+" "+t.padEnd(d+1," ")+a)).join("\n");return(h=i+t.repeat(c-i.length-r.length)+r+"\n"+h)+"\n"+o+e.repeat(c-o.length-s.length)+s},String.prototype.TA_boxerSingle=function(){return this.TA_boxer("─","─","│","│","┌","┐","└","┘")},String.prototype.TA_boxerDouble=function(){return this.TA_boxer("═","═","║","║","╔","╗","╚","╝")},String.prototype.TA_mdSimpleRenumber=function(){let t=this.split(/^\d+\. /m),e=t.shift();for(let n=0;n<t.length;n++)t[n]=(n+1).toString()+". "+t[n];return e+t.join("")},String.prototype.TA_encryptAES=function(t){return require(tadLib.cryptoLibName+".js"),CryptoJS.AES.encrypt(this.toString(),t).toString()},String.prototype.TA_decryptAES=function(t){return require(tadLib.cryptoLibName+".js"),CryptoJS.AES.decrypt(this.toString(),t).toString(CryptoJS.enc.Utf8)},String.prototype.TA_encryptAESOntoClipboard=function(t){return app.setClipboard(this.TA_encryptAES(t))},String.prototype.TA_decryptAESOntoClipboard=function(t){return app.setClipboard(this.TA_decryptAES(t))},String.prototype.TA_getEmailAddresses=function(){let t=this.match(/[A-Z0-9_!#$%&'*+\/=?`{|}~^.-]+@[A-Z0-9-]+\.[A-Z0-9-]+/gi);return null==t?[]:t},String.prototype.TA_mdToText=function(){let t="<html><body>"+MultiMarkdown.create().render(this)+"</body></html>",e=app.getClipboard();app.htmlToClipboard(t);let n=app.getClipboard();return app.setClipboard(e),n},Workspace.TA_getAllWorkspaceNames=function(){var t=[];return this.getAll().forEach(function(e){t.push(e.name)}),t},Workspace.TA_selectWorkspace=function(t){let e=this.TA_getAllWorkspaceNames();return 0==e.length?(context.cancel("Cannot Load Workspace: No Workspaces Available"),""):1==e.length?(app.displayInfoMessage("Selected only available workspace."),e[0]):Prompt.TA_promptButtonArray("Workspaces",t,e)},Workspace.TA_selectLoadWorkspaceByButton=function(t=!1){let e=this.TA_selectWorkspace("Switch to workspace:");if(null!==e){let n=Workspace.find(e);void 0===n?app.displayWarningMessage("Workspace "+e+"not found."):(app.displayInfoMessage("Loading workspace '"+e+"'..."),app.applyWorkspace(n),t&&app.showDraftList())}else app.displayWarningMessage("No workspace to load.")},Workspace.TA_loadWorkspaceByName=function(t){let e=Workspace.find(t);return void 0===e?(app.TA_displayErrorMessage(`Workspace ${t} not found.`),!1):app.applyWorkspace(e)},Workspace.TA_loadWorkspaceNext=function(){let t=Workspace.TA_getAllWorkspaceNames();if(!(t.length>0))return"";{let e=t.indexOf(app.currentWorkspace.name);return(e+=1)==t.length&&(e=0),Workspace.TA_loadWorkspaceByName(t[e]),t[e]}},Workspace.TA_loadWorkspacePrevious=function(){let t=Workspace.TA_getAllWorkspaceNames();if(!(t.length>0))return"";{let e=t.indexOf(app.currentWorkspace.name);return(e-=1)<0&&(e=t.length-1),Workspace.TA_loadWorkspaceByName(t[e]),t[e]}};class TadData{constructor(t){this.dataPath=t,this.TA_load()}TA_load(){let t=FileManager.createCloud().readJSON(this.dataPath);if(void 0==t)return!1;{let e=this;return e=Object.assign(e,t),!0}}TA_store(){return FileManager.createCloud().writeJSON(this.dataPath,this)}TA_save(t,e){let n=t.split("."),a=this;for(let i=0;i<n.length-1;i++){let r=n[i];a[r]||(a[r]={}),a=a[r]}return a[n[n.length-1]]=e,this.TA_store()}TA_delete(t){let e=t.split("."),n=this;for(let a=0;a<e.length-1;a++)n=n[e[a]];return delete n[e.pop()],this.TA_store()}TA_value(t){let e=this;return t.split(".").reduce((t,e)=>t[e],e)}TA_addition(t,e){return this.TA_save(t,this.TA_value(t)+e)}TA_subtraction(t,e){return this.TA_addition(t,-1*e)}TA_prefix(t,e){return this.TA_save(t,e+this.TA_value(t))}TA_suffix(t,e){return this.TA_save(t,this.TA_value(t)+e)}}var tadData=new TadData(tadLib.dataPath);class TadConsole{constructor(t="/Library/Scripts/tadcon.json"){this.path=t,this.log=[];let e=FileManager.createCloud().readJSON(this.path);if(void 0===e)this.TA_saveLog();else{let n=this;n=Object.assign(n,e)}return}TA_addEntry(t,e="",n=""){let a=tadMisc.TA_getTimestampyyyyMMddhhmmssxxx(),i={};i.stamp=a,i.type=e,i.code=n,i.entry=t,this.log.push(i)}TA_saveEntry(t,e="",n=""){return this.TA_addEntry(t,e,n),this.TA_saveLog()}TA_saveLog(){let t=FileManager.createCloud();return this.lastSaved=tadMisc.TA_getTimestampyyyyMMddhhmmssxxx(),this.lastAction={},this.lastAction.name=action.name,this.lastAction.uuid=action.uuid,this.lastDraft={},this.lastDraft.uuid=draft.uuid,this.lastDraft.version={},this.lastDraft.version.number=draft.versions.length,draft.versions.length>0&&(this.lastDraft.version.uuid=draft.versions[0].uuid,this.lastDraft.version.createdAt=""+draft.versions[0].createdAt),t.writeJSON(this.path,this)}TA_clearLog(){this.log=[]}TA_clearSaveLog(){return this.TA_clearLog(),this.TA_saveLog()}TA_deleteLog(){return FileManager.createCloud().TA_delete(this.path)}TA_filterLogInclude(t,e){return this.log.filter(function(n){return n[t]==e})}TA_filterLogExclude(t,e){return this.log.filter(function(n){return n[t]!=e})}TA_previewLogTable(t=!0){let e=HTMLPreview.create(),n=JSON.stringify(this.log),a,i;t?(a=`let table = $('#tableLog').DataTable( {
    "data" : astrLogEntries,
    "order" : [[ 0, 'asc' ]],
    "orderCellsTop" : true,
    "fixedHeader" : true,
    "pageLength": 25,
    "columns" : [
     { "data" : "stamp" },
     { "data" : "type" },
     { "data" : "code" },
     { "data" : "entry" }
    ],
    "columnDefs": [
     { "width": "180px", "targets": 0 },
     { "width": "10%", "targets": 1 },
     { "width": "5%", "targets": 2 }
    ]
   } );`,i=`<thead>
   <tr>
    <th>Timestamp</th>
    <th>Type</th>
    <th>Code</th>
    <th>Entry</th>
   </tr>
  </thead>
  <tbody>
  </tbody>
  <tfoot>
   <tr>
    <th>Timestamp</th>
    <th>Type</th>
    <th>Code</th>
    <th>Entry</th>
   </tr>
  </tfoot>`):(a=`let table = $('#tableLog').DataTable( {
    "data" : astrLogEntries,
    "order" : [[ 0, 'asc' ]],
    "orderCellsTop" : true,
    "fixedHeader" : true,
    "pageLength": 25,
    "columns" : [
     { "data" : "stamp" },
     { "data" : "entry" }
    ],
    "columnDefs": [
     { "width": "180px", "targets": 0 }
    ]
   } );`,i=`<thead>
   <tr>
    <th>Timestamp</th>
    <th>Entry</th>
   </tr>
  </thead>
  <tbody>
  </tbody>
  <tfoot>
   <tr>
    <th>Timestamp</th>
    <th>Entry</th>
   </tr>
  </tfoot>`);let r=`<html>
   <head>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.21/b-1.6.2/b-colvis-1.6.2/b-print-1.6.2/cr-1.5.2/fh-3.1.7/kt-2.5.2/sp-1.1.1/datatables.min.css"/>
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.3.1/dt-1.10.21/b-1.6.2/b-colvis-1.6.2/b-print-1.6.2/cr-1.5.2/fh-3.1.7/kt-2.5.2/sp-1.1.1/datatables.min.js"></script>
    <script>
     $(document).ready(function()
     {

      // Setup - add a text input to each footer cell
      $('#tableLog thead tr').clone(true).appendTo( '#tableLog thead' );
      $('#tableLog thead tr:eq(1) th').each( function (i) {
       var title = $(this).text();
       $(this).html( '<input type="text" placeholder="Search '+title+'" />' );

       $( 'input', this ).on( 'keyup change', function () {
        if ( table.column(i).search() !== this.value ) {
         table
          .column(i)
          .search( this.value )
          .draw();
        }
       } );
      } );

      ${a};


     } );
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
    body
    {
     font-family: Arial;
     font-size: small;
    }
    /*
    * Table styles
    */
      table.dataTable {
     width: 100%;
     margin: 0 auto;
     clear: both;
     border-collapse: separate;
     border-spacing: 0;
     /*
      * Header and footer styles
      */
     /*
      * Body styles
      */ }
     table.dataTable thead th,
     table.dataTable tfoot th {
       font-weight: bold; }
     table.dataTable thead th,
     table.dataTable thead td {
       padding: 10px 18px;
       border-bottom: 1px solid #111111; }
       table.dataTable thead th:active,
       table.dataTable thead td:active {
      outline: none; }
     table.dataTable tfoot th,
     table.dataTable tfoot td {
       padding: 10px 18px 6px 18px;
       border-top: 1px solid #111111; }
     table.dataTable thead .sorting,
     table.dataTable thead .sorting_asc,
     table.dataTable thead .sorting_desc,
     table.dataTable thead .sorting_asc_disabled,
     table.dataTable thead .sorting_desc_disabled {
       cursor: pointer;
       *cursor: hand;
       background-repeat: no-repeat;
       background-position: center right; }
     table.dataTable thead .sorting {
       background-image: url("../images/sort_both.png"); }
     table.dataTable thead .sorting_asc {
       background-image: url("../images/sort_asc.png"); }
     table.dataTable thead .sorting_desc {
       background-image: url("../images/sort_desc.png"); }
     table.dataTable thead .sorting_asc_disabled {
       background-image: url("../images/sort_asc_disabled.png"); }
     table.dataTable thead .sorting_desc_disabled {
       background-image: url("../images/sort_desc_disabled.png"); }
     table.dataTable tbody tr {
       background-color: white; }
       table.dataTable tbody tr.selected {
      background-color: #abc3d1; }
     table.dataTable tbody th,
     table.dataTable tbody td {
       padding: 8px 10px; }
     table.dataTable.row-border tbody th, table.dataTable.row-border tbody td, table.dataTable.display tbody th, table.dataTable.display tbody td {
       border-top: 1px solid #dddddd; }
     table.dataTable.row-border tbody tr:first-child th,
     table.dataTable.row-border tbody tr:first-child td, table.dataTable.display tbody tr:first-child th,
     table.dataTable.display tbody tr:first-child td {
       border-top: none; }
     table.dataTable.cell-border tbody th, table.dataTable.cell-border tbody td {
       border-top: 1px solid #dddddd;
       border-right: 1px solid #dddddd; }
     table.dataTable.cell-border tbody tr th:first-child,
     table.dataTable.cell-border tbody tr td:first-child {
       border-left: 1px solid #dddddd; }
     table.dataTable.cell-border tbody tr:first-child th,
     table.dataTable.cell-border tbody tr:first-child td {
       border-top: none; }
     table.dataTable.stripe tbody tr.odd, table.dataTable.display tbody tr.odd {
       background-color: #f9f9f9; }
       table.dataTable.stripe tbody tr.odd.selected, table.dataTable.display tbody tr.odd.selected {
      background-color: #a6becc; }
     table.dataTable.hover tbody tr:hover, table.dataTable.display tbody tr:hover {
       background-color: whitesmoke; }
       table.dataTable.hover tbody tr:hover.selected, table.dataTable.display tbody tr:hover.selected {
      background-color: #a4bbc9; }
     table.dataTable.order-column tbody tr > .sorting_1,
     table.dataTable.order-column tbody tr > .sorting_2,
     table.dataTable.order-column tbody tr > .sorting_3, table.dataTable.display tbody tr > .sorting_1,
     table.dataTable.display tbody tr > .sorting_2,
     table.dataTable.display tbody tr > .sorting_3 {
       background-color: #f9f9f9; }
     table.dataTable.order-column tbody tr.selected > .sorting_1,
     table.dataTable.order-column tbody tr.selected > .sorting_2,
     table.dataTable.order-column tbody tr.selected > .sorting_3, table.dataTable.display tbody tr.selected > .sorting_1,
     table.dataTable.display tbody tr.selected > .sorting_2,
     table.dataTable.display tbody tr.selected > .sorting_3 {
       background-color: #a7bfcc; }
     table.dataTable.display tbody tr.odd > .sorting_1, table.dataTable.order-column.stripe tbody tr.odd > .sorting_1 {
       background-color: #f1f1f1; }
     table.dataTable.display tbody tr.odd > .sorting_2, table.dataTable.order-column.stripe tbody tr.odd > .sorting_2 {
       background-color: #f3f3f3; }
     table.dataTable.display tbody tr.odd > .sorting_3, table.dataTable.order-column.stripe tbody tr.odd > .sorting_3 {
       background-color: whitesmoke; }
     table.dataTable.display tbody tr.odd.selected > .sorting_1, table.dataTable.order-column.stripe tbody tr.odd.selected > .sorting_1 {
       background-color: #a1b8c5; }
     table.dataTable.display tbody tr.odd.selected > .sorting_2, table.dataTable.order-column.stripe tbody tr.odd.selected > .sorting_2 {
       background-color: #a2b9c7; }
     table.dataTable.display tbody tr.odd.selected > .sorting_3, table.dataTable.order-column.stripe tbody tr.odd.selected > .sorting_3 {
       background-color: #a4bbc8; }
     table.dataTable.display tbody tr.even > .sorting_1, table.dataTable.order-column.stripe tbody tr.even > .sorting_1 {
       background-color: #f9f9f9; }
     table.dataTable.display tbody tr.even > .sorting_2, table.dataTable.order-column.stripe tbody tr.even > .sorting_2 {
       background-color: #fbfbfb; }
     table.dataTable.display tbody tr.even > .sorting_3, table.dataTable.order-column.stripe tbody tr.even > .sorting_3 {
       background-color: #fdfdfd; }
     table.dataTable.display tbody tr.even.selected > .sorting_1, table.dataTable.order-column.stripe tbody tr.even.selected > .sorting_1 {
       background-color: #a7bfcc; }
     table.dataTable.display tbody tr.even.selected > .sorting_2, table.dataTable.order-column.stripe tbody tr.even.selected > .sorting_2 {
       background-color: #a8c0ce; }
     table.dataTable.display tbody tr.even.selected > .sorting_3, table.dataTable.order-column.stripe tbody tr.even.selected > .sorting_3 {
       background-color: #aac2d0; }
     table.dataTable.display tbody tr:hover > .sorting_1, table.dataTable.order-column.hover tbody tr:hover > .sorting_1 {
       background-color: #eaeaea; }
     table.dataTable.display tbody tr:hover > .sorting_2, table.dataTable.order-column.hover tbody tr:hover > .sorting_2 {
       background-color: #ebebeb; }
     table.dataTable.display tbody tr:hover > .sorting_3, table.dataTable.order-column.hover tbody tr:hover > .sorting_3 {
       background-color: #eeeeee; }
     table.dataTable.display tbody tr:hover.selected > .sorting_1, table.dataTable.order-column.hover tbody tr:hover.selected > .sorting_1 {
       background-color: #9cb3bf; }
     table.dataTable.display tbody tr:hover.selected > .sorting_2, table.dataTable.order-column.hover tbody tr:hover.selected > .sorting_2 {
       background-color: #9eb4c1; }
     table.dataTable.display tbody tr:hover.selected > .sorting_3, table.dataTable.order-column.hover tbody tr:hover.selected > .sorting_3 {
       background-color: #a0b6c3; }
     table.dataTable.no-footer {
       border-bottom: 1px solid #111111; }
     table.dataTable.nowrap th, table.dataTable.nowrap td {
       white-space: nowrap; }
     table.dataTable.compact thead th,
     table.dataTable.compact thead td {
       padding: 4px 17px; }
     table.dataTable.compact tfoot th,
     table.dataTable.compact tfoot td {
       padding: 4px; }
     table.dataTable.compact tbody th,
     table.dataTable.compact tbody td {
       padding: 4px; }
     table.dataTable th.dt-left,
     table.dataTable td.dt-left {
       text-align: left; }
     table.dataTable th.dt-center,
     table.dataTable td.dt-center,
     table.dataTable td.dataTables_empty {
       text-align: center; }
     table.dataTable th.dt-right,
     table.dataTable td.dt-right {
       text-align: right; }
     table.dataTable th.dt-justify,
     table.dataTable td.dt-justify {
       text-align: justify; }
     table.dataTable th.dt-nowrap,
     table.dataTable td.dt-nowrap {
       white-space: nowrap; }
     table.dataTable thead th.dt-head-left,
     table.dataTable thead td.dt-head-left,
     table.dataTable tfoot th.dt-head-left,
     table.dataTable tfoot td.dt-head-left {
       text-align: left; }
     table.dataTable thead th.dt-head-center,
     table.dataTable thead td.dt-head-center,
     table.dataTable tfoot th.dt-head-center,
     table.dataTable tfoot td.dt-head-center {
       text-align: center; }
     table.dataTable thead th.dt-head-right,
     table.dataTable thead td.dt-head-right,
     table.dataTable tfoot th.dt-head-right,
     table.dataTable tfoot td.dt-head-right {
       text-align: right; }
     table.dataTable thead th.dt-head-justify,
     table.dataTable thead td.dt-head-justify,
     table.dataTable tfoot th.dt-head-justify,
     table.dataTable tfoot td.dt-head-justify {
       text-align: justify; }
     table.dataTable thead th.dt-head-nowrap,
     table.dataTable thead td.dt-head-nowrap,
     table.dataTable tfoot th.dt-head-nowrap,
     table.dataTable tfoot td.dt-head-nowrap {
       white-space: nowrap; }
     table.dataTable tbody th.dt-body-left,
     table.dataTable tbody td.dt-body-left {
       text-align: left; }
     table.dataTable tbody th.dt-body-center,
     table.dataTable tbody td.dt-body-center {
       text-align: center; }
     table.dataTable tbody th.dt-body-right,
     table.dataTable tbody td.dt-body-right {
       text-align: right; }
     table.dataTable tbody th.dt-body-justify,
     table.dataTable tbody td.dt-body-justify {
       text-align: justify; }
     table.dataTable tbody th.dt-body-nowrap,
     table.dataTable tbody td.dt-body-nowrap {
       white-space: nowrap; }

      table.dataTable,
      table.dataTable th,
      table.dataTable td {
     box-sizing: content-box; }

      /*
    * Control feature layout
    */
      .dataTables_wrapper {
     position: relative;
     clear: both;
     *zoom: 1;
     zoom: 1; }
     .dataTables_wrapper .dataTables_length {
       float: left; }
     .dataTables_wrapper .dataTables_filter {
       float: right;
       text-align: right; }
       .dataTables_wrapper .dataTables_filter input {
      margin-left: 0em; float: left; }
     .dataTables_wrapper .dataTables_info {
       clear: both;
       float: left;
       padding-top: 0.755em; }
     .dataTables_wrapper .dataTables_paginate {
       float: right;
       text-align: right;
       padding-top: 0.25em; }
       .dataTables_wrapper .dataTables_paginate .paginate_button {
      box-sizing: border-box;
      display: inline-block;
      min-width: 1.5em;
      padding: 0.5em 1em;
      margin-left: 2px;
      text-align: center;
      text-decoration: none !important;
      cursor: pointer;
      *cursor: hand;
      color: #333333 !important;
      border: 1px solid transparent;
      border-radius: 2px; }
      .dataTables_wrapper .dataTables_paginate .paginate_button.current, .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        color: #333333 !important;
        border: 1px solid #376daa;
        background-color: #fcfdfe;
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #fcfdfe), color-stop(100%, #90b3db));
        /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top, #fcfdfe 0%, #90b3db 100%);
        /* Chrome10+,Safari5.1+ */
        background: -moz-linear-gradient(top, #fcfdfe 0%, #90b3db 100%);
        /* FF3.6+ */
        background: -ms-linear-gradient(top, #fcfdfe 0%, #90b3db 100%);
        /* IE10+ */
        background: -o-linear-gradient(top, #fcfdfe 0%, #90b3db 100%);
        /* Opera 11.10+ */
        background: linear-gradient(to bottom, #fcfdfe 0%, #90b3db 100%);
        /* W3C */ }
      .dataTables_wrapper .dataTables_paginate .paginate_button.disabled, .dataTables_wrapper .dataTables_paginate .paginate_button.disabled:hover, .dataTables_wrapper .dataTables_paginate .paginate_button.disabled:active {
        cursor: default;
        color: #666 !important;
        border: 1px solid transparent;
        background: transparent;
        box-shadow: none; }
      .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        color: white !important;
        border: 1px solid #111111;
        background-color: #585858;
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #585858), color-stop(100%, #111111));
        /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top, #585858 0%, #111111 100%);
        /* Chrome10+,Safari5.1+ */
        background: -moz-linear-gradient(top, #585858 0%, #111111 100%);
        /* FF3.6+ */
        background: -ms-linear-gradient(top, #585858 0%, #111111 100%);
        /* IE10+ */
        background: -o-linear-gradient(top, #585858 0%, #111111 100%);
        /* Opera 11.10+ */
        background: linear-gradient(to bottom, #585858 0%, #111111 100%);
        /* W3C */ }
      .dataTables_wrapper .dataTables_paginate .paginate_button:active {
        outline: none;
        background-color: #2b2b2b;
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #2b2b2b), color-stop(100%, #0c0c0c));
        /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        /* Chrome10+,Safari5.1+ */
        background: -moz-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        /* FF3.6+ */
        background: -ms-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        /* IE10+ */
        background: -o-linear-gradient(top, #2b2b2b 0%, #0c0c0c 100%);
        /* Opera 11.10+ */
        background: linear-gradient(to bottom, #2b2b2b 0%, #0c0c0c 100%);
        /* W3C */
        box-shadow: inset 0 0 3px #111; }
       .dataTables_wrapper .dataTables_paginate .ellipsis {
      padding: 0 1em; }
     .dataTables_wrapper .dataTables_processing {
       position: absolute;
       top: 50%;
       left: 50%;
       width: 100%;
       height: 40px;
       margin-left: -50%;
       margin-top: -25px;
       padding-top: 20px;
       text-align: center;
       font-size: 1.2em;
       background-color: white;
       background: -webkit-gradient(linear, left top, right top, color-stop(0%, rgba(255, 255, 255, 0)), color-stop(25%, rgba(255, 255, 255, 0.9)), color-stop(75%, rgba(255, 255, 255, 0.9)), color-stop(100%, rgba(255, 255, 255, 0)));
       background: -webkit-linear-gradient(left, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.9) 25%, rgba(255, 255, 255, 0.9) 75%, rgba(255, 255, 255, 0) 100%);
       background: -moz-linear-gradient(left, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.9) 25%, rgba(255, 255, 255, 0.9) 75%, rgba(255, 255, 255, 0) 100%);
       background: -ms-linear-gradient(left, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.9) 25%, rgba(255, 255, 255, 0.9) 75%, rgba(255, 255, 255, 0) 100%);
       background: -o-linear-gradient(left, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.9) 25%, rgba(255, 255, 255, 0.9) 75%, rgba(255, 255, 255, 0) 100%);
       background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.9) 25%, rgba(255, 255, 255, 0.9) 75%, rgba(255, 255, 255, 0) 100%); }
     .dataTables_wrapper .dataTables_length,
     .dataTables_wrapper .dataTables_filter,
     .dataTables_wrapper .dataTables_info,
     .dataTables_wrapper .dataTables_processing,
     .dataTables_wrapper .dataTables_paginate {
       color: #333333; }
     .dataTables_wrapper .dataTables_scroll {
       clear: both; }
       .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody {
      *margin-top: -1px;
      -webkit-overflow-scrolling: touch; }
      .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > thead > tr > th, .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > thead > tr > td, .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > tbody > tr > th, .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > tbody > tr > td {
        vertical-align: middle; }
      .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > thead > tr > th > div.dataTables_sizing,
      .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > thead > tr > td > div.dataTables_sizing, .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > tbody > tr > th > div.dataTables_sizing,
      .dataTables_wrapper .dataTables_scroll div.dataTables_scrollBody > table > tbody > tr > td > div.dataTables_sizing {
        height: 0;
        overflow: hidden;
        margin: 0 !important;
        padding: 0 !important; }
     .dataTables_wrapper.no-footer .dataTables_scrollBody {
       border-bottom: 1px solid #111111; }
     .dataTables_wrapper.no-footer div.dataTables_scrollHead table.dataTable,
     .dataTables_wrapper.no-footer div.dataTables_scrollBody > table {
       border-bottom: none; }
     .dataTables_wrapper:after {
       visibility: hidden;
       display: block;
       content: "";
       clear: both;
       height: 0; }

      @media screen and (max-width: 767px) {
     .dataTables_wrapper .dataTables_info,
     .dataTables_wrapper .dataTables_paginate {
       float: none;
       text-align: center; }
     .dataTables_wrapper .dataTables_paginate {
       margin-top: 0.5em; } }
      @media screen and (max-width: 640px) {
     .dataTables_wrapper .dataTables_length,
     .dataTables_wrapper .dataTables_filter {
       float: none;
       text-align: center; }
     .dataTables_wrapper .dataTables_filter {
       margin-top: 0.5em; } }
    </style>
   </head>
   <body>
    <script>
     var astrLogEntries = ${n};
    </script>
    <h1>Log Viewer</h1>
    <table id="tableLog" class="display compact stripe" style="width:100%">
     ${i}
    </table>
   </body>
  </html>`;return e.show(r)}TA_arrayToSimpleText(t,e=!0){let n=[];return t.forEach(function(t){let e=t.stamp;""!=t.type&&(e+=" - "+t.type),""!=t.code&&(e+=" ["+t.code+"]"),e+=": "+t.entry,n.push(e)}),n=n.sort(),e||(n=n.reverse()),n.join("\n")}TA_logToSimpleText(t=!0){return this.TA_arrayToSimpleText(this.log,t)}TA_logToSimpleTextInclude(t,e,n=!0){return this.TA_arrayToSimpleText(this.TA_filterLogInclude(t,e),n)}TA_logToSimpleTextExclude(t,e,n=!0){return this.TA_arrayToSimpleText(this.TA_filterLogExclude(t,e),n)}TA_logExportToClipboard(t=!0){app.setClipboard(this.TA_logToSimpleText(t))}TA_logExportToClipboardInclude(t,e,n=!0){app.setClipboard(this.TA_logToSimpleTextInclude(t,e,n))}TA_logExportToClipboardExclude(t,e,n=!0){app.setClipboard(this.TA_logToSimpleTextExclude(t,e,n))}TA_logExportToDraft(t=!0){return draft.TA_draftNew(this.TA_logToSimpleText(t))}TA_logExportToDraftInclude(t,e,n=!0){return draft.TA_draftNew(this.TA_logToSimpleTextInclude(t,e,n))}TA_logExportToDraftExclude(t,e,n=!0){return draft.TA_draftNew(this.TA_logToSimpleTextExclude(t,e,n))}TA_logExportToInsert(t=!0){let e=editor.setSelectedText(this.TA_logToSimpleText(t));return editor.activate(),e}TA_logExportToInsertInclude(t,e,n=!0){let a=editor.setSelectedText(this.TA_logToSimpleTextInclude(t,e,n));return editor.activate(),a}TA_logExportToInsertExclude(t,e,n=!0){let a=editor.setSelectedText(this.TA_logToSimpleTextExclude(t,e,n));return editor.activate(),a}TA_logExportToAlert(t=!0){alert(this.TA_logToSimpleText(t))}TA_logExportToAlertInclude(t,e,n=!0){alert(this.TA_logToSimpleTextInclude(t,e,n))}TA_logExportToAlertExclude(t,e,n=!0){alert(this.TA_logToSimpleTextExclude(t,e,n))}TA_snapshot(){return FileManager.createCloud().TA_snapshot(this.path)}TA_logExportEntriesToFile(t,e=!1,n="log"){let a="";n.length>0&&(a=n.startsWith(".")?n:"."+n);let i="";return i=e?this.path.TA_folderPathFromPath()+tadMisc.TA_getTimestampyyyyMMddhhmmss()+" "+this.path.TA_fileNameBaseFromPath()+a:this.path.TA_fileNameRemoveExtensionFromPath()+a,FileManager.createCloud().writeString(i,t)}TA_logExportToFile(t=!0,e=!1,n="log"){return this.TA_logExportEntriesToFile(this.TA_logToSimpleText(t),e,n)}TA_logExportToFileInclude(t,e,n=!0,a=!1,i="log"){return this.TA_logExportEntriesToFile(this.TA_logToSimpleTextInclude(t,e,n),a,i)}TA_logExportToFileExclude(t,e,n=!0,a=!1,i="log"){return this.TA_logExportEntriesToFile(this.TA_logToSimpleTextExclude(t,e,n),a,i)}TA_filterLog(t,e,n,a){let i=this.log;return""!=e&&(i=a?this.log.filter(function(t){return t[e]==n}):this.log.filter(function(t){return t[e]!=n})),i.sort(tadMisc.TA_JSONArraySorter("stamp")),t||(i=i.reverse()),i}TA_filterLogEntry(t,e=!0,n="",a="",i=!0){let r=this.TA_filterLog(e,n,a,i),o=t-1;return(o>r.length-1&&(o=r.length-1),o<0&&(o=0),void 0==r[o])?{stamp:"",type:"",code:"",entry:""}:r[o]}TA_filterLogEntries(t,e,n=!0,a="",i="",r=!0){let o=this.TA_filterLog(n,a,i,r),s=t-1;s>o.length-1&&(s=o.length-1),s<0&&(s=0);let l=e-1;l>o.length-1&&(l=o.length-1),l<0&&(l=0);let d=[];for(let c=s;c<=l;c++)void 0!=o[c]&&d.push(o[c]);return d}TA_logEntryFirst(){return this.TA_filterLogEntry(1,!0,"","",!0)}TA_logEntryLast(){return this.TA_filterLogEntry(1,!1,"","",!0)}TA_logEntryFirstType(t){return this.TA_filterLogEntry(1,!0,"type",t,!0)}TA_logEntryLastType(t){return this.TA_filterLogEntry(1,!1,"type",t,!0)}TA_logEntryFirstCode(t){return this.TA_filterLogEntry(1,!0,"code",t,!0)}TA_logEntryLastCode(t){return this.TA_filterLogEntry(1,!1,"code",t,!0)}TA_logEntryFormat(t){let e=t.stamp+" ";return""!=t.type&&(e+=t.type),""!=t.code&&(e+=" ("+t.code+")"),e+"\n"+t.entry}}var tadCon=new TadConsole;class TadBear{constructor(){this.TA_reset(),this.baseURL="bear://",this.baseCallbackURL=this.baseURL+"x-callback-url/",this.fonts=["Avenir Next","System","Helvetica Neue","Menlo","Georgia","Courier","Open Dyslexic"],this.themes=["Red Graphite","Charcoal","Solarized Light","Solarized Dark","Panic Mode","Dracula","Gotham","Toothpaste","Cobalt","Duotone Light","Duotone Snow","Dieci","Ayu","Ayu Mirage","Dark Graphite","Gandalf","Olive Dunk","D.Boing",],this.debug=!1}TA_reset(){this.parameters={},this.url=""}TA_parameterString(){let t=[];for(let e in this.parameters)t.push(`${e}=${this.parameters[e].TA_encodeURI()}`);return t.join("&")}TA_url(t){return this.baseCallbackURL+t+"?"+this.TA_parameterString()}TA_call(t,e=!0){this.url=this.TA_url();let n=CallbackURL.create();for(let a in n.baseURL=this.baseCallbackURL+t,n.waitForResponse=e,this.parameters)n.addParameter(a,this.parameters[a]);if(this.debug&&alert(n.url),n.open())return n.callbackResponse;console.log(n.status),console.log(n.url),"cancelled"==n.status?context.cancel("Cancellation"):context.fail("Failure")}TA_deviceUUIDforBear(){let t="/LocalBearID.txt",e=FileManager.createLocal(),n=e.readString(t);return void 0==n&&(n=tadMisc.TA_uuidv4(),e.writeString(t,n)),n}TA_addParamString(t,e){""!=e&&(this.parameters[t]=e)}TA_addParamBool(t,e){let n="no";return e&&(n="yes"),this.parameters[t]=n}TA_addParamToken(){return this.TA_addParamString("token",this.TA_deviceTokenforBear())}TA_deviceTokenforBear(){let t=Credential.create(`Bear Token (${this.TA_deviceUUIDforBear()})`,"API Token for Bear App");return t.addPasswordField("API Token","Bear API token for this device"),t.authorize(),t.getValue("API Token")}TA_search(t="",e="",n=!1){this.TA_reset(),this.TA_addParamString("term",t),this.TA_addParamString("tag",e),this.TA_addParamBool("show_window",n),this.TA_addParamToken();let a=this.TA_call("search");if(void 0!=a){let i=[];return JSON.parse(a.notes).forEach(function(t){let e={};e.title=t.title,e.identifier=t.identifier,e.modificationDate=Date.parse(t.modificationDate),e.creationDate=Date.parse(t.creationDate),e.tags=[],e.tags.push(...JSON.parse(t.tags)),i.push(e)}),i}}TA_grabURL(t,e="",n=!1,a=!0){return this.TA_reset(),this.TA_addParamString("url",t),this.TA_addParamString("tags",e),this.TA_addParamBool("pin",n),this.TA_addParamBool("wait",a),this.TA_call("grab-url",a)}TA_changeFont(t,e=!1){this.TA_reset(),this.TA_addParamString("font",t),this.TA_addParamBool("show_window",e),this.TA_call("change-font",!1)}TA_changeTheme(t,e=!1){this.TA_reset(),this.TA_addParamString("theme",t),this.TA_addParamBool("show_window",e),this.TA_call("change-theme",!1)}TA_selectLocked(t="",e=!1){this.TA_reset(),this.TA_addParamString("search",t),this.TA_addParamBool("show_window",e),this.TA_call("locked",!1)}TA_selectToday(t="",e=!1){this.TA_reset(),this.TA_addParamString("search",t),this.TA_addParamBool("show_window",e),this.TA_addParamToken(),this.TA_call("today",!1)}TA_selectTodo(t="",e=!1){this.TA_reset(),this.TA_addParamString("search",t),this.TA_addParamBool("show_window",e),this.TA_addParamToken(),this.TA_call("todo",!1)}TA_selectUntagged(t="",e=!1){this.TA_reset(),this.TA_addParamString("search",t),this.TA_addParamBool("show_window",e),this.TA_addParamToken(),this.TA_call("untagged",!1)}TA_selectArchive(t="",e=!1){this.TA_reset(),this.TA_addParamString("search",t),this.TA_addParamBool("show_window",e),this.TA_call("archive",!1)}TA_archiveNote(t,e=!1){this.TA_reset(),this.TA_addParamString("id",t),this.TA_addParamBool("show_window",e),this.TA_call("archive",!1)}TA_selectTrash(t="",e=!1){this.TA_reset(),this.TA_addParamString("search",t),this.TA_addParamBool("show_window",e),this.TA_call("trash",!1)}TA_trashNote(t,e=!1){this.TA_reset(),this.TA_addParamString("id",t),this.TA_addParamBool("show_window",e),this.TA_call("trash",!1)}TA_deleteTag(t,e=!1){this.TA_reset(),this.TA_addParamString("name",t),this.TA_addParamBool("show_window",e),this.TA_call("delete-tag",!1)}TA_renameTag(t,e,n=!1){return this.TA_reset(),this.TA_addParamString("name",t),this.TA_addParamString("new_name",e),this.TA_addParamBool("show_window",n),this.TA_call("rename-tag")}TA_openTag(t){this.TA_reset(),this.TA_addParamString("name",t),this.TA_addParamToken(),this.TA_call("open-tag",!1)}TA_tags(){this.TA_reset(),this.TA_addParamToken();let t=JSON.parse(this.TA_call("tags").tags),e=[];return t.forEach(function(t){e.push(t.name)}),e}TA_addText(t="",e="",n=!1,a="",i=!1,r="",o="append",s=!0,l="",d=!0,c=!1,h=!1,u=!1,p=!1,T=!1){return this.TA_reset(),this.TA_addParamString("id",t),this.TA_addParamString("title",e),this.TA_addParamBool("selected",n),this.parameters.text=a,this.TA_addParamBool("clipboard",i),this.TA_addParamString("header",r),this.TA_addParamString("mode",o),this.TA_addParamBool("new_line",s),this.TA_addParamString("tags",l),this.TA_addParamBool("exclude_trashed",d),this.TA_addParamBool("open_note",c),this.TA_addParamBool("new_window",h),this.TA_addParamBool("show_window",u),this.TA_addParamBool("edit",p),this.TA_addParamBool("timestamp",T),this.TA_addParamToken(),this.TA_call("add-text")}TA_getNoteContent(t="",e=""){return this.TA_openNote(t,e).note}TA_create(t="",e="",n=!1,a="",i=!1,r=!1,o=!1,s=!1,l=!1,d=!1,c=!1){return this.TA_reset(),this.TA_addParamString("title",t),this.TA_addParamString("text",e),this.TA_addParamBool("clipboard",n),this.TA_addParamString("tags",a),this.TA_addParamBool("open_note",i),this.TA_addParamBool("new_window",r),this.TA_addParamBool("float",o),this.TA_addParamBool("show_window",s),this.TA_addParamBool("pin",l),this.TA_addParamBool("edit",d),this.TA_addParamBool("timestamp",c),this.TA_addParamToken(),this.TA_call("create")}TA_openNote(t="",e="",n="",a=!0,i=!1,r=!1,o=!1,s=!1,l=!1,d=!1,c=!1){this.TA_reset(),this.TA_addParamString("id",t),this.TA_addParamString("title",e),this.TA_addParamString("header",n),this.TA_addParamBool("exclude_trashed",a),this.TA_addParamBool("new_window",i),this.TA_addParamBool("float",r),this.TA_addParamBool("show_window",o),this.TA_addParamBool("open_note",s),this.TA_addParamBool("selected",l),this.TA_addParamBool("pin",d),this.TA_addParamBool("edit",c),this.TA_addParamToken();let h=this.TA_call("open-note");if(void 0!=h){let u={};return u.title=h.title,u.identifier=h.identifier,u.modificationDate=Date.parse(h.modificationDate),u.creationDate=Date.parse(h.creationDate),u.note=h.note,h.is_trashed="yes",u.isTrashed=!0,u.tags=[],u.tags.push(...JSON.parse(h.tags)),u}}TA_importNoteToDrafts(t,e=[]){let n=this.TA_openNote(t);if(void 0!=n){let a=new Draft;return a.content=n.note,a.createdAt=n.creationDate,a.modifiedAt=n.modificationDate,a.TA_addTags(n.tags),a.TA_addTags(e),a.update(),a.uuid}}TA_importNotesToDrafts(t="",e="",n=[]){let a=this,i=[],r=this.TA_search(t,e);if(void 0!=r)return r.forEach(function(t){let e=a.TA_importNoteToDrafts(t.identifier,n);void 0!=e&&i.push(e)}),i}TA_exportDraftToBear(t){return this.TA_create(t.title,t.content,!1,t.tags.join(",")).identifier}TA_exportSelectionToBear(){return this.TA_create("",editor.TA_getSelectionWide()).identifier}TA_changeFontPrompt(t=!1){let e=Prompt.TA_promptButtonArray("Bear Font","Select the font to use",this.fonts,!0);return null!=e&&this.TA_changeFont(e,t),e}TA_changeThemePrompt(t=!1){let e=Prompt.TA_promptButtonArray("Bear Theme","Select the theme to use",this.themes,!0);null!=e&&this.TA_changeTheme(e,t)}TA_selectTag(){return Prompt.TA_promptButtonArray("Bear Tag","Select a Bear tag to use",this.TA_tags(),!0)}}class TadGitHub{constructor(t){this.user=t,this.cred=Credential.create("GitHub - "+this.user,"GitHub Access Token"),this.cred.addTextField("token","Access Token"),this.cred.authorize()}TA_accountGetRepos(t="pushed",e=100,n=1,a="asc",i="all"){let r="https://api.github.com/user/repos?";return r+="sort="+t,r+="&direction="+a,r+="&type="+i,r+="&per_page="+e,r+="&page="+n,JSON.parse(HTTP.create().request({url:r,method:"GET",headers:{Authorization:"token "+this.cred.getValue("token"),"User-Agent":"Drafts-Script",accept:"application/vnd.github.v3+json"}}).responseText)}TA_accountRepoNames(t="pushed",e=100,n=1,a="asc",i="all"){let r=[];return this.TA_accountGetRepos(t,e,n,a,i).forEach(function(t){r.push(t.name)}),r}TA_accountSelectRepo(t="pushed",e=100,n=1,a="asc",i="all"){return Prompt.TA_promptButtonArray("GitHub Repo","Choose a repository",this.TA_accountRepoNames(t,e,n,a,i))}TA_fileGetSHA(t,e){return JSON.parse(HTTP.create().request({url:"https://api.github.com/repos/"+this.user+"/"+encodeURI(t)+"/contents/"+encodeURI(e),method:"GET",headers:{Authorization:"token "+this.cred.getValue("token"),"User-Agent":"Drafts-Script"}}).responseText).sha}TA_fileAdd(t,e,n,a){return JSON.parse(HTTP.create().request({url:"https://api.github.com/repos/"+this.user+"/"+encodeURI(t)+"/contents/"+encodeURI(e),method:"PUT",headers:{Authorization:"token "+this.cred.getValue("token"),"User-Agent":"Drafts-Script",accept:"application/vnd.github.v3+json"},data:{message:a,content:Base64.encode(n),path:e}}).responseText)}TA_fileUpdate(t,e,n,a){return JSON.parse(HTTP.create().request({url:"https://api.github.com/repos/"+this.user+"/"+encodeURI(t)+"/contents/"+encodeURI(e),method:"PUT",headers:{Authorization:"token "+this.cred.getValue("token"),"User-Agent":"Drafts-Script",accept:"application/vnd.github.v3+json"},data:{message:a,content:Base64.encode(n),path:e,sha:this.TA_fileGetSHA(t,e)}}).responseText)}TA_fileGetContent(t,e){let n=HTTP.create().request({url:"https://api.github.com/repos/"+this.user+"/"+t+"/contents/"+e,method:"GET",headers:{Authorization:"token "+this.cred.getValue("token"),"User-Agent":"Drafts-Script",accept:"application/vnd.github.v3+json"}}),a={};return void 0==JSON.parse(n.responseText).content?(a.success=!1,a.content=JSON.parse(n.responseText).message):(a.success=!0,a.content=Base64.decode(JSON.parse(n.responseText).content.replaceAll("\n",""))),a}TA_fileAppendContent(t,e,n,a,i="\n"){let r=this.TA_fileGetContent(t,e),o=n;return r.success&&(o=r.content+i+o),alert(r.content),alert(o),this.TA_fileUpdate(t,e,o,a)}TA_filePrependContent(t,e,n,a,i="\n"){let r=this.TA_fileGetContent(t,e),o=n;return r.success&&(o=o+i+r.content),alert(r.content),alert(o),this.TA_fileUpdate(t,e,o,a)}TA_accountGistInfo(t="pushed",e=100,n=1){let a="https://api.github.com/gists?";return a=(a=(a=a+"sort="+t)+"&per_page="+e)+"&page="+n,JSON.parse(HTTP.create().request({url:a,method:"GET",headers:{Authorization:"token "+this.cred.getValue("token"),"User-Agent":"Drafts-Script",accept:"application/vnd.github.v3+json"}}).responseText)}TA_accountGistDescriptions(t="pushed",e=100,n=1){let a=this,i=[];return this.gists={},this.TA_accountGistInfo(t,e,n).forEach(function(t){i.push(t.description),a.gists[t.id]=t.description}),i}TA_accountSelectGist(t="pushed",e=100,n=1){return new TadHTMLPrompt().TA_dropDown("Choose a gist",this.TA_accountGistDescriptions(t,e,n))}TA_accountLookupGistID(t,e=!0,n="pushed",a=100,i=1){e&&this.TA_accountGistDescriptions(n,a,i);let r=this,o="";return Object.keys(r.gists).forEach(function(e){r.gists[e]==t&&(o=e)}),o}TA_accountSelectGistReturnID(t="pushed",e=100,n=1){return this.TA_accountLookupGistID(this.TA_accountSelectGist(t,e,n),!1)}TA_gistCreate(t,e,n,a){let i=HTTP.create(),r={};r.url="https://api.github.com/gists?",r.method="POST",r.headers={},r.headers.Authorization="token "+this.cred.getValue("token"),r.headers.accept="application/vnd.github.v3+json",r.data={},r.data.description=t,r.data.public=e,r.data.files={};let o=0;return n.forEach(function(){r.data.files[n[o]]={},r.data.files[n[o]].content=a[o],o++}),JSON.parse(i.request(r).responseText).html_url}TA_gistFetch(t){let e="https://api.github.com/gists/"+t;return JSON.parse(HTTP.create().request({url:e,method:"GET",headers:{Authorization:"token "+this.cred.getValue("token"),"User-Agent":"Drafts-Script",accept:"application/vnd.github.v3+json"}}).responseText)}TA_gistFetchContent(t){let e=[],n=this.TA_gistFetch(t);return Object.keys(n.files).forEach(function(t){if(n.files[t].truncated){let a=HTTP.create();e.push(a.TA_getContent(n.files[t].raw_url))}else e.push(n.files[t].content)}),e}TA_gistFetchContentToDrafts(t){let e=this.TA_gistFetchContent(t);return e.forEach(function(t){draft.TA_draftNew(t)}),app.TA_displayInfoMessage(`Created ${e.length} new drafts`),e.length}}class TadPastebin{constructor(t="Pastebin"){let e=Credential.create(t,"Pastebin is an online service for posting content. Drafts needs some access credentials to be able to post content as you.");e.addTextField("username","User Name"),e.addPasswordField("password","Password"),e.addPasswordField("apikey","Developer API Key"),e.authorize()&&(this.cred=e),this.apikey=e.getValue("apikey");let n=HTTP.create().request({url:"https://pastebin.com/api/api_login.php",method:"POST",encoding:"form",data:{api_dev_key:this.apikey,api_user_name:e.getValue("username"),api_user_password:e.getValue("password")},headers:{"Content-Type":"application/x-www-form-urlencoded",charset:"utf-8"}});n.success?this.token=n.responseText:(this.token="",console.log("PostToPastebin:Status Code:"+n.statusCode),console.log("PostToPastebin:Response Error:"+n.error),app.displayErrorMessage("Failed to get Pastebin authorisation token"))}TA_postToPastebin(t,e="",n=!0,a=0,i="",r="N",o=""){let s=HTTP.create().request({url:"https://pastebin.com/api/api_post.php",method:"POST",encoding:"form",data:{api_dev_key:this.apikey,api_user_key:this.token,api_paste_code:t,api_paste_name:e,api_paste_private:a,api_option:"paste",api_paste_format:i,api_paste_expire_date:r,api_folder_key:o},headers:{"Content-Type":"application/x-www-form-urlencoded",charset:"utf-8"}});if(s.success)return n&&(app.setClipboard(s.responseText),app.displayInfoMessage("Pastebin note link copied to clipboard")),s.responseText;console.log("PostToPastebin:Status Code:"+s.statusCode),console.log("PostToPastebin:Response Error:"+s.error),app.displayErrorMessage(s.statusCode+":"+s.responseText)}}